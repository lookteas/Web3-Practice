<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="1000" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #2c3e50; }
      .subtitle { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #34495e; }
      .section-title { font-family: Arial, sans-serif; font-size: 16px; font-weight: bold; fill: #2c3e50; }
      .text { font-family: Arial, sans-serif; font-size: 12px; fill: #2c3e50; }
      .small-text { font-family: Arial, sans-serif; font-size: 10px; fill: #7f8c8d; }
      .code-text { font-family: 'Courier New', monospace; font-size: 10px; fill: #2c3e50; }
      .slot-box { fill: #ecf0f1; stroke: #bdc3c7; stroke-width: 2; }
      .packed-slot { fill: #2ecc71; stroke: #27ae60; stroke-width: 2; }
      .wasted-slot { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; }
      .type-uint256 { fill: #3498db; stroke: #2980b9; stroke-width: 1; }
      .type-uint128 { fill: #9b59b6; stroke: #8e44ad; stroke-width: 1; }
      .type-uint64 { fill: #f39c12; stroke: #e67e22; stroke-width: 1; }
      .type-uint32 { fill: #e67e22; stroke: #d35400; stroke-width: 1; }
      .type-uint8 { fill: #1abc9c; stroke: #16a085; stroke-width: 1; }
      .type-bool { fill: #95a5a6; stroke: #7f8c8d; stroke-width: 1; }
      .type-address { fill: #e91e63; stroke: #c2185b; stroke-width: 1; }
      .arrow { stroke: #34495e; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .dashed-line { stroke: #95a5a6; stroke-width: 1; stroke-dasharray: 5,5; fill: none; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#34495e" />
    </marker>
  </defs>
  
  <!-- æ ‡é¢˜ -->
  <text x="700" y="30" text-anchor="middle" class="title">EVM å­˜å‚¨æ§½åˆ†é…è§„åˆ™è¯¦ç»†ç¤ºæ„å›¾</text>
  
  <!-- åŸºæœ¬æ¦‚å¿µ -->
  <g id="basic-concepts">
    <text x="50" y="70" class="subtitle">1. å­˜å‚¨æ§½åŸºæœ¬æ¦‚å¿µ</text>
    
    <!-- å­˜å‚¨æ§½ç»“æ„ -->
    <rect x="50" y="90" width="400" height="40" class="slot-box" rx="5"/>
    <text x="250" y="105" text-anchor="middle" class="text">å­˜å‚¨æ§½ (Storage Slot)</text>
    <text x="250" y="120" text-anchor="middle" class="small-text">32 å­—èŠ‚ = 256 ä½</text>
    
    <!-- å­—èŠ‚æ ‡è®° -->
    <g id="byte-markers">
      <text x="60" y="150" class="small-text">å­—èŠ‚ä½ç½®:</text>
      <text x="60" y="165" class="small-text">0</text>
      <text x="110" y="165" class="small-text">4</text>
      <text x="160" y="165" class="small-text">8</text>
      <text x="210" y="165" class="small-text">12</text>
      <text x="260" y="165" class="small-text">16</text>
      <text x="310" y="165" class="small-text">20</text>
      <text x="360" y="165" class="small-text">24</text>
      <text x="410" y="165" class="small-text">28</text>
      <text x="440" y="165" class="small-text">31</text>
      
      <!-- å­—èŠ‚åˆ†éš”çº¿ -->
      <line x1="70" y1="90" x2="70" y2="130" class="dashed-line"/>
      <line x1="120" y1="90" x2="120" y2="130" class="dashed-line"/>
      <line x1="170" y1="90" x2="170" y2="130" class="dashed-line"/>
      <line x1="220" y1="90" x2="220" y2="130" class="dashed-line"/>
      <line x1="270" y1="90" x2="270" y2="130" class="dashed-line"/>
      <line x1="320" y1="90" x2="320" y2="130" class="dashed-line"/>
      <line x1="370" y1="90" x2="370" y2="130" class="dashed-line"/>
      <line x1="420" y1="90" x2="420" y2="130" class="dashed-line"/>
    </g>
    
    <!-- æ§½ç¼–å·è¯´æ˜ -->
    <text x="500" y="105" class="text">æ§½ç¼–å·: 0, 1, 2, 3, ...</text>
    <text x="500" y="120" class="small-text">ä» 0 å¼€å§‹é€’å¢</text>
  </g>
  
  <!-- æ•°æ®ç±»å‹å¤§å° -->
  <g id="data-types">
    <text x="50" y="210" class="subtitle">2. æ•°æ®ç±»å‹å­˜å‚¨å¤§å°</text>
    
    <!-- ç±»å‹è¡¨æ ¼ -->
    <rect x="50" y="230" width="600" height="200" fill="none" stroke="#bdc3c7" stroke-width="1"/>
    
    <!-- è¡¨å¤´ -->
    <rect x="50" y="230" width="600" height="25" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="1"/>
    <text x="70" y="247" class="text">æ•°æ®ç±»å‹</text>
    <text x="200" y="247" class="text">å¤§å° (å­—èŠ‚)</text>
    <text x="320" y="247" class="text">ç¤ºä¾‹</text>
    <text x="500" y="247" class="text">å­˜å‚¨ç‰¹ç‚¹</text>
    
    <!-- ç±»å‹è¡Œ -->
    <g id="type-rows">
      <!-- bool -->
      <rect x="60" y="260" width="20" height="15" class="type-bool"/>
      <text x="90" y="270" class="small-text">bool</text>
      <text x="200" y="270" class="small-text">1</text>
      <text x="320" y="270" class="code-text">true/false</text>
      <text x="500" y="270" class="small-text">å­˜å‚¨ä¸º 0x00 æˆ– 0x01</text>
      
      <!-- uint8 -->
      <rect x="60" y="280" width="20" height="15" class="type-uint8"/>
      <text x="90" y="290" class="small-text">uint8</text>
      <text x="200" y="290" class="small-text">1</text>
      <text x="320" y="290" class="code-text">0-255</text>
      <text x="500" y="290" class="small-text">å¯ä¸å…¶ä»–å°ç±»å‹æ‰“åŒ…</text>
      
      <!-- uint32 -->
      <rect x="60" y="300" width="20" height="15" class="type-uint32"/>
      <text x="90" y="310" class="small-text">uint32</text>
      <text x="200" y="310" class="small-text">4</text>
      <text x="320" y="310" class="code-text">0-4,294,967,295</text>
      <text x="500" y="310" class="small-text">é€‚åˆæ—¶é—´æˆ³ç­‰</text>
      
      <!-- uint64 -->
      <rect x="60" y="320" width="20" height="15" class="type-uint64"/>
      <text x="90" y="330" class="small-text">uint64</text>
      <text x="200" y="330" class="small-text">8</text>
      <text x="320" y="330" class="code-text">0-18,446,744,073,709,551,615</text>
      <text x="500" y="330" class="small-text">å¯ä¸ uint128 ç­‰æ‰“åŒ…</text>
      
      <!-- uint128 -->
      <rect x="60" y="340" width="20" height="15" class="type-uint128"/>
      <text x="90" y="350" class="small-text">uint128</text>
      <text x="200" y="350" class="small-text">16</text>
      <text x="320" y="350" class="code-text">å¤§æ•°å€¼</text>
      <text x="500" y="350" class="small-text">ä¸¤ä¸ªå¯æ‰“åŒ…åœ¨ä¸€æ§½</text>
      
      <!-- uint256 -->
      <rect x="60" y="360" width="20" height="15" class="type-uint256"/>
      <text x="90" y="370" class="small-text">uint256</text>
      <text x="200" y="370" class="small-text">32</text>
      <text x="320" y="370" class="code-text">æœ€å¤§æ•´æ•°</text>
      <text x="500" y="370" class="small-text">å ç”¨å®Œæ•´å­˜å‚¨æ§½</text>
      
      <!-- address -->
      <rect x="60" y="380" width="20" height="15" class="type-address"/>
      <text x="90" y="390" class="small-text">address</text>
      <text x="200" y="390" class="small-text">20</text>
      <text x="320" y="390" class="code-text">0x742d35Cc...</text>
      <text x="500" y="390" class="small-text">å¯ä¸12å­—èŠ‚æ•°æ®æ‰“åŒ…</text>
      
      <!-- bytes32 -->
      <rect x="60" y="400" width="20" height="15" class="type-uint256"/>
      <text x="90" y="410" class="small-text">bytes32</text>
      <text x="200" y="410" class="small-text">32</text>
      <text x="320" y="410" class="code-text">0x1234...</text>
      <text x="500" y="410" class="small-text">å ç”¨å®Œæ•´å­˜å‚¨æ§½</text>
    </g>
  </g>
  
  <!-- åˆ†é…è§„åˆ™ç¤ºä¾‹ -->
  <g id="allocation-rules">
    <text x="50" y="470" class="subtitle">3. å­˜å‚¨æ§½åˆ†é…è§„åˆ™ç¤ºä¾‹</text>
    
    <!-- ç¤ºä¾‹åˆçº¦ä»£ç  -->
    <rect x="50" y="490" width="400" height="180" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1" rx="5"/>
    <text x="60" y="510" class="code-text">contract StorageExample {</text>
    <text x="70" y="525" class="code-text">    uint256 a;      // 32 å­—èŠ‚</text>
    <text x="70" y="540" class="code-text">    uint128 b;      // 16 å­—èŠ‚</text>
    <text x="70" y="555" class="code-text">    uint128 c;      // 16 å­—èŠ‚</text>
    <text x="70" y="570" class="code-text">    uint64 d;       // 8 å­—èŠ‚</text>
    <text x="70" y="585" class="code-text">    uint32 e;       // 4 å­—èŠ‚</text>
    <text x="70" y="600" class="code-text">    uint16 f;       // 2 å­—èŠ‚</text>
    <text x="70" y="615" class="code-text">    uint8 g;        // 1 å­—èŠ‚</text>
    <text x="70" y="630" class="code-text">    bool h;         // 1 å­—èŠ‚</text>
    <text x="70" y="645" class="code-text">    address owner;  // 20 å­—èŠ‚</text>
    <text x="60" y="660" class="code-text">}</text>
    
    <!-- å­˜å‚¨å¸ƒå±€å¯è§†åŒ– -->
    <text x="500" y="510" class="section-title">å®é™…å­˜å‚¨å¸ƒå±€:</text>
    
    <!-- Slot 0 -->
    <text x="500" y="535" class="text">Slot 0:</text>
    <rect x="570" y="520" width="320" height="25" class="type-uint256"/>
    <text x="730" y="537" text-anchor="middle" class="small-text" fill="white">uint256 a (32 å­—èŠ‚)</text>
    
    <!-- Slot 1 -->
    <text x="500" y="565" class="text">Slot 1:</text>
    <rect x="570" y="550" width="160" height="25" class="type-uint128"/>
    <rect x="730" y="550" width="160" height="25" class="type-uint128"/>
    <text x="650" y="567" text-anchor="middle" class="small-text" fill="white">uint128 b</text>
    <text x="810" y="567" text-anchor="middle" class="small-text" fill="white">uint128 c</text>
    
    <!-- Slot 2 -->
    <text x="500" y="595" class="text">Slot 2:</text>
    <rect x="570" y="580" width="80" height="25" class="type-uint64"/>
    <rect x="650" y="580" width="40" height="25" class="type-uint32"/>
    <rect x="690" y="580" width="20" height="25" class="type-uint8"/>
    <rect x="710" y="580" width="20" height="25" class="type-uint8"/>
    <rect x="730" y="580" width="10" height="25" class="type-bool"/>
    <rect x="740" y="580" width="150" height="25" class="wasted-slot"/>
    <text x="610" y="597" text-anchor="middle" class="small-text" fill="white">d</text>
    <text x="670" y="597" text-anchor="middle" class="small-text" fill="white">e</text>
    <text x="700" y="597" text-anchor="middle" class="small-text" fill="white">f</text>
    <text x="720" y="597" text-anchor="middle" class="small-text" fill="white">g</text>
    <text x="735" y="597" text-anchor="middle" class="small-text" fill="white">h</text>
    <text x="815" y="597" text-anchor="middle" class="small-text">æµªè´¹ (15å­—èŠ‚)</text>
    
    <!-- Slot 3 -->
    <text x="500" y="625" class="text">Slot 3:</text>
    <rect x="570" y="610" width="200" height="25" class="type-address"/>
    <rect x="770" y="610" width="120" height="25" class="wasted-slot"/>
    <text x="670" y="627" text-anchor="middle" class="small-text" fill="white">address owner (20å­—èŠ‚)</text>
    <text x="830" y="627" text-anchor="middle" class="small-text">æµªè´¹ (12å­—èŠ‚)</text>
    
    <!-- ä¼˜åŒ–å»ºè®® -->
    <text x="500" y="660" class="text" fill="#e74c3c">âŒ æµªè´¹äº† 27 å­—èŠ‚å­˜å‚¨ç©ºé—´!</text>
  </g>
  
  <!-- ä¼˜åŒ–åçš„å¸ƒå±€ -->
  <g id="optimized-layout">
    <text x="50" y="720" class="subtitle">4. ä¼˜åŒ–åçš„å­˜å‚¨å¸ƒå±€</text>
    
    <!-- ä¼˜åŒ–åçš„ä»£ç  -->
    <rect x="50" y="740" width="400" height="180" fill="#e8f5e8" stroke="#4caf50" stroke-width="1" rx="5"/>
    <text x="60" y="760" class="code-text">contract OptimizedStorage {</text>
    <text x="70" y="775" class="code-text">    uint256 a;      // 32 å­—èŠ‚</text>
    <text x="70" y="790" class="code-text">    uint128 b;      // 16 å­—èŠ‚</text>
    <text x="70" y="805" class="code-text">    uint128 c;      // 16 å­—èŠ‚</text>
    <text x="70" y="820" class="code-text">    address owner;  // 20 å­—èŠ‚</text>
    <text x="70" y="835" class="code-text">    uint64 d;       // 8 å­—èŠ‚</text>
    <text x="70" y="850" class="code-text">    uint32 e;       // 4 å­—èŠ‚</text>
    <text x="70" y="865" class="code-text">    uint16 f;       // 2 å­—èŠ‚</text>
    <text x="70" y="880" class="code-text">    uint8 g;        // 1 å­—èŠ‚</text>
    <text x="70" y="895" class="code-text">    bool h;         // 1 å­—èŠ‚</text>
    <text x="60" y="910" class="code-text">}</text>
    
    <!-- ä¼˜åŒ–åçš„å­˜å‚¨å¸ƒå±€ -->
    <text x="500" y="760" class="section-title">ä¼˜åŒ–åå­˜å‚¨å¸ƒå±€:</text>
    
    <!-- Slot 0 -->
    <text x="500" y="785" class="text">Slot 0:</text>
    <rect x="570" y="770" width="320" height="25" class="type-uint256"/>
    <text x="730" y="787" text-anchor="middle" class="small-text" fill="white">uint256 a (32 å­—èŠ‚)</text>
    
    <!-- Slot 1 -->
    <text x="500" y="815" class="text">Slot 1:</text>
    <rect x="570" y="800" width="160" height="25" class="packed-slot"/>
    <rect x="730" y="800" width="160" height="25" class="packed-slot"/>
    <text x="650" y="817" text-anchor="middle" class="small-text" fill="white">uint128 b</text>
    <text x="810" y="817" text-anchor="middle" class="small-text" fill="white">uint128 c</text>
    
    <!-- Slot 2 -->
    <text x="500" y="845" class="text">Slot 2:</text>
    <rect x="570" y="830" width="200" height="25" class="packed-slot"/>
    <rect x="770" y="830" width="80" height="25" class="packed-slot"/>
    <rect x="850" y="830" width="40" height="25" class="packed-slot"/>
    <text x="670" y="847" text-anchor="middle" class="small-text" fill="white">address owner</text>
    <text x="810" y="847" text-anchor="middle" class="small-text" fill="white">uint64 d</text>
    <text x="870" y="847" text-anchor="middle" class="small-text" fill="white">e,f,g,h</text>
    
    <!-- èŠ‚çœè¯´æ˜ -->
    <text x="500" y="875" class="text" fill="#27ae60">âœ… èŠ‚çœ 1 ä¸ªå­˜å‚¨æ§½!</text>
    <text x="500" y="890" class="small-text">ä» 4 ä¸ªæ§½å‡å°‘åˆ° 3 ä¸ªæ§½</text>
    <text x="500" y="905" class="small-text">èŠ‚çœçº¦ 20,000 Gas</text>
  </g>
  
  <!-- æ‰“åŒ…è§„åˆ™ -->
  <g id="packing-rules">
    <text x="950" y="70" class="subtitle">5. å­˜å‚¨æ‰“åŒ…è§„åˆ™</text>
    
    <!-- è§„åˆ™åˆ—è¡¨ -->
    <rect x="950" y="90" width="400" height="300" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1" rx="5"/>
    
    <text x="970" y="115" class="section-title">âœ… å¯ä»¥æ‰“åŒ…çš„æƒ…å†µ:</text>
    <text x="980" y="135" class="small-text">â€¢ ç›¸é‚»å˜é‡å£°æ˜</text>
    <text x="980" y="150" class="small-text">â€¢ æ€»å¤§å° â‰¤ 32 å­—èŠ‚</text>
    <text x="980" y="165" class="small-text">â€¢ ç±»å‹å…¼å®¹</text>
    <text x="980" y="180" class="small-text">â€¢ æ²¡æœ‰æ•°ç»„æˆ–æ˜ å°„åˆ†éš”</text>
    
    <text x="970" y="205" class="section-title">âŒ ä¸èƒ½æ‰“åŒ…çš„æƒ…å†µ:</text>
    <text x="980" y="225" class="small-text">â€¢ å˜é‡ä¹‹é—´æœ‰å¤§ç±»å‹åˆ†éš”</text>
    <text x="980" y="240" class="small-text">â€¢ æ€»å¤§å° > 32 å­—èŠ‚</text>
    <text x="980" y="255" class="small-text">â€¢ åŠ¨æ€ç±»å‹ (string, bytes, array)</text>
    <text x="980" y="270" class="small-text">â€¢ æ˜ å°„ç±»å‹</text>
    
    <text x="970" y="295" class="section-title">í´§ ä¼˜åŒ–æŠ€å·§:</text>
    <text x="980" y="315" class="small-text">â€¢ æŒ‰å¤§å°æ’åºå˜é‡</text>
    <text x="980" y="330" class="small-text">â€¢ ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹å¤§å°</text>
    <text x="980" y="345" class="small-text">â€¢ è€ƒè™‘ä½¿ç”¨ struct æ‰“åŒ…</text>
    <text x="980" y="360" class="small-text">â€¢ é¿å…åœ¨å°ç±»å‹é—´æ’å…¥å¤§ç±»å‹</text>
  </g>
  
  <!-- ç‰¹æ®Šæƒ…å†µ -->
  <g id="special-cases">
    <text x="950" y="420" class="subtitle">6. ç‰¹æ®Šå­˜å‚¨æƒ…å†µ</text>
    
    <!-- æ•°ç»„å’Œæ˜ å°„ -->
    <rect x="950" y="440" width="400" height="200" fill="#fff3cd" stroke="#ffc107" stroke-width="1" rx="5"/>
    
    <text x="970" y="465" class="section-title">åŠ¨æ€æ•°ç»„:</text>
    <text x="980" y="485" class="code-text">uint256[] arr;  // Slot p</text>
    <text x="980" y="500" class="small-text">â€¢ Slot p: æ•°ç»„é•¿åº¦</text>
    <text x="980" y="515" class="small-text">â€¢ keccak256(p) + i: arr[i]</text>
    
    <text x="970" y="540" class="section-title">æ˜ å°„:</text>
    <text x="980" y="560" class="code-text">mapping(K => V) map;  // Slot p</text>
    <text x="980" y="575" class="small-text">â€¢ keccak256(key . p): map[key]</text>
    
    <text x="970" y="600" class="section-title">åµŒå¥—ç»“æ„:</text>
    <text x="980" y="620" class="small-text">â€¢ ç»“æ„ä½“æˆå‘˜æŒ‰é¡ºåºåˆ†é…</text>
    <text x="980" y="635" class="small-text">â€¢ å¯ä»¥è·¨è¶Šå¤šä¸ªå­˜å‚¨æ§½</text>
  </g>
  
  <!-- Gas æˆæœ¬å¯¹æ¯” -->
  <g id="gas-costs">
    <text x="950" y="680" class="subtitle">7. Gas æˆæœ¬å¯¹æ¯”</text>
    
    <rect x="950" y="700" width="400" height="150" fill="#f0f8ff" stroke="#007bff" stroke-width="1" rx="5"/>
    
    <text x="970" y="725" class="section-title">SSTORE (å†™å…¥) æˆæœ¬:</text>
    <text x="980" y="745" class="small-text">â€¢ 0 â†’ é0: 20,000 gas</text>
    <text x="980" y="760" class="small-text">â€¢ é0 â†’ é0: 5,000 gas</text>
    <text x="980" y="775" class="small-text">â€¢ é0 â†’ 0: 5,000 gas + 15,000 é€€æ¬¾</text>
    
    <text x="970" y="800" class="section-title">SLOAD (è¯»å–) æˆæœ¬:</text>
    <text x="980" y="820" class="small-text">â€¢ å†·è®¿é—®: 2,100 gas</text>
    <text x="980" y="835" class="small-text">â€¢ çƒ­è®¿é—®: 100 gas</text>
  </g>
  
  <!-- åº•éƒ¨æ€»ç»“ -->
  <g id="summary">
    <rect x="50" y="950" width="1300" height="40" fill="#e8f5e8" stroke="#4caf50" stroke-width="2" rx="5"/>
    <text x="700" y="965" text-anchor="middle" class="section-title">í²¡ å…³é”®è¦ç‚¹</text>
    <text x="700" y="980" text-anchor="middle" class="small-text">åˆç†çš„å˜é‡æ’åºå’Œç±»å‹é€‰æ‹©å¯ä»¥æ˜¾è‘—å‡å°‘å­˜å‚¨æ§½ä½¿ç”¨ï¼Œä»è€ŒèŠ‚çœå¤§é‡ Gas è´¹ç”¨</text>
  </g>
</svg>
