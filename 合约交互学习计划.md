# åˆçº¦äº¤äº’åŠŸèƒ½å­¦ä¹ è®¡åˆ’ ğŸ“š

## ğŸ¯ å­¦ä¹ ç›®æ ‡
- æŒæ¡ Web3 å‰ç«¯å¼€å‘æ ¸å¿ƒæŠ€èƒ½
- ç†Ÿç»ƒä½¿ç”¨ ethers.js/web3.js è¿›è¡Œåˆçº¦äº¤äº’
- èƒ½å¤Ÿç‹¬ç«‹å¼€å‘å®Œæ•´çš„ DApp åº”ç”¨
- äº†è§£å®‰å…¨æœ€ä½³å®è·µå’Œæ€§èƒ½ä¼˜åŒ–

---

## ğŸ“… ç¬¬1å‘¨ï¼šåŸºç¡€ç¯å¢ƒæ­å»ºå’Œå·¥å…·ç†Ÿæ‚‰

### ğŸ¯ æœ¬å‘¨ç›®æ ‡
å»ºç«‹å®Œæ•´çš„å¼€å‘ç¯å¢ƒï¼Œç†Ÿæ‚‰åŒºå—é“¾å¼€å‘å·¥å…·é“¾

### ğŸ“‹ å­¦ä¹ ä»»åŠ¡

#### ç¬¬1å¤©ï¼šå¼€å‘ç¯å¢ƒé…ç½®
- [ ] **å®‰è£… Node.js å’ŒåŒ…ç®¡ç†å™¨**
  ```bash
  # ä¸‹è½½å¹¶å®‰è£… Node.js 18+ ç‰ˆæœ¬
  # éªŒè¯å®‰è£…
  node --version
  npm --version
  
  # å…¨å±€å®‰è£…å¸¸ç”¨å·¥å…·
  npm install -g yarn
  npm install -g @hardhat-runner/hardhat
  ```

- [ ] **é…ç½® VS Code å¼€å‘ç¯å¢ƒ**
  ```json
  // æ¨èå®‰è£…çš„æ’ä»¶
  {
    "recommendations": [
      "JuanBlanco.solidity",
      "esbenp.prettier-vscode",
      "ms-vscode.vscode-json",
      "bradlc.vscode-tailwindcss"
    ]
  }
  ```
  
  **å…·ä½“æ“ä½œæ­¥éª¤ï¼š**
  1. æ‰“å¼€ VS Code
  2. æŒ‰ `Ctrl+Shift+X` æ‰“å¼€æ‰©å±•é¢æ¿
  3. æœç´¢å¹¶å®‰è£… "Solidity" æ’ä»¶
  4. æœç´¢å¹¶å®‰è£… "Prettier - Code formatter" æ’ä»¶
  5. åœ¨è®¾ç½®ä¸­å¯ç”¨ "Format On Save"

#### ç¬¬2å¤©ï¼šå¼€å‘æ¡†æ¶é€‰æ‹©å’Œé…ç½®

##### ğŸ”§ Hardhat æ¡†æ¶æ­å»º
- [ ] **åˆå§‹åŒ– Hardhat é¡¹ç›®**
  ```bash
  # åœ¨æ‚¨çš„é¡¹ç›®ç›®å½•åˆ›å»ºæ–°æ–‡ä»¶å¤¹
  cd d:\code\web3\Web3-Practice
  mkdir contract-interaction-practice
  cd contract-interaction-practice
  
  # åˆå§‹åŒ– Hardhat é¡¹ç›®
  npx hardhat init
  # é€‰æ‹© "Create a JavaScript project"
  # é€‰æ‹©é»˜è®¤è®¾ç½®
  
  # å®‰è£…ä¾èµ–
  npm install --save-dev @nomicfoundation/hardhat-toolbox
  npm install ethers
  ```

- [ ] **é…ç½® hardhat.config.js**
  ```javascript
  require("@nomicfoundation/hardhat-toolbox");
  
  module.exports = {
    solidity: "0.8.19",
    networks: {
      sepolia: {
        url: "https://sepolia.infura.io/v3/YOUR_INFURA_KEY",
        accounts: ["YOUR_PRIVATE_KEY"] // æµ‹è¯•è´¦æˆ·ç§é’¥
      },
      localhost: {
        url: "http://127.0.0.1:8545"
      }
    }
  };
  ```

##### âš¡ Foundry æ¡†æ¶æ­å»ºï¼ˆæ¨èï¼‰
- [ ] **å®‰è£… Foundry**
  ```bash
  # Windows ç”¨æˆ·å®‰è£… Foundry
  # æ–¹æ³•1ï¼šä½¿ç”¨ foundryupï¼ˆæ¨èï¼‰
  curl -L https://foundry.paradigm.xyz | bash
  foundryup
  
  # æ–¹æ³•2ï¼šä½¿ç”¨é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶
  # ä¸‹è½½ foundry äºŒè¿›åˆ¶æ–‡ä»¶åˆ° PATH ç›®å½•
  
  # éªŒè¯å®‰è£…
  forge --version
  cast --version
  anvil --version
  ```

- [ ] **åˆå§‹åŒ– Foundry é¡¹ç›®**
  ```bash
  # åˆ›å»ºæ–°çš„ Foundry é¡¹ç›®
  cd d:\code\web3\Web3-Practice
  mkdir foundry-practice
  cd foundry-practice
  
  # åˆå§‹åŒ–é¡¹ç›®
  forge init
  
  # é¡¹ç›®ç»“æ„
  # â”œâ”€â”€ foundry.toml     # é…ç½®æ–‡ä»¶
  # â”œâ”€â”€ src/             # åˆçº¦æºç 
  # â”œâ”€â”€ test/            # æµ‹è¯•æ–‡ä»¶
  # â”œâ”€â”€ script/          # éƒ¨ç½²è„šæœ¬
  # â””â”€â”€ lib/             # ä¾èµ–åº“
  ```

- [ ] **é…ç½® foundry.toml**
  ```toml
  [profile.default]
  src = "src"
  out = "out"
  libs = ["lib"]
  solc_version = "0.8.19"
  optimizer = true
  optimizer_runs = 200
  via_ir = false
  
  # RPC ç«¯ç‚¹é…ç½®
  [rpc_endpoints]
  sepolia = "https://sepolia.infura.io/v3/YOUR_INFURA_KEY"
  mainnet = "https://mainnet.infura.io/v3/YOUR_INFURA_KEY"
  localhost = "http://127.0.0.1:8545"
  
  # Etherscan API é…ç½®
  [etherscan]
  sepolia = { key = "YOUR_ETHERSCAN_API_KEY" }
  mainnet = { key = "YOUR_ETHERSCAN_API_KEY" }
  ```

- [ ] **Foundry vs Hardhat å¯¹æ¯”**
  ```markdown
  ## Foundry ä¼˜åŠ¿
  âœ… æå¿«çš„ç¼–è¯‘å’Œæµ‹è¯•é€Ÿåº¦ï¼ˆRust ç¼–å†™ï¼‰
  âœ… å†…ç½®æ¨¡ç³Šæµ‹è¯•ï¼ˆFuzz Testingï¼‰
  âœ… å¼ºå¤§çš„è°ƒè¯•å·¥å…·ï¼ˆforge debugï¼‰
  âœ… åŸç”Ÿ Solidity æµ‹è¯•ï¼ˆæ— éœ€ JavaScriptï¼‰
  âœ… å†…ç½® Gas å¿«ç…§å’Œä¼˜åŒ–åˆ†æ
  âœ… å¼ºå¤§çš„ cast å‘½ä»¤è¡Œå·¥å…·
  
  ## Hardhat ä¼˜åŠ¿
  âœ… æ›´æˆç†Ÿçš„ç”Ÿæ€ç³»ç»Ÿ
  âœ… ä¸°å¯Œçš„æ’ä»¶æ”¯æŒ
  âœ… JavaScript/TypeScript é›†æˆ
  âœ… æ›´å¥½çš„ IDE æ”¯æŒ
  âœ… å­¦ä¹ èµ„æºæ›´å¤š
  
  ## å»ºè®®
  ğŸ¯ æ–°æ‰‹å­¦ä¹ ï¼šå…ˆç”¨ Hardhatï¼Œç”Ÿæ€å®Œå–„
  ğŸ¯ é«˜çº§å¼€å‘ï¼šä½¿ç”¨ Foundryï¼Œæ€§èƒ½æ›´å¥½
  ğŸ¯ æœ€ä½³å®è·µï¼šä¸¤è€…ç»“åˆä½¿ç”¨
  ```

#### ç¬¬3å¤©ï¼šMetaMask é’±åŒ…é…ç½®
- [ ] **å®‰è£…å’ŒåŸºç¡€é…ç½®**
  
  1. è®¿é—® [MetaMaskå®˜ç½‘](https://metamask.io/) ä¸‹è½½æµè§ˆå™¨æ’ä»¶
  2. åˆ›å»ºæ–°é’±åŒ…ï¼ˆè®°ä½åŠ©è®°è¯ï¼ï¼‰
  3. è®¾ç½®å¼ºå¯†ç 
  4. å¤‡ä»½åŠ©è®°è¯åˆ°å®‰å…¨ä½ç½®
  
- [ ] **æ·»åŠ æµ‹è¯•ç½‘ç»œ**
  
  ```javascript
  // Sepolia æµ‹è¯•ç½‘é…ç½®
  ç½‘ç»œåç§°: Sepolia Test Network
  RPC URL: https://sepolia.infura.io/v3/
  é“¾ID: 11155111
  è´§å¸ç¬¦å·: ETH
  åŒºå—æµè§ˆå™¨: https://sepolia.etherscan.io
  ```
  
  **æ“ä½œæ­¥éª¤ï¼š**
  1. ç‚¹å‡» MetaMask é¡¶éƒ¨ç½‘ç»œä¸‹æ‹‰èœå•
  2. é€‰æ‹© "æ·»åŠ ç½‘ç»œ"
  3. å¡«å…¥ä¸Šè¿°é…ç½®ä¿¡æ¯
  4. ç‚¹å‡» "ä¿å­˜"

#### ç¬¬4å¤©ï¼šè·å–æµ‹è¯• ETH
- [ ] **ä½¿ç”¨æ°´é¾™å¤´è·å–æµ‹è¯•å¸**
  ```bash
  # æ¨èçš„ Sepolia æ°´é¾™å¤´
  https://sepoliafaucet.com/
  https://www.alchemy.com/faucets/ethereum-sepolia
  https://sepolia-faucet.pk910.de/
  ```
  
  **å…·ä½“æ“ä½œï¼š**
  1. å¤åˆ¶æ‚¨çš„ MetaMask é’±åŒ…åœ°å€
  2. è®¿é—®æ°´é¾™å¤´ç½‘ç«™
  3. ç²˜è´´åœ°å€å¹¶è¯·æ±‚æµ‹è¯• ETH
  4. ç­‰å¾…äº¤æ˜“ç¡®è®¤ï¼ˆé€šå¸¸1-2åˆ†é’Ÿï¼‰
  5. åœ¨ MetaMask ä¸­æŸ¥çœ‹ä½™é¢

#### ç¬¬5å¤©ï¼šåŒºå—é“¾æµè§ˆå™¨ä½¿ç”¨
- [ ] **Etherscan åŸºç¡€æ“ä½œ**
  1. è®¿é—® [Sepolia Etherscan](https://sepolia.etherscan.io)
  2. æœç´¢æ‚¨çš„é’±åŒ…åœ°å€
  3. æŸ¥çœ‹äº¤æ˜“å†å²
  4. ç†è§£äº¤æ˜“è¯¦æƒ…é¡µé¢å„é¡¹ä¿¡æ¯

- [ ] **Gas è´¹ç”¨ç†è§£**
  ```javascript
  // Gas ç›¸å…³æ¦‚å¿µ
  Gas Limit: äº¤æ˜“å…è®¸æ¶ˆè€—çš„æœ€å¤§ Gas æ•°é‡
  Gas Price: æ¯å•ä½ Gas çš„ä»·æ ¼ (Gwei)
  Transaction Fee = Gas Used Ã— Gas Price
  
  // å¸¸è§æ“ä½œçš„ Gas æ¶ˆè€—
  ETH è½¬è´¦: ~21,000 Gas
  ERC20 è½¬è´¦: ~65,000 Gas
  åˆçº¦éƒ¨ç½²: 200,000+ Gas
  ```

#### ç¬¬6-7å¤©ï¼šå®è·µé¡¹ç›® - éƒ¨ç½² Bank åˆçº¦

##### ğŸ”§ ä½¿ç”¨ Hardhat éƒ¨ç½²
- [ ] **å‡†å¤‡åˆçº¦æ–‡ä»¶**
  ```bash
  # å¤åˆ¶æ‚¨ç°æœ‰çš„ Bank.sol åˆ° Hardhat é¡¹ç›®
  cp ../bankContract/Bank.sol contracts/
  ```

- [ ] **ç¼–å†™éƒ¨ç½²è„šæœ¬**
  ```javascript
  // scripts/deploy-bank.js
  const hre = require("hardhat");
  
  async function main() {
    console.log("å¼€å§‹éƒ¨ç½² Bank åˆçº¦...");
    
    // è·å–åˆçº¦å·¥å‚
    const Bank = await hre.ethers.getContractFactory("Bank");
    
    // éƒ¨ç½²åˆçº¦
    const bank = await Bank.deploy();
    await bank.waitForDeployment();
    
    const address = await bank.getAddress();
    console.log(`Bank åˆçº¦å·²éƒ¨ç½²åˆ°: ${address}`);
    
    // éªŒè¯éƒ¨ç½²
    const balance = await bank.getContractBalance();
    console.log(`åˆçº¦åˆå§‹ä½™é¢: ${hre.ethers.formatEther(balance)} ETH`);
  }
  
  main().catch((error) => {
    console.error(error);
    process.exitCode = 1;
  });
  ```

- [ ] **æ‰§è¡Œ Hardhat éƒ¨ç½²**
  ```bash
  # ç¼–è¯‘åˆçº¦
  npx hardhat compile
  
  # éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œ
  npx hardhat node  # æ–°ç»ˆç«¯è¿è¡Œ
  npx hardhat run scripts/deploy-bank.js --network localhost
  
  # éƒ¨ç½²åˆ°æµ‹è¯•ç½‘
  npx hardhat run scripts/deploy-bank.js --network sepolia
  ```

##### âš¡ ä½¿ç”¨ Foundry éƒ¨ç½²ï¼ˆæ¨èï¼‰
- [ ] **å‡†å¤‡åˆçº¦æ–‡ä»¶**
  ```bash
  # å¤åˆ¶æ‚¨ç°æœ‰çš„ Bank.sol åˆ° Foundry é¡¹ç›®
  cp ../bankContract/Bank.sol src/
  ```

- [ ] **ç¼–å†™ Foundry éƒ¨ç½²è„šæœ¬**
  ```solidity
  // script/DeployBank.s.sol
  // SPDX-License-Identifier: MIT
  pragma solidity ^0.8.19;
  
  import "forge-std/Script.sol";
  import "../src/Bank.sol";
  
  contract DeployBank is Script {
      function run() external {
          // è·å–éƒ¨ç½²è€…ç§é’¥
          uint256 deployerPrivateKey = vm.envUint("PRIVATE_KEY");
          
          // å¼€å§‹å¹¿æ’­äº¤æ˜“
          vm.startBroadcast(deployerPrivateKey);
          
          // éƒ¨ç½² Bank åˆçº¦
          Bank bank = new Bank();
          
          console.log("Bank åˆçº¦å·²éƒ¨ç½²åˆ°:", address(bank));
          console.log("éƒ¨ç½²è€…åœ°å€:", vm.addr(deployerPrivateKey));
          console.log("åˆçº¦ç®¡ç†å‘˜:", bank.admin());
          
          vm.stopBroadcast();
      }
  }
  ```

- [ ] **ç¼–å†™æµ‹è¯•æ–‡ä»¶**
  ```solidity
  // test/Bank.t.sol
  // SPDX-License-Identifier: MIT
  pragma solidity ^0.8.19;
  
  import "forge-std/Test.sol";
  import "../src/Bank.sol";
  
  contract BankTest is Test {
      Bank public bank;
      address public admin;
      address public user1;
      address public user2;
      
      function setUp() public {
          admin = address(this);
          user1 = makeAddr("user1");
          user2 = makeAddr("user2");
          
          bank = new Bank();
          
          // ç»™æµ‹è¯•ç”¨æˆ·ä¸€äº› ETH
          vm.deal(user1, 10 ether);
          vm.deal(user2, 10 ether);
      }
      
      function testDeposit() public {
          vm.prank(user1);
          bank.deposit{value: 1 ether}();
          
          assertEq(bank.deposits(user1), 1 ether);
          assertEq(address(bank).balance, 1 ether);
      }
      
      function testWithdraw() public {
          // å…ˆå­˜æ¬¾
          vm.prank(user1);
          bank.deposit{value: 2 ether}();
          
          // ç®¡ç†å‘˜æå–
          uint256 balanceBefore = admin.balance;
          bank.withdraw(1 ether);
          
          assertEq(admin.balance - balanceBefore, 1 ether);
          assertEq(address(bank).balance, 1 ether);
      }
      
      function testTopDepositors() public {
          // å¤šä¸ªç”¨æˆ·å­˜æ¬¾
          vm.prank(user1);
          bank.deposit{value: 3 ether}();
          
          vm.prank(user2);
          bank.deposit{value: 5 ether}();
          
          address[] memory topDepositors = bank.getTopDepositors();
          assertEq(topDepositors[0], user2); // æœ€é«˜å­˜æ¬¾è€…
          assertEq(topDepositors[1], user1);
      }
  }
  ```

- [ ] **æ‰§è¡Œ Foundry éƒ¨ç½²**
  
  ```bash
  # ç¼–è¯‘åˆçº¦
  forge build
  
  # è¿è¡Œæµ‹è¯•
  forge test -vv
  
  # è¿è¡Œç‰¹å®šæµ‹è¯•
  forge test --match-test testDeposit -vv
  
  # ç”Ÿæˆ Gas æŠ¥å‘Š
  forge test --gas-report
  
  # éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œ
  anvil  # æ–°ç»ˆç«¯è¿è¡Œæœ¬åœ°èŠ‚ç‚¹
  
  # è®¾ç½®ç¯å¢ƒå˜é‡
  export PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
  
  # éƒ¨ç½²åˆ°æœ¬åœ°
  forge script script/DeployBank.s.sol --rpc-url http://localhost:8545 --broadcast
  
  # éƒ¨ç½²åˆ°æµ‹è¯•ç½‘
  forge script script/DeployBank.s.sol --rpc-url sepolia --broadcast --verify
  ```
  
- [ ] **Foundry é«˜çº§åŠŸèƒ½**
  ```bash
  # æ¨¡ç³Šæµ‹è¯•
  forge test --match-test testFuzz -vv
  
  # è°ƒè¯•äº¤æ˜“
  forge debug --debug <transaction_hash>
  
  # åˆçº¦éªŒè¯
  forge verify-contract <contract_address> src/Bank.sol:Bank --chain sepolia
  
  # Gas å¿«ç…§
  forge snapshot
  
  # ä½¿ç”¨ cast ä¸åˆçº¦äº¤äº’
  cast call <contract_address> "getContractBalance()" --rpc-url sepolia
  cast send <contract_address> "deposit()" --value 1ether --private-key $PRIVATE_KEY --rpc-url sepolia
  ```

### ğŸ› ï¸ æ¯æ—¥æ£€æŸ¥æ¸…å•
- [ ] **ç¬¬1å¤©**: Node.js ç¯å¢ƒ + VS Code é…ç½®å®Œæˆ
- [ ] **ç¬¬2å¤©**: Hardhat å’Œ Foundry é¡¹ç›®åˆå§‹åŒ–æˆåŠŸ
- [ ] **ç¬¬3å¤©**: MetaMask å®‰è£…å¹¶è¿æ¥æµ‹è¯•ç½‘
- [ ] **ç¬¬4å¤©**: è·å¾—æµ‹è¯• ETHï¼ˆè‡³å°‘ 0.1 ETHï¼‰
- [ ] **ç¬¬5å¤©**: èƒ½ç†Ÿç»ƒä½¿ç”¨ Etherscan æŸ¥çœ‹äº¤æ˜“
- [ ] **ç¬¬6-7å¤©**: æˆåŠŸä½¿ç”¨ Hardhat æˆ– Foundry éƒ¨ç½² Bank åˆçº¦åˆ°æµ‹è¯•ç½‘

### ğŸ“– å­¦ä¹ èµ„æº
- [Node.js å®˜ç½‘](https://nodejs.org/)
- [Hardhat æ–‡æ¡£](https://hardhat.org/docs)
- [Foundry å®˜æ–¹æ–‡æ¡£](https://book.getfoundry.sh/)
- [Foundry GitHub](https://github.com/foundry-rs/foundry)
- [MetaMask å®˜æ–¹æ–‡æ¡£](https://docs.metamask.io/)
- [Sepolia æµ‹è¯•ç½‘ä¿¡æ¯](https://sepolia.dev/)

---

## ğŸ“… ç¬¬2å‘¨ï¼šWeb3.js/Ethers.js åŸºç¡€

### ğŸ¯ æœ¬å‘¨ç›®æ ‡
æŒæ¡ Web3 åº“çš„åŸºæœ¬ä½¿ç”¨ï¼Œèƒ½å¤Ÿè¿æ¥é’±åŒ…å’Œè¯»å–åˆçº¦æ•°æ®

### ğŸ“‹ å­¦ä¹ ä»»åŠ¡

#### ç¬¬1å¤©ï¼šWeb3 åº“é€‰æ‹©å’ŒåŸºç¡€æ¦‚å¿µ
- [ ] **ç†è§£ Web3 åº“çš„ä½œç”¨**
  ```javascript
  // Web3 åº“çš„æ ¸å¿ƒåŠŸèƒ½
  1. è¿æ¥ä»¥å¤ªåŠç½‘ç»œ (Provider)
  2. ç®¡ç†ç”¨æˆ·è´¦æˆ· (Signer)
  3. ä¸æ™ºèƒ½åˆçº¦äº¤äº’ (Contract)
  4. å¤„ç†äº¤æ˜“å’Œäº‹ä»¶ (Transaction/Event)
  ```

- [ ] **Ethers.js vs Web3.js å¯¹æ¯”**
  ```javascript
  // Ethers.js ç‰¹ç‚¹
  - æ¨¡å—åŒ–è®¾è®¡ï¼Œä½“ç§¯æ›´å°
  - TypeScript åŸç”Ÿæ”¯æŒ
  - æ›´ç°ä»£çš„ Promise/async è¯­æ³•
  - æ›´å¥½çš„é”™è¯¯å¤„ç†
  
  // Web3.js ç‰¹ç‚¹  
  - å†å²æ›´æ‚ ä¹…ï¼Œç¤¾åŒºæ›´å¤§
  - æ–‡æ¡£å’Œæ•™ç¨‹æ›´å¤š
  - ä¸ Truffle é›†æˆæ›´å¥½
  ```

- [ ] **å®‰è£…å’Œåˆå§‹åŒ– Ethers.js**
  ```bash
  # åœ¨æ‚¨çš„å‰ç«¯é¡¹ç›®ä¸­å®‰è£…
  cd d:\code\web3\Web3-Practice\bankContract
  npm init -y
  npm install ethers
  ```

#### ç¬¬2å¤©ï¼šProvider å’Œç½‘ç»œè¿æ¥
- [ ] **ç†è§£ Provider æ¦‚å¿µ**
  
  ```javascript
  // Provider æ˜¯è¿æ¥åŒºå—é“¾çš„æ¡¥æ¢
  // å¸¸è§çš„ Provider ç±»å‹ï¼š
  
  // 1. MetaMask Provider (æµè§ˆå™¨é’±åŒ…)
  const provider = new ethers.providers.Web3Provider(window.ethereum);
  
  // 2. JSON-RPC Provider (ç›´è¿èŠ‚ç‚¹)
  const provider = new ethers.providers.JsonRpcProvider("https://sepolia.infura.io/v3/YOUR_KEY");
  
  // 3. Alchemy Provider (ç¬¬ä¸‰æ–¹æœåŠ¡)
  const provider = new ethers.providers.AlchemyProvider("sepolia", "YOUR_API_KEY");
  ```
  
- [ ] **åˆ›å»ºåŸºç¡€è¿æ¥æ–‡ä»¶**
  ```javascript
  // js/web3-connection.js
  class Web3Connection {
    constructor() {
      this.provider = null;
      this.signer = null;
      this.userAddress = null;
    }
  
    // æ£€æµ‹ MetaMask
    async detectMetaMask() {
      if (typeof window.ethereum !== 'undefined') {
        console.log('MetaMask å·²å®‰è£…!');
        return true;
      } else {
        console.log('è¯·å®‰è£… MetaMask!');
        return false;
      }
    }
  
    // è¿æ¥é’±åŒ…
    async connectWallet() {
      try {
        if (!await this.detectMetaMask()) return false;
        
        // è¯·æ±‚è¿æ¥
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        
        // åˆ›å»º provider å’Œ signer
        this.provider = new ethers.providers.Web3Provider(window.ethereum);
        this.signer = this.provider.getSigner();
        this.userAddress = await this.signer.getAddress();
        
        console.log('é’±åŒ…è¿æ¥æˆåŠŸ:', this.userAddress);
        return true;
      } catch (error) {
        console.error('è¿æ¥é’±åŒ…å¤±è´¥:', error);
        return false;
      }
    }
  
    // è·å–ç½‘ç»œä¿¡æ¯
    async getNetworkInfo() {
      if (!this.provider) return null;
      
      const network = await this.provider.getNetwork();
      return {
        name: network.name,
        chainId: network.chainId,
        ensAddress: network.ensAddress
      };
    }
  
    // è·å–ä½™é¢
    async getBalance(address = null) {
      if (!this.provider) return null;
      
      const targetAddress = address || this.userAddress;
      const balance = await this.provider.getBalance(targetAddress);
      return ethers.utils.formatEther(balance);
    }
  }
  
  // å¯¼å‡ºå®ä¾‹
  const web3Connection = new Web3Connection();
  ```

#### ç¬¬3å¤©ï¼šé’±åŒ…è¿æ¥ç•Œé¢å®ç°
- [ ] **åˆ›å»ºç°ä»£åŒ–çš„è¿æ¥ç•Œé¢**
  ```html
  <!-- æ›´æ–° index.html -->
  <!DOCTYPE html>
  <html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é“¶è¡Œåˆçº¦ DApp</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  </head>
  <body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <!-- è¿æ¥çŠ¶æ€æ˜¾ç¤º -->
      <div id="connectionStatus" class="mb-6 p-4 rounded-lg border">
        <div id="disconnected" class="text-center">
          <h2 class="text-xl font-bold mb-4">è¿æ¥æ‚¨çš„é’±åŒ…</h2>
          <button id="connectBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            è¿æ¥ MetaMask
          </button>
        </div>
        
        <div id="connected" class="hidden">
          <div class="flex justify-between items-center">
            <div>
              <p class="text-sm text-gray-600">å·²è¿æ¥åœ°å€:</p>
              <p id="userAddress" class="font-mono text-sm"></p>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-600">ä½™é¢:</p>
              <p id="userBalance" class="font-bold"></p>
            </div>
          </div>
          <div class="mt-2">
            <p class="text-sm text-gray-600">ç½‘ç»œ: <span id="networkName"></span></p>
          </div>
        </div>
      </div>
  
      <!-- åˆçº¦äº¤äº’åŒºåŸŸ -->
      <div id="contractSection" class="hidden">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-lg font-bold mb-4">é“¶è¡Œåˆçº¦äº¤äº’</h3>
          <!-- åˆçº¦å†…å®¹å°†åœ¨åç»­æ·»åŠ  -->
        </div>
      </div>
    </div>
  
    <script src="js/web3-connection.js"></script>
    <script src="js/app.js"></script>
  </body>
  </html>
  ```

- [ ] **å®ç°äº¤äº’é€»è¾‘**
  ```javascript
  // js/app.js
  class BankDApp {
    constructor() {
      this.web3 = web3Connection;
      this.init();
    }
  
    async init() {
      this.bindEvents();
      await this.checkConnection();
    }
  
    bindEvents() {
      document.getElementById('connectBtn').addEventListener('click', () => {
        this.connectWallet();
      });
  
      // ç›‘å¬è´¦æˆ·å˜åŒ–
      if (window.ethereum) {
        window.ethereum.on('accountsChanged', (accounts) => {
          if (accounts.length === 0) {
            this.handleDisconnect();
          } else {
            this.handleAccountChange();
          }
        });
  
        // ç›‘å¬ç½‘ç»œå˜åŒ–
        window.ethereum.on('chainChanged', (chainId) => {
          window.location.reload();
        });
      }
    }
  
    async checkConnection() {
      if (window.ethereum && window.ethereum.selectedAddress) {
        await this.connectWallet();
      }
    }
  
    async connectWallet() {
      const connected = await this.web3.connectWallet();
      if (connected) {
        await this.updateUI();
        this.showConnectedState();
      }
    }
  
    async updateUI() {
      // æ›´æ–°åœ°å€æ˜¾ç¤º
      document.getElementById('userAddress').textContent = this.web3.userAddress;
      
      // æ›´æ–°ä½™é¢
      const balance = await this.web3.getBalance();
      document.getElementById('userBalance').textContent = `${parseFloat(balance).toFixed(4)} ETH`;
      
      // æ›´æ–°ç½‘ç»œä¿¡æ¯
      const network = await this.web3.getNetworkInfo();
      document.getElementById('networkName').textContent = network.name;
    }
  
    showConnectedState() {
      document.getElementById('disconnected').classList.add('hidden');
      document.getElementById('connected').classList.remove('hidden');
      document.getElementById('contractSection').classList.remove('hidden');
    }
  
    handleDisconnect() {
      document.getElementById('disconnected').classList.remove('hidden');
      document.getElementById('connected').classList.add('hidden');
      document.getElementById('contractSection').classList.add('hidden');
    }
  
    async handleAccountChange() {
      await this.web3.connectWallet();
      await this.updateUI();
    }
  }
  
  // åˆå§‹åŒ–åº”ç”¨
  document.addEventListener('DOMContentLoaded', () => {
    new BankDApp();
  });
  ```

#### ç¬¬4å¤©ï¼šåˆçº¦å®ä¾‹åŒ–å’Œ ABI å¤„ç†
- [ ] **ç†è§£ ABI (Application Binary Interface)**
  ```javascript
  // ABI æ˜¯åˆçº¦çš„æ¥å£æè¿°
  // åŒ…å«å‡½æ•°ç­¾åã€å‚æ•°ç±»å‹ã€è¿”å›å€¼ç­‰ä¿¡æ¯
  
  // è·å– ABI çš„æ–¹æ³•ï¼š
  // 1. ä» Hardhat ç¼–è¯‘è¾“å‡ºè·å–
  // 2. ä» Etherscan éªŒè¯åˆçº¦é¡µé¢å¤åˆ¶
  // 3. æ‰‹åŠ¨ç¼–å†™ï¼ˆä¸æ¨èï¼‰
  ```

- [ ] **åˆ›å»ºåˆçº¦ ABI æ–‡ä»¶**
  ```javascript
  // js/bank-abi.js
  const BANK_ABI = [
    {
      "inputs": [],
      "stateMutability": "nonpayable",
      "type": "constructor"
    },
    {
      "anonymous": false,
      "inputs": [
        {
          "indexed": true,
          "internalType": "address",
          "name": "depositor",
          "type": "address"
        },
        {
          "indexed": false,
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "Deposit",
      "type": "event"
    },
    {
      "inputs": [],
      "name": "deposit",
      "outputs": [],
      "stateMutability": "payable",
      "type": "function"
    },
    {
      "inputs": [],
      "name": "getContractBalance",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    },
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "user",
          "type": "address"
        }
      ],
      "name": "getDeposit",
      "outputs": [
        {
          "internalType": "uint256",
          "name": "",
          "type": "uint256"
        }
      ],
      "stateMutability": "view",
      "type": "function"
    }
  ];
  
  // åˆçº¦åœ°å€ (éƒ¨ç½²åè·å¾—)
  const BANK_CONTRACT_ADDRESS = "0x..."; // æ›¿æ¢ä¸ºå®é™…åœ°å€
  ```

- [ ] **å®ç°åˆçº¦äº¤äº’ç±»**
  ```javascript
  // js/bank-contract.js
  class BankContract {
    constructor(web3Connection) {
      this.web3 = web3Connection;
      this.contract = null;
      this.contractAddress = BANK_CONTRACT_ADDRESS;
    }
  
    // åˆå§‹åŒ–åˆçº¦å®ä¾‹
    async init() {
      if (!this.web3.provider) {
        throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…');
      }
  
      // åˆ›å»ºåªè¯»åˆçº¦å®ä¾‹ (ç”¨äºæŸ¥è¯¢)
      this.contract = new ethers.Contract(
        this.contractAddress,
        BANK_ABI,
        this.web3.provider
      );
  
      console.log('åˆçº¦å®ä¾‹åˆ›å»ºæˆåŠŸ');
    }
  
    // è·å–å¯å†™åˆçº¦å®ä¾‹ (ç”¨äºäº¤æ˜“)
    getWritableContract() {
      if (!this.web3.signer) {
        throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…');
      }
  
      return new ethers.Contract(
        this.contractAddress,
        BANK_ABI,
        this.web3.signer
      );
    }
  
    // è¯»å–åˆçº¦æ€»ä½™é¢
    async getContractBalance() {
      try {
        const balance = await this.contract.getContractBalance();
        return ethers.utils.formatEther(balance);
      } catch (error) {
        console.error('è·å–åˆçº¦ä½™é¢å¤±è´¥:', error);
        throw error;
      }
    }
  
    // è¯»å–ç”¨æˆ·å­˜æ¬¾
    async getUserDeposit(address = null) {
      try {
        const userAddress = address || this.web3.userAddress;
        const deposit = await this.contract.getDeposit(userAddress);
        return ethers.utils.formatEther(deposit);
      } catch (error) {
        console.error('è·å–ç”¨æˆ·å­˜æ¬¾å¤±è´¥:', error);
        throw error;
      }
    }
  
    // å­˜æ¬¾æ“ä½œ
    async deposit(amount) {
      try {
        const writableContract = this.getWritableContract();
        const tx = await writableContract.deposit({
          value: ethers.utils.parseEther(amount.toString())
        });
        
        console.log('å­˜æ¬¾äº¤æ˜“å·²å‘é€:', tx.hash);
        return tx;
      } catch (error) {
        console.error('å­˜æ¬¾å¤±è´¥:', error);
        throw error;
      }
    }
  }
  ```

#### ç¬¬5å¤©ï¼šè¯»å–åˆçº¦æ•°æ®å®ç°
- [ ] **å®Œå–„åˆçº¦æ•°æ®æ˜¾ç¤º**
  ```javascript
  // åœ¨ BankDApp ç±»ä¸­æ·»åŠ åˆçº¦ç›¸å…³æ–¹æ³•
  class BankDApp {
    constructor() {
      this.web3 = web3Connection;
      this.bankContract = null;
      this.init();
    }
  
    async init() {
      this.bindEvents();
      await this.checkConnection();
    }
  
    async connectWallet() {
      const connected = await this.web3.connectWallet();
      if (connected) {
        // åˆå§‹åŒ–åˆçº¦
        this.bankContract = new BankContract(this.web3);
        await this.bankContract.init();
        
        await this.updateUI();
        await this.updateContractData();
        this.showConnectedState();
      }
    }
  
    async updateContractData() {
      try {
        // æ›´æ–°åˆçº¦ä½™é¢
        const contractBalance = await this.bankContract.getContractBalance();
        document.getElementById('contractBalance').textContent = `${parseFloat(contractBalance).toFixed(4)} ETH`;
        
        // æ›´æ–°ç”¨æˆ·å­˜æ¬¾
        const userDeposit = await this.bankContract.getUserDeposit();
        document.getElementById('userDeposit').textContent = `${parseFloat(userDeposit).toFixed(4)} ETH`;
        
      } catch (error) {
        console.error('æ›´æ–°åˆçº¦æ•°æ®å¤±è´¥:', error);
      }
    }
  
    // è®¾ç½®å®šæ—¶åˆ·æ–°
    startDataRefresh() {
      setInterval(async () => {
        if (this.bankContract) {
          await this.updateContractData();
        }
      }, 10000); // æ¯10ç§’åˆ·æ–°ä¸€æ¬¡
    }
  }
  ```

#### ç¬¬6-7å¤©ï¼šå®Œæ•´çš„è¯»å–ç•Œé¢å®ç°
- [ ] **å®Œå–„ HTML ç•Œé¢**
  ```html
  <!-- åœ¨ contractSection ä¸­æ·»åŠ æ•°æ®æ˜¾ç¤º -->
  <div id="contractSection" class="hidden">
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h3 class="text-lg font-bold mb-4">åˆçº¦ä¿¡æ¯</h3>
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-blue-50 p-4 rounded">
          <p class="text-sm text-gray-600">åˆçº¦æ€»ä½™é¢</p>
          <p id="contractBalance" class="text-xl font-bold text-blue-600">0 ETH</p>
        </div>
        <div class="bg-green-50 p-4 rounded">
          <p class="text-sm text-gray-600">æˆ‘çš„å­˜æ¬¾</p>
          <p id="userDeposit" class="text-xl font-bold text-green-600">0 ETH</p>
        </div>
      </div>
      <button id="refreshBtn" class="mt-4 bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
        åˆ·æ–°æ•°æ®
      </button>
    </div>
  </div>
  ```

### ğŸ› ï¸ æ¯æ—¥æ£€æŸ¥æ¸…å•
- [ ] **ç¬¬1å¤©**: ç†è§£ Web3 åº“æ¦‚å¿µï¼Œå®Œæˆ Ethers.js å®‰è£…
- [ ] **ç¬¬2å¤©**: æŒæ¡ Provider æ¦‚å¿µï¼Œåˆ›å»ºè¿æ¥ç±»
- [ ] **ç¬¬3å¤©**: å®ç°é’±åŒ…è¿æ¥ç•Œé¢å’ŒåŸºç¡€äº¤äº’
- [ ] **ç¬¬4å¤©**: ç†è§£ ABIï¼Œåˆ›å»ºåˆçº¦å®ä¾‹
- [ ] **ç¬¬5å¤©**: å®ç°åˆçº¦æ•°æ®è¯»å–åŠŸèƒ½
- [ ] **ç¬¬6-7å¤©**: å®Œå–„ç•Œé¢ï¼Œæµ‹è¯•æ‰€æœ‰è¯»å–åŠŸèƒ½

### ğŸ“– å­¦ä¹ èµ„æº
- [Ethers.js å®˜æ–¹æ–‡æ¡£](https://docs.ethers.io/v5/)
- [MetaMask å¼€å‘è€…æ–‡æ¡£](https://docs.metamask.io/guide/)
- [ä»¥å¤ªåŠ JSON-RPC API](https://ethereum.org/en/developers/docs/apis/json-rpc/)

---

## ğŸ“… ç¬¬3å‘¨ï¼šæ”¹è¿›ç°æœ‰é“¶è¡Œåˆçº¦å‰ç«¯

### ğŸ¯ æœ¬å‘¨ç›®æ ‡
å…¨é¢å‡çº§ç°æœ‰çš„é“¶è¡Œåˆçº¦å‰ç«¯ç•Œé¢å’Œäº¤äº’ä½“éªŒ

### ğŸ“‹ å­¦ä¹ ä»»åŠ¡

#### ç¬¬1å¤©ï¼šUI/UX è®¾è®¡è§„åˆ’
- [ ] **åˆ†æç°æœ‰ç•Œé¢é—®é¢˜**
  ```javascript
  // å½“å‰ç•Œé¢å­˜åœ¨çš„é—®é¢˜ï¼š
  1. ç•Œé¢è¿‡äºç®€é™‹ï¼Œç¼ºä¹ç°ä»£æ„Ÿ
  2. æ²¡æœ‰å“åº”å¼è®¾è®¡
  3. ç¼ºä¹åŠ è½½çŠ¶æ€æç¤º
  4. é”™è¯¯å¤„ç†ä¸å¤Ÿå‹å¥½
  5. ç¼ºä¹äº¤äº’åé¦ˆ
  ```

- [ ] **è®¾è®¡æ–°ç•Œé¢ç»“æ„**
  ```html
  <!-- æ–°ç•Œé¢ç»“æ„è§„åˆ’ -->
  <div class="app-container">
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="navbar">
      <div class="logo">Bank DApp</div>
      <div class="wallet-info">é’±åŒ…è¿æ¥çŠ¶æ€</div>
    </header>
    
    <!-- ä¸»è¦å†…å®¹åŒº -->
    <main class="main-content">
      <!-- ç»Ÿè®¡å¡ç‰‡åŒº -->
      <section class="stats-cards">
        <div class="card">åˆçº¦ä½™é¢</div>
        <div class="card">æˆ‘çš„å­˜æ¬¾</div>
        <div class="card">å­˜æ¬¾æ¬¡æ•°</div>
        <div class="card">æ’è¡Œæ¦œä½ç½®</div>
      </section>
      
      <!-- æ“ä½œåŒºåŸŸ -->
      <section class="actions">
        <div class="deposit-form">å­˜æ¬¾è¡¨å•</div>
        <div class="withdraw-form">ææ¬¾è¡¨å•(ç®¡ç†å‘˜)</div>
      </section>
      
      <!-- æ•°æ®å±•ç¤ºåŒº -->
      <section class="data-display">
        <div class="transaction-history">äº¤æ˜“å†å²</div>
        <div class="leaderboard">æ’è¡Œæ¦œ</div>
      </section>
    </main>
  </div>
  ```

- [ ] **é€‰æ‹© CSS æ¡†æ¶**
  ```bash
  # æ¨èä½¿ç”¨ Tailwind CSS
  # CDN æ–¹å¼ï¼ˆå¿«é€Ÿå¼€å§‹ï¼‰
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  
  # æˆ–è€…ä½¿ç”¨ Bootstrap
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  ```

#### ç¬¬2å¤©ï¼šå“åº”å¼å¸ƒå±€å®ç°
- [ ] **åˆ›å»ºæ–°çš„ HTML ç»“æ„**
  ```html
  <!DOCTYPE html>
  <html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é“¶è¡Œåˆçº¦ DApp - ç°ä»£åŒ–ç•Œé¢</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  </head>
  <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg">
      <div class="max-w-7xl mx-auto px-4">
        <div class="flex justify-between items-center py-4">
          <div class="flex items-center">
            <i class="fas fa-university text-2xl text-blue-600 mr-3"></i>
            <h1 class="text-xl font-bold text-gray-800">Bank DApp</h1>
          </div>
          
          <!-- é’±åŒ…è¿æ¥çŠ¶æ€ -->
          <div id="walletStatus">
            <button id="connectWalletBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200">
              <i class="fas fa-wallet mr-2"></i>è¿æ¥é’±åŒ…
            </button>
            
            <div id="walletConnected" class="hidden flex items-center space-x-4">
              <div class="text-right">
                <p class="text-sm text-gray-600">ä½™é¢</p>
                <p id="walletBalance" class="font-bold">0 ETH</p>
              </div>
              <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center">
                <i class="fas fa-user text-white"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>
  
    <!-- ä¸»è¦å†…å®¹ -->
    <main class="max-w-7xl mx-auto px-4 py-8">
      <!-- åŠ è½½çŠ¶æ€ -->
      <div id="loadingScreen" class="text-center py-20">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
        <p class="mt-4 text-gray-600">æ­£åœ¨è¿æ¥åŒºå—é“¾...</p>
      </div>
  
      <!-- åº”ç”¨ä¸»ç•Œé¢ -->
      <div id="appContent" class="hidden">
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-blue-100">
                <i class="fas fa-coins text-blue-600 text-xl"></i>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">åˆçº¦æ€»ä½™é¢</p>
                <p id="contractBalance" class="text-2xl font-bold text-gray-900">0 ETH</p>
              </div>
            </div>
          </div>
  
          <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-green-100">
                <i class="fas fa-piggy-bank text-green-600 text-xl"></i>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">æˆ‘çš„å­˜æ¬¾</p>
                <p id="userDeposit" class="text-2xl font-bold text-gray-900">0 ETH</p>
              </div>
            </div>
          </div>
  
          <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-purple-100">
                <i class="fas fa-chart-line text-purple-600 text-xl"></i>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">å­˜æ¬¾æ¬¡æ•°</p>
                <p id="depositCount" class="text-2xl font-bold text-gray-900">0</p>
              </div>
            </div>
          </div>
  
          <div class="bg-white rounded-xl shadow-md p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-yellow-100">
                <i class="fas fa-trophy text-yellow-600 text-xl"></i>
              </div>
              <div class="ml-4">
                <p class="text-sm font-medium text-gray-600">æ’è¡Œæ¦œ</p>
                <p id="userRank" class="text-2xl font-bold text-gray-900">-</p>
              </div>
            </div>
          </div>
        </div>
  
        <!-- æ“ä½œåŒºåŸŸ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
          <!-- å­˜æ¬¾è¡¨å• -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4">
              <i class="fas fa-plus-circle text-green-600 mr-2"></i>å­˜æ¬¾
            </h3>
            <form id="depositForm">
              <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">å­˜æ¬¾é‡‘é¢ (ETH)</label>
                <div class="relative">
                  <input type="number" id="depositAmount" step="0.001" min="0.001" 
                         class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                         placeholder="è¯·è¾“å…¥å­˜æ¬¾é‡‘é¢">
                  <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                    <span class="text-gray-500 text-sm">ETH</span>
                  </div>
                </div>
              </div>
              <button type="submit" id="depositBtn" 
                      class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                <i class="fas fa-paper-plane mr-2"></i>ç¡®è®¤å­˜æ¬¾
              </button>
            </form>
          </div>
  
          <!-- ç®¡ç†å‘˜ææ¬¾ -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h3 class="text-lg font-bold text-gray-900 mb-4">
              <i class="fas fa-minus-circle text-red-600 mr-2"></i>ç®¡ç†å‘˜ææ¬¾
            </h3>
            <div id="adminSection" class="hidden">
              <form id="withdrawForm">
                <div class="mb-4">
                  <label class="block text-sm font-medium text-gray-700 mb-2">ææ¬¾é‡‘é¢ (ETH)</label>
                  <input type="number" id="withdrawAmount" step="0.001" min="0.001"
                         class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                         placeholder="è¯·è¾“å…¥ææ¬¾é‡‘é¢">
                </div>
                <button type="submit" id="withdrawBtn"
                        class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                  <i class="fas fa-money-bill-wave mr-2"></i>ç¡®è®¤ææ¬¾
                </button>
              </form>
            </div>
            <div id="notAdmin" class="text-center py-8">
              <i class="fas fa-lock text-gray-400 text-3xl mb-4"></i>
              <p class="text-gray-500">ä»…ç®¡ç†å‘˜å¯æ“ä½œ</p>
            </div>
          </div>
        </div>
      </div>
    </main>
  
    <!-- é€šçŸ¥ç»„ä»¶ -->
    <div id="notifications" class="fixed top-4 right-4 z-50"></div>
  
    <!-- æ¨¡æ€æ¡† -->
    <div id="transactionModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
      <div class="bg-white rounded-lg p-6 m-4 max-w-md w-full">
        <div class="text-center">
          <div id="modalSpinner" class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <h3 id="modalTitle" class="text-lg font-bold mb-2">å¤„ç†äº¤æ˜“ä¸­...</h3>
          <p id="modalMessage" class="text-gray-600 mb-4">è¯·åœ¨é’±åŒ…ä¸­ç¡®è®¤äº¤æ˜“</p>
          <div id="modalActions" class="hidden">
            <button id="modalClose" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
              å…³é—­
            </button>
          </div>
        </div>
      </div>
    </div>
  
    <script src="js/web3-connection.js"></script>
    <script src="js/bank-abi.js"></script>
    <script src="js/bank-contract.js"></script>
    <script src="js/ui-components.js"></script>
    <script src="js/app.js"></script>
  </body>
  </html>
  ```

#### ç¬¬3å¤©ï¼šäº¤äº’ç»„ä»¶å¼€å‘
- [ ] **åˆ›å»º UI ç»„ä»¶ç±»**
  ```javascript
  // js/ui-components.js
  class UIComponents {
    // æ˜¾ç¤ºé€šçŸ¥
    static showNotification(message, type = 'info', duration = 5000) {
      const notification = document.createElement('div');
      notification.className = `notification ${type} transform transition-all duration-300 translate-x-full`;
      
      const bgColor = {
        'success': 'bg-green-500',
        'error': 'bg-red-500',
        'warning': 'bg-yellow-500',
        'info': 'bg-blue-500'
      }[type];
      
      notification.innerHTML = `
        <div class="${bgColor} text-white px-6 py-4 rounded-lg shadow-lg mb-4 flex items-center">
          <i class="fas fa-${this.getIcon(type)} mr-3"></i>
          <span>${message}</span>
          <button class="ml-auto text-white hover:text-gray-200" onclick="this.parentElement.parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      document.getElementById('notifications').appendChild(notification);
      
      // åŠ¨ç”»æ˜¾ç¤º
      setTimeout(() => {
        notification.classList.remove('translate-x-full');
      }, 100);
      
      // è‡ªåŠ¨éšè—
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => notification.remove(), 300);
      }, duration);
    }
    
    static getIcon(type) {
      const icons = {
        'success': 'check-circle',
        'error': 'exclamation-circle',
        'warning': 'exclamation-triangle',
        'info': 'info-circle'
      };
      return icons[type] || 'info-circle';
    }
    
    // æ˜¾ç¤ºåŠ è½½æ¨¡æ€æ¡†
    static showTransactionModal(title, message) {
      const modal = document.getElementById('transactionModal');
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalMessage').textContent = message;
      document.getElementById('modalSpinner').classList.remove('hidden');
      document.getElementById('modalActions').classList.add('hidden');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }
    
    // æ›´æ–°æ¨¡æ€æ¡†çŠ¶æ€
    static updateTransactionModal(title, message, showActions = false) {
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalMessage').textContent = message;
      
      if (showActions) {
        document.getElementById('modalSpinner').classList.add('hidden');
        document.getElementById('modalActions').classList.remove('hidden');
      }
    }
    
    // éšè—æ¨¡æ€æ¡†
    static hideTransactionModal() {
      const modal = document.getElementById('transactionModal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
    
    // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
    static updateStatsCard(cardId, value, animated = true) {
      const element = document.getElementById(cardId);
      if (animated) {
        element.classList.add('animate-pulse');
        setTimeout(() => {
          element.textContent = value;
          element.classList.remove('animate-pulse');
        }, 200);
      } else {
        element.textContent = value;
      }
    }
    
    // è®¾ç½®æŒ‰é’®åŠ è½½çŠ¶æ€
    static setButtonLoading(buttonId, loading = true) {
      const button = document.getElementById(buttonId);
      const originalText = button.dataset.originalText || button.innerHTML;
      
      if (loading) {
        button.dataset.originalText = originalText;
        button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>å¤„ç†ä¸­...';
        button.disabled = true;
      } else {
        button.innerHTML = originalText;
        button.disabled = false;
      }
    }
    
    // è¡¨å•éªŒè¯
    static validateForm(formId) {
      const form = document.getElementById(formId);
      const inputs = form.querySelectorAll('input[required]');
      let isValid = true;
      
      inputs.forEach(input => {
        if (!input.value.trim()) {
          this.showFieldError(input, 'æ­¤å­—æ®µä¸ºå¿…å¡«é¡¹');
          isValid = false;
        } else {
          this.clearFieldError(input);
        }
      });
      
      return isValid;
    }
    
    static showFieldError(input, message) {
      input.classList.add('border-red-500');
      let errorElement = input.parentNode.querySelector('.field-error');
      if (!errorElement) {
        errorElement = document.createElement('p');
        errorElement.className = 'field-error text-red-500 text-sm mt-1';
        input.parentNode.appendChild(errorElement);
      }
      errorElement.textContent = message;
    }
    
    static clearFieldError(input) {
      input.classList.remove('border-red-500');
      const errorElement = input.parentNode.querySelector('.field-error');
      if (errorElement) {
        errorElement.remove();
      }
    }
  }
  
  // ç»‘å®šæ¨¡æ€æ¡†å…³é—­äº‹ä»¶
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('modalClose').addEventListener('click', () => {
      UIComponents.hideTransactionModal();
    });
  });
  ```

#### ç¬¬4å¤©ï¼šå®æ—¶æ•°æ®æ›´æ–°æœºåˆ¶
- [ ] **å®ç°æ•°æ®åˆ·æ–°ç®¡ç†å™¨**
  ```javascript
  // js/data-manager.js
  class DataManager {
    constructor(bankContract, web3Connection) {
      this.bankContract = bankContract;
      this.web3 = web3Connection;
      this.refreshInterval = null;
      this.refreshRate = 15000; // 15ç§’åˆ·æ–°ä¸€æ¬¡
      this.isRefreshing = false;
    }
    
    // å¼€å§‹è‡ªåŠ¨åˆ·æ–°
    startAutoRefresh() {
      this.refreshInterval = setInterval(() => {
        this.refreshAllData();
      }, this.refreshRate);
      
      // ç«‹å³åˆ·æ–°ä¸€æ¬¡
      this.refreshAllData();
    }
    
    // åœæ­¢è‡ªåŠ¨åˆ·æ–°
    stopAutoRefresh() {
      if (this.refreshInterval) {
        clearInterval(this.refreshInterval);
        this.refreshInterval = null;
      }
    }
    
    // åˆ·æ–°æ‰€æœ‰æ•°æ®
    async refreshAllData() {
      if (this.isRefreshing) return;
      
      this.isRefreshing = true;
      try {
        await Promise.all([
          this.updateContractBalance(),
          this.updateUserDeposit(),
          this.updateUserBalance(),
          this.updateDepositCount(),
          this.updateUserRank()
        ]);
      } catch (error) {
        console.error('æ•°æ®åˆ·æ–°å¤±è´¥:', error);
      } finally {
        this.isRefreshing = false;
      }
    }
    
    // æ›´æ–°åˆçº¦ä½™é¢
    async updateContractBalance() {
      try {
        const balance = await this.bankContract.getContractBalance();
        UIComponents.updateStatsCard('contractBalance', `${parseFloat(balance).toFixed(4)} ETH`);
      } catch (error) {
        console.error('æ›´æ–°åˆçº¦ä½™é¢å¤±è´¥:', error);
      }
    }
    
    // æ›´æ–°ç”¨æˆ·å­˜æ¬¾
    async updateUserDeposit() {
      try {
        const deposit = await this.bankContract.getUserDeposit();
        UIComponents.updateStatsCard('userDeposit', `${parseFloat(deposit).toFixed(4)} ETH`);
      } catch (error) {
        console.error('æ›´æ–°ç”¨æˆ·å­˜æ¬¾å¤±è´¥:', error);
      }
    }
    
    // æ›´æ–°ç”¨æˆ·ä½™é¢
    async updateUserBalance() {
      try {
        const balance = await this.web3.getBalance();
        UIComponents.updateStatsCard('walletBalance', `${parseFloat(balance).toFixed(4)} ETH`);
      } catch (error) {
        console.error('æ›´æ–°ç”¨æˆ·ä½™é¢å¤±è´¥:', error);
      }
    }
    
    // æ›´æ–°å­˜æ¬¾æ¬¡æ•°ï¼ˆé€šè¿‡äº‹ä»¶æ—¥å¿—ï¼‰
    async updateDepositCount() {
      try {
        const filter = this.bankContract.contract.filters.Deposit(this.web3.userAddress);
        const events = await this.bankContract.contract.queryFilter(filter);
        UIComponents.updateStatsCard('depositCount', events.length.toString());
      } catch (error) {
        console.error('æ›´æ–°å­˜æ¬¾æ¬¡æ•°å¤±è´¥:', error);
        UIComponents.updateStatsCard('depositCount', '0');
      }
    }
    
    // æ›´æ–°ç”¨æˆ·æ’å
    async updateUserRank() {
      try {
        // è¿™é‡Œéœ€è¦æ ¹æ®æ‚¨çš„åˆçº¦å®ç°æ¥è·å–æ’è¡Œæ¦œ
        // å¦‚æœåˆçº¦æœ‰ getTopDepositors å‡½æ•°
        const topDepositors = await this.bankContract.getTopDepositors();
        const userAddress = this.web3.userAddress.toLowerCase();
        
        let rank = '-';
        for (let i = 0; i < topDepositors.length; i++) {
          if (topDepositors[i].toLowerCase() === userAddress) {
            rank = `#${i + 1}`;
            break;
          }
        }
        
        UIComponents.updateStatsCard('userRank', rank);
      } catch (error) {
        console.error('æ›´æ–°ç”¨æˆ·æ’åå¤±è´¥:', error);
        UIComponents.updateStatsCard('userRank', '-');
      }
    }
    
    // æ‰‹åŠ¨åˆ·æ–°
    async manualRefresh() {
      UIComponents.showNotification('æ­£åœ¨åˆ·æ–°æ•°æ®...', 'info', 2000);
      await this.refreshAllData();
      UIComponents.showNotification('æ•°æ®åˆ·æ–°å®Œæˆ', 'success', 3000);
    }
  }
  ```

#### ç¬¬5å¤©ï¼šè¡¨å•å¤„ç†å’ŒéªŒè¯
- [ ] **å®Œå–„è¡¨å•äº¤äº’é€»è¾‘**
  ```javascript
  // åœ¨ app.js ä¸­æ·»åŠ è¡¨å•å¤„ç†
  class BankDApp {
    constructor() {
      this.web3 = web3Connection;
      this.bankContract = null;
      this.dataManager = null;
      this.init();
    }
    
    async init() {
      this.bindEvents();
      await this.checkConnection();
    }
    
    bindEvents() {
      // é’±åŒ…è¿æ¥
      document.getElementById('connectWalletBtn').addEventListener('click', () => {
        this.connectWallet();
      });
      
      // å­˜æ¬¾è¡¨å•
      document.getElementById('depositForm').addEventListener('submit', (e) => {
        e.preventDefault();
        this.handleDeposit();
      });
      
      // ææ¬¾è¡¨å•
      document.getElementById('withdrawForm').addEventListener('submit', (e) => {
        e.preventDefault();
        this.handleWithdraw();
      });
      
      // ç›‘å¬é’±åŒ…äº‹ä»¶
      if (window.ethereum) {
        window.ethereum.on('accountsChanged', (accounts) => {
          if (accounts.length === 0) {
            this.handleDisconnect();
          } else {
            this.handleAccountChange();
          }
        });
        
        window.ethereum.on('chainChanged', () => {
          window.location.reload();
        });
      }
    }
    
    async handleDeposit() {
      try {
        // è¡¨å•éªŒè¯
        const amount = document.getElementById('depositAmount').value;
        if (!amount || parseFloat(amount) <= 0) {
          UIComponents.showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„å­˜æ¬¾é‡‘é¢', 'error');
          return;
        }
        
        // ä½™é¢æ£€æŸ¥
        const userBalance = await this.web3.getBalance();
        if (parseFloat(amount) > parseFloat(userBalance)) {
          UIComponents.showNotification('ä½™é¢ä¸è¶³', 'error');
          return;
        }
        
        // æ˜¾ç¤ºäº¤æ˜“æ¨¡æ€æ¡†
        UIComponents.showTransactionModal('ç¡®è®¤å­˜æ¬¾', 'è¯·åœ¨é’±åŒ…ä¸­ç¡®è®¤äº¤æ˜“');
        UIComponents.setButtonLoading('depositBtn', true);
        
        // æ‰§è¡Œå­˜æ¬¾
        const tx = await this.bankContract.deposit(amount);
        
        UIComponents.updateTransactionModal('äº¤æ˜“å·²å‘é€', `äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`);
        
        // ç­‰å¾…ç¡®è®¤
        const receipt = await tx.wait();
        
        UIComponents.updateTransactionModal(
          'å­˜æ¬¾æˆåŠŸ!', 
          `å­˜æ¬¾ ${amount} ETH å·²ç¡®è®¤`, 
          true
        );
        
        // æ¸…ç©ºè¡¨å•
        document.getElementById('depositAmount').value = '';
        
        // åˆ·æ–°æ•°æ®
        await this.dataManager.refreshAllData();
        
        UIComponents.showNotification(`æˆåŠŸå­˜æ¬¾ ${amount} ETH`, 'success');
        
      } catch (error) {
        console.error('å­˜æ¬¾å¤±è´¥:', error);
        
        let errorMessage = 'å­˜æ¬¾å¤±è´¥';
        if (error.code === 4001) {
          errorMessage = 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“';
        } else if (error.message.includes('insufficient funds')) {
          errorMessage = 'ä½™é¢ä¸è¶³';
        }
        
        UIComponents.updateTransactionModal('å­˜æ¬¾å¤±è´¥', errorMessage, true);
        UIComponents.showNotification(errorMessage, 'error');
      } finally {
        UIComponents.setButtonLoading('depositBtn', false);
      }
    }
    
    async handleWithdraw() {
      try {
        const amount = document.getElementById('withdrawAmount').value;
        if (!amount || parseFloat(amount) <= 0) {
          UIComponents.showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„ææ¬¾é‡‘é¢', 'error');
          return;
        }
        
        UIComponents.showTransactionModal('ç¡®è®¤ææ¬¾', 'è¯·åœ¨é’±åŒ…ä¸­ç¡®è®¤äº¤æ˜“');
        UIComponents.setButtonLoading('withdrawBtn', true);
        
        const tx = await this.bankContract.withdraw(amount);
        
        UIComponents.updateTransactionModal('äº¤æ˜“å·²å‘é€', `äº¤æ˜“å“ˆå¸Œ: ${tx.hash}`);
        
        const receipt = await tx.wait();
        
        UIComponents.updateTransactionModal(
          'ææ¬¾æˆåŠŸ!', 
          `ææ¬¾ ${amount} ETH å·²ç¡®è®¤`, 
          true
        );
        
        document.getElementById('withdrawAmount').value = '';
        await this.dataManager.refreshAllData();
        
        UIComponents.showNotification(`æˆåŠŸææ¬¾ ${amount} ETH`, 'success');
        
      } catch (error) {
        console.error('ææ¬¾å¤±è´¥:', error);
        
        let errorMessage = 'ææ¬¾å¤±è´¥';
        if (error.code === 4001) {
          errorMessage = 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“';
        } else if (error.message.includes('Only admin')) {
          errorMessage = 'åªæœ‰ç®¡ç†å‘˜å¯ä»¥ææ¬¾';
        }
        
        UIComponents.updateTransactionModal('ææ¬¾å¤±è´¥', errorMessage, true);
        UIComponents.showNotification(errorMessage, 'error');
      } finally {
        UIComponents.setButtonLoading('withdrawBtn', false);
      }
    }
    
    async connectWallet() {
      try {
        document.getElementById('loadingScreen').classList.remove('hidden');
        
        const connected = await this.web3.connectWallet();
        if (connected) {
          // åˆå§‹åŒ–åˆçº¦
          this.bankContract = new BankContract(this.web3);
          await this.bankContract.init();
          
          // åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
          this.dataManager = new DataManager(this.bankContract, this.web3);
          
          // æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜
          await this.checkAdminStatus();
          
          // æ˜¾ç¤ºè¿æ¥çŠ¶æ€
          this.showConnectedState();
          
          // å¼€å§‹æ•°æ®åˆ·æ–°
          this.dataManager.startAutoRefresh();
          
          UIComponents.showNotification('é’±åŒ…è¿æ¥æˆåŠŸ', 'success');
        }
      } catch (error) {
        console.error('è¿æ¥å¤±è´¥:', error);
        UIComponents.showNotification('é’±åŒ…è¿æ¥å¤±è´¥', 'error');
      } finally {
        document.getElementById('loadingScreen').classList.add('hidden');
      }
    }
    
    async checkAdminStatus() {
      try {
        const isAdmin = await this.bankContract.isAdmin(this.web3.userAddress);
        if (isAdmin) {
          document.getElementById('adminSection').classList.remove('hidden');
          document.getElementById('notAdmin').classList.add('hidden');
        }
      } catch (error) {
        console.error('æ£€æŸ¥ç®¡ç†å‘˜çŠ¶æ€å¤±è´¥:', error);
      }
    }
    
    showConnectedState() {
      document.getElementById('connectWalletBtn').classList.add('hidden');
      document.getElementById('walletConnected').classList.remove('hidden');
      document.getElementById('appContent').classList.remove('hidden');
      
      // æ˜¾ç¤ºç”¨æˆ·åœ°å€ï¼ˆç®€åŒ–æ˜¾ç¤ºï¼‰
      const address = this.web3.userAddress;
      const shortAddress = `${address.slice(0, 6)}...${address.slice(-4)}`;
      document.querySelector('#walletConnected .fa-user').parentElement.title = address;
    }
  }
  
  // åˆå§‹åŒ–åº”ç”¨
  document.addEventListener('DOMContentLoaded', () => {
    new BankDApp();
  });
  ```

#### ç¬¬6-7å¤©ï¼šé”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] **å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶**
  ```javascript
  // js/error-handler.js
  class ErrorHandler {
    static handleWeb3Error(error) {
      console.error('Web3 é”™è¯¯:', error);
      
      let userMessage = 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•';
      
      // å¸¸è§é”™è¯¯ç±»å‹å¤„ç†
      if (error.code === 4001) {
        userMessage = 'ç”¨æˆ·å–æ¶ˆäº†æ“ä½œ';
      } else if (error.code === -32602) {
        userMessage = 'å‚æ•°é”™è¯¯';
      } else if (error.message.includes('insufficient funds')) {
        userMessage = 'ä½™é¢ä¸è¶³';
      } else if (error.message.includes('gas required exceeds allowance')) {
        userMessage = 'Gas è´¹ç”¨ä¸è¶³';
      } else if (error.message.includes('nonce too low')) {
        userMessage = 'äº¤æ˜“åºå·é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢';
      } else if (error.message.includes('network')) {
        userMessage = 'ç½‘ç»œè¿æ¥é”™è¯¯';
      }
      
      UIComponents.showNotification(userMessage, 'error');
      return userMessage;
    }
    
    static handleContractError(error, operation) {
      console.error(`åˆçº¦æ“ä½œ ${operation} å¤±è´¥:`, error);
      
      let userMessage = `${operation}å¤±è´¥`;
      
      if (error.message.includes('Only admin')) {
        userMessage = 'åªæœ‰ç®¡ç†å‘˜å¯ä»¥æ‰§è¡Œæ­¤æ“ä½œ';
      } else if (error.message.includes('Insufficient balance')) {
        userMessage = 'åˆçº¦ä½™é¢ä¸è¶³';
      }
      
      UIComponents.showNotification(userMessage, 'error');
      return userMessage;
    }
  }
  ```

### ğŸ› ï¸ æ¯æ—¥æ£€æŸ¥æ¸…å•
- [ ] **ç¬¬1å¤©**: å®Œæˆç•Œé¢è®¾è®¡è§„åˆ’å’Œæ¡†æ¶é€‰æ‹©
- [ ] **ç¬¬2å¤©**: å®ç°å“åº”å¼å¸ƒå±€å’ŒåŸºç¡€ç»„ä»¶
- [ ] **ç¬¬3å¤©**: å¼€å‘äº¤äº’ç»„ä»¶å’Œé€šçŸ¥ç³»ç»Ÿ
- [ ] **ç¬¬4å¤©**: å®ç°å®æ—¶æ•°æ®æ›´æ–°æœºåˆ¶
- [ ] **ç¬¬5å¤©**: å®Œå–„è¡¨å•å¤„ç†å’ŒéªŒè¯é€»è¾‘
- [ ] **ç¬¬6-7å¤©**: ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒ

### ğŸ“– å­¦ä¹ èµ„æº
- [Tailwind CSS æ–‡æ¡£](https://tailwindcss.com/docs)
- [Font Awesome å›¾æ ‡åº“](https://fontawesome.com/icons)
- [Web3 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ](https://docs.metamask.io/guide/ethereum-provider.html#errors)

---

## ğŸ“… ç¬¬4å‘¨ï¼šäº‹ä»¶ç›‘å¬å’ŒçŠ¶æ€ç®¡ç†

### ğŸ¯ æœ¬å‘¨ç›®æ ‡
æ·±å…¥å­¦ä¹ åˆçº¦äº‹ä»¶ç›‘å¬æœºåˆ¶å’Œå‰ç«¯çŠ¶æ€ç®¡ç†

### ğŸ“‹ å­¦ä¹ ä»»åŠ¡

#### ç¬¬1å¤©ï¼šç†è§£äº‹ä»¶æœºåˆ¶å’ŒåŸºç¡€ç›‘å¬
- [ ] **å­¦ä¹ äº‹ä»¶æœºåˆ¶åŸç†**
  ```javascript
  // äº‹ä»¶åŸºç¡€æ¦‚å¿µ
  /*
  1. äº‹ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ
     - åˆçº¦æ‰§è¡Œè¿‡ç¨‹ä¸­å‘å‡ºçš„ä¿¡å·
     - è®°å½•åœ¨åŒºå—é“¾æ—¥å¿—ä¸­
     - å¯ä»¥è¢«å‰ç«¯ç›‘å¬å’Œå¤„ç†
  
  2. äº‹ä»¶çš„ä½œç”¨ï¼š
     - é€šçŸ¥å‰ç«¯çŠ¶æ€å˜åŒ–
     - è®°å½•é‡è¦æ“ä½œå†å²
     - é™ä½æŸ¥è¯¢æˆæœ¬
     - å®ç°å®æ—¶æ›´æ–°
  
  3. äº‹ä»¶ç±»å‹ï¼š
     - indexed å‚æ•°ï¼šå¯ä»¥ç”¨äºè¿‡æ»¤
     - non-indexed å‚æ•°ï¼šå­˜å‚¨è¯¦ç»†æ•°æ®
  */
  
  // Bank.sol ä¸­çš„äº‹ä»¶ç¤ºä¾‹
  event Deposit(address indexed user, uint256 amount, uint256 timestamp);
  event Withdraw(address indexed admin, uint256 amount, uint256 timestamp);
  event TopDepositorsUpdated(address[3] topDepositors);
  ```

- [ ] **å®ç°åŸºç¡€äº‹ä»¶ç›‘å¬**
  ```javascript
  // js/event-listener.js
  class EventListener {
    constructor(bankContract, web3Connection) {
      this.contract = bankContract.contract;
      this.web3 = web3Connection;
      this.listeners = new Map();
      this.isListening = false;
    }
    
    // å¼€å§‹ç›‘å¬æ‰€æœ‰äº‹ä»¶
    async startListening() {
      if (this.isListening) return;
      
      try {
        // ç›‘å¬å­˜æ¬¾äº‹ä»¶
        this.listenToDeposits();
        
        // ç›‘å¬ææ¬¾äº‹ä»¶
        this.listenToWithdrawals();
        
        // ç›‘å¬æ’è¡Œæ¦œæ›´æ–°
        this.listenToLeaderboardUpdates();
        
        this.isListening = true;
        console.log('äº‹ä»¶ç›‘å¬å·²å¯åŠ¨');
        
      } catch (error) {
        console.error('å¯åŠ¨äº‹ä»¶ç›‘å¬å¤±è´¥:', error);
      }
    }
    
    // ç›‘å¬å­˜æ¬¾äº‹ä»¶
    listenToDeposits() {
      const depositFilter = this.contract.filters.Deposit();
      
      this.contract.on(depositFilter, (user, amount, timestamp, event) => {
        console.log('æ£€æµ‹åˆ°å­˜æ¬¾äº‹ä»¶:', {
          user,
          amount: ethers.utils.formatEther(amount),
          timestamp: new Date(timestamp * 1000),
          txHash: event.transactionHash
        });
        
        // å¤„ç†å­˜æ¬¾äº‹ä»¶
        this.handleDepositEvent(user, amount, timestamp, event);
      });
      
      console.log('å­˜æ¬¾äº‹ä»¶ç›‘å¬å·²å¯åŠ¨');
    }
    
    // ç›‘å¬ææ¬¾äº‹ä»¶
    listenToWithdrawals() {
      const withdrawFilter = this.contract.filters.Withdraw();
      
      this.contract.on(withdrawFilter, (admin, amount, timestamp, event) => {
        console.log('æ£€æµ‹åˆ°ææ¬¾äº‹ä»¶:', {
          admin,
          amount: ethers.utils.formatEther(amount),
          timestamp: new Date(timestamp * 1000),
          txHash: event.transactionHash
        });
        
        // å¤„ç†ææ¬¾äº‹ä»¶
        this.handleWithdrawEvent(admin, amount, timestamp, event);
      });
      
      console.log('ææ¬¾äº‹ä»¶ç›‘å¬å·²å¯åŠ¨');
    }
    
    // ç›‘å¬æ’è¡Œæ¦œæ›´æ–°
    listenToLeaderboardUpdates() {
      const leaderboardFilter = this.contract.filters.TopDepositorsUpdated();
      
      this.contract.on(leaderboardFilter, (topDepositors, event) => {
        console.log('æ£€æµ‹åˆ°æ’è¡Œæ¦œæ›´æ–°:', {
          topDepositors,
          txHash: event.transactionHash
        });
        
        // å¤„ç†æ’è¡Œæ¦œæ›´æ–°
        this.handleLeaderboardUpdate(topDepositors, event);
      });
      
      console.log('æ’è¡Œæ¦œäº‹ä»¶ç›‘å¬å·²å¯åŠ¨');
    }
    
    // å¤„ç†å­˜æ¬¾äº‹ä»¶
    handleDepositEvent(user, amount, timestamp, event) {
      const amountEth = ethers.utils.formatEther(amount);
      const userAddress = this.web3.userAddress.toLowerCase();
      
      // å¦‚æœæ˜¯å½“å‰ç”¨æˆ·çš„å­˜æ¬¾
      if (user.toLowerCase() === userAddress) {
        UIComponents.showNotification(
          `å­˜æ¬¾æˆåŠŸï¼é‡‘é¢ï¼š${parseFloat(amountEth).toFixed(4)} ETH`, 
          'success'
        );
        
        // æ›´æ–°ç”¨æˆ·æ•°æ®
        this.updateUserStats();
      } else {
        // å…¶ä»–ç”¨æˆ·çš„å­˜æ¬¾
        UIComponents.showNotification(
          `æœ‰æ–°çš„å­˜æ¬¾ï¼š${parseFloat(amountEth).toFixed(4)} ETH`, 
          'info', 
          3000
        );
      }
      
      // æ›´æ–°åˆçº¦æ€»ä½™é¢
      this.updateContractBalance();
      
      // è®°å½•åˆ°äº¤æ˜“å†å²
      this.addToTransactionHistory({
        type: 'deposit',
        user,
        amount: amountEth,
        timestamp,
        txHash: event.transactionHash
      });
    }
    
    // å¤„ç†ææ¬¾äº‹ä»¶
    handleWithdrawEvent(admin, amount, timestamp, event) {
      const amountEth = ethers.utils.formatEther(amount);
      
      UIComponents.showNotification(
        `ç®¡ç†å‘˜ææ¬¾ï¼š${parseFloat(amountEth).toFixed(4)} ETH`, 
        'warning'
      );
      
      // æ›´æ–°åˆçº¦ä½™é¢
      this.updateContractBalance();
      
      // è®°å½•åˆ°äº¤æ˜“å†å²
      this.addToTransactionHistory({
        type: 'withdraw',
        admin,
        amount: amountEth,
        timestamp,
        txHash: event.transactionHash
      });
    }
    
    // å¤„ç†æ’è¡Œæ¦œæ›´æ–°
    handleLeaderboardUpdate(topDepositors, event) {
      UIComponents.showNotification('æ’è¡Œæ¦œå·²æ›´æ–°', 'info', 2000);
      
      // æ›´æ–°æ’è¡Œæ¦œæ˜¾ç¤º
      this.updateLeaderboardDisplay(topDepositors);
      
      // æ£€æŸ¥å½“å‰ç”¨æˆ·æ’åå˜åŒ–
      this.checkUserRankChange(topDepositors);
    }
    
    // åœæ­¢ç›‘å¬
    stopListening() {
      if (!this.isListening) return;
      
      // ç§»é™¤æ‰€æœ‰ç›‘å¬å™¨
      this.contract.removeAllListeners();
      this.isListening = false;
      
      console.log('äº‹ä»¶ç›‘å¬å·²åœæ­¢');
    }
  }
  ```

#### ç¬¬2å¤©ï¼šå†å²äº‹ä»¶æŸ¥è¯¢å’Œæ•°æ®å¤„ç†
- [ ] **å®ç°å†å²äº‹ä»¶æŸ¥è¯¢**
  ```javascript
  // æ‰©å±• EventListener ç±»
  class EventListener {
    // ... å‰é¢çš„ä»£ç  ...
    
    // æŸ¥è¯¢å†å²å­˜æ¬¾äº‹ä»¶
    async getDepositHistory(userAddress = null, fromBlock = 0) {
      try {
        let filter;
        
        if (userAddress) {
          // æŸ¥è¯¢ç‰¹å®šç”¨æˆ·çš„å­˜æ¬¾å†å²
          filter = this.contract.filters.Deposit(userAddress);
        } else {
          // æŸ¥è¯¢æ‰€æœ‰å­˜æ¬¾å†å²
          filter = this.contract.filters.Deposit();
        }
        
        const events = await this.contract.queryFilter(filter, fromBlock);
        
        return events.map(event => ({
          user: event.args.user,
          amount: ethers.utils.formatEther(event.args.amount),
          timestamp: new Date(event.args.timestamp * 1000),
          txHash: event.transactionHash,
          blockNumber: event.blockNumber
        }));
        
      } catch (error) {
        console.error('æŸ¥è¯¢å­˜æ¬¾å†å²å¤±è´¥:', error);
        return [];
      }
    }
    
    // æŸ¥è¯¢å†å²ææ¬¾äº‹ä»¶
    async getWithdrawHistory(fromBlock = 0) {
      try {
        const filter = this.contract.filters.Withdraw();
        const events = await this.contract.queryFilter(filter, fromBlock);
        
        return events.map(event => ({
          admin: event.args.admin,
          amount: ethers.utils.formatEther(event.args.amount),
          timestamp: new Date(event.args.timestamp * 1000),
          txHash: event.transactionHash,
          blockNumber: event.blockNumber
        }));
        
      } catch (error) {
        console.error('æŸ¥è¯¢ææ¬¾å†å²å¤±è´¥:', error);
        return [];
      }
    }
    
    // è·å–ç”¨æˆ·å®Œæ•´äº¤æ˜“å†å²
    async getUserTransactionHistory(userAddress) {
      try {
        const [deposits, withdrawals] = await Promise.all([
          this.getDepositHistory(userAddress),
          this.getWithdrawHistory()
        ]);
        
        // åˆå¹¶å¹¶æŒ‰æ—¶é—´æ’åº
        const allTransactions = [
          ...deposits.map(tx => ({ ...tx, type: 'deposit' })),
          ...withdrawals
            .filter(tx => tx.admin.toLowerCase() === userAddress.toLowerCase())
            .map(tx => ({ ...tx, type: 'withdraw' }))
        ];
        
        return allTransactions.sort((a, b) => b.timestamp - a.timestamp);
        
      } catch (error) {
        console.error('è·å–ç”¨æˆ·äº¤æ˜“å†å²å¤±è´¥:', error);
        return [];
      }
    }
    
    // è·å–ç»Ÿè®¡æ•°æ®
    async getStatistics() {
      try {
        const [deposits, withdrawals] = await Promise.all([
          this.getDepositHistory(),
          this.getWithdrawHistory()
        ]);
        
        const totalDeposits = deposits.reduce((sum, tx) => 
          sum + parseFloat(tx.amount), 0
        );
        
        const totalWithdrawals = withdrawals.reduce((sum, tx) => 
          sum + parseFloat(tx.amount), 0
        );
        
        return {
          totalTransactions: deposits.length + withdrawals.length,
          totalDeposits: totalDeposits.toFixed(4),
          totalWithdrawals: totalWithdrawals.toFixed(4),
          netBalance: (totalDeposits - totalWithdrawals).toFixed(4),
          uniqueUsers: new Set(deposits.map(tx => tx.user)).size
        };
        
      } catch (error) {
        console.error('è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
        return null;
      }
    }
  }
  ```

#### ç¬¬3å¤©ï¼šäº¤æ˜“çŠ¶æ€è·Ÿè¸ªç³»ç»Ÿ
- [ ] **å®ç°äº¤æ˜“çŠ¶æ€ç®¡ç†å™¨**
  ```javascript
  // js/transaction-tracker.js
  class TransactionTracker {
    constructor() {
      this.pendingTransactions = new Map();
      this.completedTransactions = new Map();
      this.failedTransactions = new Map();
    }
    
    // æ·»åŠ å¾…å¤„ç†äº¤æ˜“
    addPendingTransaction(txHash, type, details) {
      const transaction = {
        hash: txHash,
        type,
        details,
        status: 'pending',
        timestamp: Date.now(),
        confirmations: 0,
        estimatedTime: this.estimateConfirmationTime()
      };
      
      this.pendingTransactions.set(txHash, transaction);
      
      // æ˜¾ç¤ºäº¤æ˜“çŠ¶æ€
      this.showTransactionStatus(transaction);
      
      // å¼€å§‹è·Ÿè¸ª
      this.trackTransaction(txHash);
      
      return transaction;
    }
    
    // è·Ÿè¸ªäº¤æ˜“çŠ¶æ€
    async trackTransaction(txHash) {
      try {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        
        // ç­‰å¾…äº¤æ˜“ç¡®è®¤
        const receipt = await provider.waitForTransaction(txHash, 1);
        
        if (receipt.status === 1) {
          // äº¤æ˜“æˆåŠŸ
          this.handleTransactionSuccess(txHash, receipt);
        } else {
          // äº¤æ˜“å¤±è´¥
          this.handleTransactionFailure(txHash, receipt);
        }
        
      } catch (error) {
        console.error('è·Ÿè¸ªäº¤æ˜“å¤±è´¥:', error);
        this.handleTransactionError(txHash, error);
      }
    }
    
    // å¤„ç†äº¤æ˜“æˆåŠŸ
    handleTransactionSuccess(txHash, receipt) {
      const transaction = this.pendingTransactions.get(txHash);
      if (!transaction) return;
      
      // æ›´æ–°äº¤æ˜“çŠ¶æ€
      transaction.status = 'confirmed';
      transaction.confirmations = 1;
      transaction.gasUsed = receipt.gasUsed.toString();
      transaction.blockNumber = receipt.blockNumber;
      
      // ç§»åŠ¨åˆ°å·²å®Œæˆåˆ—è¡¨
      this.completedTransactions.set(txHash, transaction);
      this.pendingTransactions.delete(txHash);
      
      // æ›´æ–°UI
      this.updateTransactionUI(transaction);
      
      // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
      UIComponents.showNotification(
        `${this.getTransactionTypeText(transaction.type)}æˆåŠŸç¡®è®¤`, 
        'success'
      );
    }
    
    // å¤„ç†äº¤æ˜“å¤±è´¥
    handleTransactionFailure(txHash, receipt) {
      const transaction = this.pendingTransactions.get(txHash);
      if (!transaction) return;
      
      transaction.status = 'failed';
      transaction.error = 'äº¤æ˜“æ‰§è¡Œå¤±è´¥';
      
      // ç§»åŠ¨åˆ°å¤±è´¥åˆ—è¡¨
      this.failedTransactions.set(txHash, transaction);
      this.pendingTransactions.delete(txHash);
      
      // æ›´æ–°UI
      this.updateTransactionUI(transaction);
      
      // æ˜¾ç¤ºå¤±è´¥é€šçŸ¥
      UIComponents.showNotification(
        `${this.getTransactionTypeText(transaction.type)}å¤±è´¥`, 
        'error'
      );
    }
    
    // å¤„ç†äº¤æ˜“é”™è¯¯
    handleTransactionError(txHash, error) {
      const transaction = this.pendingTransactions.get(txHash);
      if (!transaction) return;
      
      transaction.status = 'error';
      transaction.error = error.message;
      
      this.failedTransactions.set(txHash, transaction);
      this.pendingTransactions.delete(txHash);
      
      this.updateTransactionUI(transaction);
      
      UIComponents.showNotification(
        `${this.getTransactionTypeText(transaction.type)}å‡ºé”™`, 
        'error'
      );
    }
    
    // æ˜¾ç¤ºäº¤æ˜“çŠ¶æ€
    showTransactionStatus(transaction) {
      const statusHtml = `
        <div id="tx-${transaction.hash}" class="transaction-status bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
              <div>
                <p class="font-medium text-gray-900">${this.getTransactionTypeText(transaction.type)}å¤„ç†ä¸­</p>
                <p class="text-sm text-gray-600">äº¤æ˜“å“ˆå¸Œ: ${transaction.hash.slice(0, 10)}...</p>
              </div>
            </div>
            <div class="text-right">
              <p class="text-sm text-gray-600">é¢„è®¡æ—¶é—´</p>
              <p class="font-medium">${transaction.estimatedTime}</p>
            </div>
          </div>
          <div class="mt-3">
            <div class="bg-blue-200 rounded-full h-2">
              <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 10%"></div>
            </div>
          </div>
        </div>
      `;
      
      // æ·»åŠ åˆ°äº¤æ˜“çŠ¶æ€å®¹å™¨
      const container = document.getElementById('transactionStatusContainer') || this.createStatusContainer();
      container.insertAdjacentHTML('afterbegin', statusHtml);
    }
    
    // æ›´æ–°äº¤æ˜“UI
    updateTransactionUI(transaction) {
      const element = document.getElementById(`tx-${transaction.hash}`);
      if (!element) return;
      
      let statusClass, statusText, progressWidth;
      
      switch (transaction.status) {
        case 'confirmed':
          statusClass = 'bg-green-50 border-green-200';
          statusText = `${this.getTransactionTypeText(transaction.type)}æˆåŠŸ`;
          progressWidth = '100%';
          break;
        case 'failed':
        case 'error':
          statusClass = 'bg-red-50 border-red-200';
          statusText = `${this.getTransactionTypeText(transaction.type)}å¤±è´¥`;
          progressWidth = '100%';
          break;
      }
      
      element.className = `transaction-status ${statusClass} rounded-lg p-4 mb-4`;
      element.querySelector('.font-medium').textContent = statusText;
      element.querySelector('.bg-blue-600').style.width = progressWidth;
      
      // ç§»é™¤åŠ è½½åŠ¨ç”»
      const spinner = element.querySelector('.animate-spin');
      if (spinner && transaction.status !== 'pending') {
        spinner.remove();
      }
      
      // 3ç§’åè‡ªåŠ¨éšè—æˆåŠŸçš„äº¤æ˜“
      if (transaction.status === 'confirmed') {
        setTimeout(() => {
          element.style.opacity = '0';
          setTimeout(() => element.remove(), 300);
        }, 3000);
      }
    }
    
    // åˆ›å»ºçŠ¶æ€å®¹å™¨
    createStatusContainer() {
      const container = document.createElement('div');
      container.id = 'transactionStatusContainer';
      container.className = 'fixed bottom-4 right-4 w-96 z-50';
      document.body.appendChild(container);
      return container;
    }
    
    // è·å–äº¤æ˜“ç±»å‹æ–‡æœ¬
    getTransactionTypeText(type) {
      const types = {
        'deposit': 'å­˜æ¬¾',
        'withdraw': 'ææ¬¾',
        'transfer': 'è½¬è´¦'
      };
      return types[type] || 'äº¤æ˜“';
    }
    
    // ä¼°ç®—ç¡®è®¤æ—¶é—´
    estimateConfirmationTime() {
      // åŸºäºå½“å‰ç½‘ç»œçŠ¶å†µä¼°ç®—
      return '1-2 åˆ†é’Ÿ';
    }
    
    // è·å–æ‰€æœ‰å¾…å¤„ç†äº¤æ˜“
    getPendingTransactions() {
      return Array.from(this.pendingTransactions.values());
    }
    
    // è·å–äº¤æ˜“å†å²
    getTransactionHistory() {
      return [
        ...Array.from(this.completedTransactions.values()),
        ...Array.from(this.failedTransactions.values())
      ].sort((a, b) => b.timestamp - a.timestamp);
    }
  }
  ```

#### ç¬¬4å¤©ï¼šæœ¬åœ°æ•°æ®å­˜å‚¨å’Œç¼“å­˜
- [ ] **å®ç°æ•°æ®ç¼“å­˜ç®¡ç†å™¨**
  ```javascript
  // js/cache-manager.js
  class CacheManager {
    constructor() {
      this.dbName = 'BankDAppCache';
      this.dbVersion = 1;
      this.db = null;
      this.init();
    }
    
    // åˆå§‹åŒ– IndexedDB
    async init() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(this.dbName, this.dbVersion);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
          this.db = request.result;
          resolve();
        };
        
        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          
          // åˆ›å»ºäº¤æ˜“å†å²å­˜å‚¨
          if (!db.objectStoreNames.contains('transactions')) {
            const txStore = db.createObjectStore('transactions', { keyPath: 'txHash' });
            txStore.createIndex('userAddress', 'userAddress', { unique: false });
            txStore.createIndex('timestamp', 'timestamp', { unique: false });
            txStore.createIndex('type', 'type', { unique: false });
          }
          
          // åˆ›å»ºç”¨æˆ·æ•°æ®å­˜å‚¨
          if (!db.objectStoreNames.contains('userData')) {
            db.createObjectStore('userData', { keyPath: 'address' });
          }
          
          // åˆ›å»ºåˆçº¦çŠ¶æ€å­˜å‚¨
          if (!db.objectStoreNames.contains('contractState')) {
            db.createObjectStore('contractState', { keyPath: 'key' });
          }
        };
      });
    }
    
    // ç¼“å­˜äº¤æ˜“æ•°æ®
    async cacheTransaction(transaction) {
      if (!this.db) await this.init();
      
      const tx = this.db.transaction(['transactions'], 'readwrite');
      const store = tx.objectStore('transactions');
      
      await store.put({
        txHash: transaction.txHash,
        userAddress: transaction.user || transaction.admin,
        type: transaction.type,
        amount: transaction.amount,
        timestamp: transaction.timestamp,
        blockNumber: transaction.blockNumber,
        cachedAt: Date.now()
      });
    }
    
    // è·å–ç¼“å­˜çš„äº¤æ˜“å†å²
    async getCachedTransactions(userAddress, limit = 50) {
      if (!this.db) await this.init();
      
      return new Promise((resolve, reject) => {
        const tx = this.db.transaction(['transactions'], 'readonly');
        const store = tx.objectStore('transactions');
        const index = store.index('userAddress');
        
        const request = index.getAll(userAddress);
        
        request.onsuccess = () => {
          const transactions = request.result
            .sort((a, b) => b.timestamp - a.timestamp)
            .slice(0, limit);
          resolve(transactions);
        };
        
        request.onerror = () => reject(request.error);
      });
    }
    
    // ç¼“å­˜ç”¨æˆ·æ•°æ®
    async cacheUserData(address, data) {
      if (!this.db) await this.init();
      
      const tx = this.db.transaction(['userData'], 'readwrite');
      const store = tx.objectStore('userData');
      
      await store.put({
        address,
        ...data,
        cachedAt: Date.now()
      });
    }
    
    // è·å–ç¼“å­˜çš„ç”¨æˆ·æ•°æ®
    async getCachedUserData(address) {
      if (!this.db) await this.init();
      
      return new Promise((resolve, reject) => {
        const tx = this.db.transaction(['userData'], 'readonly');
        const store = tx.objectStore('userData');
        const request = store.get(address);
        
        request.onsuccess = () => {
          const data = request.result;
          // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼ˆ5åˆ†é’Ÿï¼‰
          if (data && Date.now() - data.cachedAt < 5 * 60 * 1000) {
            resolve(data);
          } else {
            resolve(null);
          }
        };
        
        request.onerror = () => reject(request.error);
      });
    }
    
    // ç¼“å­˜åˆçº¦çŠ¶æ€
    async cacheContractState(key, value) {
      if (!this.db) await this.init();
      
      const tx = this.db.transaction(['contractState'], 'readwrite');
      const store = tx.objectStore('contractState');
      
      await store.put({
        key,
        value,
        cachedAt: Date.now()
      });
    }
    
    // è·å–ç¼“å­˜çš„åˆçº¦çŠ¶æ€
    async getCachedContractState(key) {
      if (!this.db) await this.init();
      
      return new Promise((resolve, reject) => {
        const tx = this.db.transaction(['contractState'], 'readonly');
        const store = tx.objectStore('contractState');
        const request = store.get(key);
        
        request.onsuccess = () => {
          const data = request.result;
          // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼ˆ1åˆ†é’Ÿï¼‰
          if (data && Date.now() - data.cachedAt < 60 * 1000) {
            resolve(data.value);
          } else {
            resolve(null);
          }
        };
        
        request.onerror = () => reject(request.error);
      });
    }
    
    // æ¸…ç†è¿‡æœŸç¼“å­˜
    async cleanExpiredCache() {
      if (!this.db) await this.init();
      
      const stores = ['transactions', 'userData', 'contractState'];
      const expireTime = 24 * 60 * 60 * 1000; // 24å°æ—¶
      
      for (const storeName of stores) {
        const tx = this.db.transaction([storeName], 'readwrite');
        const store = tx.objectStore('store');
        const request = store.getAll();
        
        request.onsuccess = () => {
          const items = request.result;
          items.forEach(item => {
            if (Date.now() - item.cachedAt > expireTime) {
              store.delete(item.key || item.txHash || item.address);
            }
          });
        };
      }
    }
  }
  ```

#### ç¬¬5å¤©ï¼šçŠ¶æ€ç®¡ç†å’Œæ•°æ®åŒæ­¥
- [ ] **å®ç°çŠ¶æ€ç®¡ç†å™¨**
  ```javascript
  // js/state-manager.js
  class StateManager {
    constructor() {
      this.state = {
        user: {
          address: null,
          balance: '0',
          deposit: '0',
          isAdmin: false,
          rank: null
        },
        contract: {
          balance: '0',
          totalDepositors: 0,
          topDepositors: []
        },
        ui: {
          isConnected: false,
          isLoading: false,
          currentView: 'dashboard'
        },
        transactions: {
          pending: [],
          history: []
        }
      };
      
      this.listeners = new Map();
      this.cacheManager = new CacheManager();
    }
    
    // è®¢é˜…çŠ¶æ€å˜åŒ–
    subscribe(key, callback) {
      if (!this.listeners.has(key)) {
        this.listeners.set(key, []);
      }
      this.listeners.get(key).push(callback);
      
      // è¿”å›å–æ¶ˆè®¢é˜…å‡½æ•°
      return () => {
        const callbacks = this.listeners.get(key);
        const index = callbacks.indexOf(callback);
        if (index > -1) {
          callbacks.splice(index, 1);
        }
      };
    }
    
    // æ›´æ–°çŠ¶æ€
    setState(key, value) {
      const keys = key.split('.');
      let current = this.state;
      
      // å¯¼èˆªåˆ°ç›®æ ‡ä½ç½®
      for (let i = 0; i < keys.length - 1; i++) {
        if (!current[keys[i]]) {
          current[keys[i]] = {};
        }
        current = current[keys[i]];
      }
      
      // è®¾ç½®å€¼
      const lastKey = keys[keys.length - 1];
      const oldValue = current[lastKey];
      current[lastKey] = value;
      
      // é€šçŸ¥ç›‘å¬å™¨
      this.notifyListeners(key, value, oldValue);
      
      // ç¼“å­˜é‡è¦æ•°æ®
      this.cacheImportantData(key, value);
    }
    
    // è·å–çŠ¶æ€
    getState(key) {
      const keys = key.split('.');
      let current = this.state;
      
      for (const k of keys) {
        if (current[k] === undefined) {
          return undefined;
        }
        current = current[k];
      }
      
      return current;
    }
    
    // é€šçŸ¥ç›‘å¬å™¨
    notifyListeners(key, newValue, oldValue) {
      const callbacks = this.listeners.get(key) || [];
      callbacks.forEach(callback => {
        try {
          callback(newValue, oldValue);
        } catch (error) {
          console.error('çŠ¶æ€ç›‘å¬å™¨æ‰§è¡Œå¤±è´¥:', error);
        }
      });
    }
    
    // ç¼“å­˜é‡è¦æ•°æ®
    async cacheImportantData(key, value) {
      try {
        if (key.startsWith('user.')) {
          await this.cacheManager.cacheUserData(
            this.state.user.address, 
            this.state.user
          );
        } else if (key.startsWith('contract.')) {
          await this.cacheManager.cacheContractState(key, value);
        }
      } catch (error) {
        console.error('ç¼“å­˜æ•°æ®å¤±è´¥:', error);
      }
    }
    
    // ä»ç¼“å­˜åŠ è½½æ•°æ®
    async loadFromCache(userAddress) {
      try {
        // åŠ è½½ç”¨æˆ·æ•°æ®
        const cachedUserData = await this.cacheManager.getCachedUserData(userAddress);
        if (cachedUserData) {
          Object.keys(cachedUserData).forEach(key => {
            if (key !== 'address' && key !== 'cachedAt') {
              this.setState(`user.${key}`, cachedUserData[key]);
            }
          });
        }
        
        // åŠ è½½åˆçº¦çŠ¶æ€
        const contractBalance = await this.cacheManager.getCachedContractState('contract.balance');
        if (contractBalance) {
          this.setState('contract.balance', contractBalance);
        }
        
        // åŠ è½½äº¤æ˜“å†å²
        const cachedTransactions = await this.cacheManager.getCachedTransactions(userAddress);
        if (cachedTransactions.length > 0) {
          this.setState('transactions.history', cachedTransactions);
        }
        
      } catch (error) {
        console.error('ä»ç¼“å­˜åŠ è½½æ•°æ®å¤±è´¥:', error);
      }
    }
    
    // æ‰¹é‡æ›´æ–°çŠ¶æ€
    batchUpdate(updates) {
      Object.entries(updates).forEach(([key, value]) => {
        this.setState(key, value);
      });
    }
    
    // é‡ç½®çŠ¶æ€
    reset() {
      this.state = {
        user: {
          address: null,
          balance: '0',
          deposit: '0',
          isAdmin: false,
          rank: null
        },
        contract: {
          balance: '0',
          totalDepositors: 0,
          topDepositors: []
        },
        ui: {
          isConnected: false,
          isLoading: false,
          currentView: 'dashboard'
        },
        transactions: {
          pending: [],
          history: []
        }
      };
      
      // é€šçŸ¥æ‰€æœ‰ç›‘å¬å™¨
      this.listeners.forEach((callbacks, key) => {
        callbacks.forEach(callback => {
          try {
            callback(this.getState(key), null);
          } catch (error) {
            console.error('é‡ç½®çŠ¶æ€é€šçŸ¥å¤±è´¥:', error);
          }
        });
      });
    }
  }
  ```

#### ç¬¬6-7å¤©ï¼šé›†æˆå’Œä¼˜åŒ–
- [ ] **æ•´åˆæ‰€æœ‰ç»„ä»¶**
  ```javascript
  // js/enhanced-app.js
  class EnhancedBankDApp {
    constructor() {
      this.web3 = web3Connection;
      this.bankContract = null;
      this.eventListener = null;
      this.transactionTracker = new TransactionTracker();
      this.stateManager = new StateManager();
      this.dataManager = null;
      
      this.init();
    }
    
    async init() {
      // ç»‘å®šçŠ¶æ€ç›‘å¬å™¨
      this.bindStateListeners();
      
      // ç»‘å®šäº‹ä»¶
      this.bindEvents();
      
      // æ£€æŸ¥è¿æ¥çŠ¶æ€
      await this.checkConnection();
    }
    
    // ç»‘å®šçŠ¶æ€ç›‘å¬å™¨
    bindStateListeners() {
      // ç›‘å¬è¿æ¥çŠ¶æ€å˜åŒ–
      this.stateManager.subscribe('ui.isConnected', (isConnected) => {
        if (isConnected) {
          this.showConnectedState();
        } else {
          this.showDisconnectedState();
        }
      });
      
      // ç›‘å¬ç”¨æˆ·ä½™é¢å˜åŒ–
      this.stateManager.subscribe('user.balance', (balance) => {
        UIComponents.updateStatsCard('walletBalance', `${parseFloat(balance).toFixed(4)} ETH`);
      });
      
      // ç›‘å¬ç”¨æˆ·å­˜æ¬¾å˜åŒ–
      this.stateManager.subscribe('user.deposit', (deposit) => {
        UIComponents.updateStatsCard('userDeposit', `${parseFloat(deposit).toFixed(4)} ETH`);
      });
      
      // ç›‘å¬åˆçº¦ä½™é¢å˜åŒ–
      this.stateManager.subscribe('contract.balance', (balance) => {
        UIComponents.updateStatsCard('contractBalance', `${parseFloat(balance).toFixed(4)} ETH`);
      });
      
      // ç›‘å¬ç”¨æˆ·æ’åå˜åŒ–
      this.stateManager.subscribe('user.rank', (rank) => {
        UIComponents.updateStatsCard('userRank', rank || '-');
      });
    }
    
    // è¿æ¥é’±åŒ…ï¼ˆå¢å¼ºç‰ˆï¼‰
    async connectWallet() {
      try {
        this.stateManager.setState('ui.isLoading', true);
        
        const connected = await this.web3.connectWallet();
        if (connected) {
          const userAddress = this.web3.userAddress;
          this.stateManager.setState('user.address', userAddress);
          
          // ä»ç¼“å­˜åŠ è½½æ•°æ®
          await this.stateManager.loadFromCache(userAddress);
          
          // åˆå§‹åŒ–åˆçº¦
          this.bankContract = new BankContract(this.web3);
          await this.bankContract.init();
          
          // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
          this.eventListener = new EventListener(this.bankContract, this.web3);
          await this.eventListener.startListening();
          
          // åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
          this.dataManager = new DataManager(this.bankContract, this.web3, this.stateManager);
          
          // æ£€æŸ¥ç®¡ç†å‘˜çŠ¶æ€
          await this.checkAdminStatus();
          
          // å¼€å§‹æ•°æ®åˆ·æ–°
          this.dataManager.startAutoRefresh();
          
          // æ›´æ–°è¿æ¥çŠ¶æ€
          this.stateManager.setState('ui.isConnected', true);
          
          UIComponents.showNotification('é’±åŒ…è¿æ¥æˆåŠŸ', 'success');
        }
      } catch (error) {
        console.error('è¿æ¥å¤±è´¥:', error);
        UIComponents.showNotification('é’±åŒ…è¿æ¥å¤±è´¥', 'error');
      } finally {
        this.stateManager.setState('ui.isLoading', false);
      }
    }
    
    // å¤„ç†å­˜æ¬¾ï¼ˆå¢å¼ºç‰ˆï¼‰
    async handleDeposit() {
      try {
        const amount = document.getElementById('depositAmount').value;
        if (!amount || parseFloat(amount) <= 0) {
          UIComponents.showNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„å­˜æ¬¾é‡‘é¢', 'error');
          return;
        }
        
        // ä½™é¢æ£€æŸ¥
        const userBalance = this.stateManager.getState('user.balance');
        if (parseFloat(amount) > parseFloat(userBalance)) {
          UIComponents.showNotification('ä½™é¢ä¸è¶³', 'error');
          return;
        }
        
        UIComponents.setButtonLoading('depositBtn', true);
        
        // æ‰§è¡Œå­˜æ¬¾
        const tx = await this.bankContract.deposit(amount);
        
        // æ·»åŠ åˆ°äº¤æ˜“è·Ÿè¸ªå™¨
        this.transactionTracker.addPendingTransaction(tx.hash, 'deposit', {
          amount,
          userAddress: this.stateManager.getState('user.address')
        });
        
        // ä¹è§‚æ›´æ–°ï¼ˆé¢„æœŸæˆåŠŸï¼‰
        const currentDeposit = parseFloat(this.stateManager.getState('user.deposit'));
        this.stateManager.setState('user.deposit', (currentDeposit + parseFloat(amount)).toString());
        
        // æ¸…ç©ºè¡¨å•
        document.getElementById('depositAmount').value = '';
        
        UIComponents.showNotification(`å­˜æ¬¾äº¤æ˜“å·²å‘é€ï¼Œç­‰å¾…ç¡®è®¤...`, 'info');
        
      } catch (error) {
        console.error('å­˜æ¬¾å¤±è´¥:', error);
        
        let errorMessage = 'å­˜æ¬¾å¤±è´¥';
        if (error.code === 4001) {
          errorMessage = 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“';
        } else if (error.message.includes('insufficient funds')) {
          errorMessage = 'ä½™é¢ä¸è¶³';
        }
        
        UIComponents.showNotification(errorMessage, 'error');
      } finally {
        UIComponents.setButtonLoading('depositBtn', false);
      }
    }
  }
  
  // åˆå§‹åŒ–å¢å¼ºç‰ˆåº”ç”¨
  document.addEventListener('DOMContentLoaded', () => {
    new EnhancedBankDApp();
  });
  ```

### ğŸ› ï¸ æ¯æ—¥æ£€æŸ¥æ¸…å•
- [ ] **ç¬¬1å¤©**: ç†è§£äº‹ä»¶æœºåˆ¶ï¼Œå®ç°åŸºç¡€äº‹ä»¶ç›‘å¬
- [ ] **ç¬¬2å¤©**: å®ç°å†å²äº‹ä»¶æŸ¥è¯¢å’Œæ•°æ®å¤„ç†
- [ ] **ç¬¬3å¤©**: å¼€å‘äº¤æ˜“çŠ¶æ€è·Ÿè¸ªç³»ç»Ÿ
- [ ] **ç¬¬4å¤©**: å®ç°æœ¬åœ°æ•°æ®å­˜å‚¨å’Œç¼“å­˜æœºåˆ¶
- [ ] **ç¬¬5å¤©**: å¼€å‘çŠ¶æ€ç®¡ç†å’Œæ•°æ®åŒæ­¥
- [ ] **ç¬¬6-7å¤©**: æ•´åˆæ‰€æœ‰ç»„ä»¶ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

### ğŸ“– å­¦ä¹ èµ„æº
- [Ethers.js äº‹ä»¶æ–‡æ¡£](https://docs.ethers.io/v5/concepts/events/)
- [IndexedDB API æŒ‡å—](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API)
- [Web3 äº‹ä»¶ç›‘å¬æœ€ä½³å®è·µ](https://ethereum.org/en/developers/tutorials/)

---

## ğŸ“… ç¬¬5å‘¨ï¼šé«˜çº§äº¤äº’åŠŸèƒ½

### ğŸ¯ æœ¬å‘¨ç›®æ ‡
å®ç°é«˜çº§åˆçº¦äº¤äº’åŠŸèƒ½ã€æ€§èƒ½ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒæå‡

### ğŸ“‹ å­¦ä¹ ä»»åŠ¡

#### ç¬¬1å¤©ï¼šæ‰¹é‡æ“ä½œå’Œå¹¶å‘å¤„ç†
- [ ] **å®ç°æ‰¹é‡æŸ¥è¯¢ç³»ç»Ÿ**
  ```javascript
  // js/batch-operations.js
  class BatchOperations {
    constructor(bankContract, web3Connection) {
      this.contract = bankContract.contract;
      this.web3 = web3Connection;
      this.batchSize = 10; // æ¯æ‰¹å¤„ç†çš„æ•°é‡
      this.concurrentLimit = 5; // å¹¶å‘é™åˆ¶
    }
    
    // æ‰¹é‡æŸ¥è¯¢ç”¨æˆ·å­˜æ¬¾
    async batchQueryDeposits(addresses) {
      try {
        const batches = this.createBatches(addresses, this.batchSize);
        const results = [];
        
        for (const batch of batches) {
          const batchPromises = batch.map(async (address) => {
            try {
              const deposit = await this.contract.deposits(address);
              return {
                address,
                deposit: ethers.utils.formatEther(deposit),
                success: true
              };
            } catch (error) {
              console.error(`æŸ¥è¯¢ ${address} å¤±è´¥:`, error);
              return {
                address,
                deposit: '0',
                success: false,
                error: error.message
              };
            }
          });
          
          const batchResults = await Promise.all(batchPromises);
          results.push(...batchResults);
          
          // æ‰¹æ¬¡é—´å»¶è¿Ÿï¼Œé¿å…è¿‡äºé¢‘ç¹çš„è¯·æ±‚
          if (batches.indexOf(batch) < batches.length - 1) {
            await this.delay(100);
          }
        }
        
        return results;
      } catch (error) {
        console.error('æ‰¹é‡æŸ¥è¯¢å¤±è´¥:', error);
        return [];
      }
    }
    
    // æ‰¹é‡æŸ¥è¯¢ä½™é¢
    async batchQueryBalances(addresses) {
      try {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const batches = this.createBatches(addresses, this.batchSize);
        const results = [];
        
        for (const batch of batches) {
          const batchPromises = batch.map(async (address) => {
            try {
              const balance = await provider.getBalance(address);
              return {
                address,
                balance: ethers.utils.formatEther(balance),
                success: true
              };
            } catch (error) {
              return {
                address,
                balance: '0',
                success: false,
                error: error.message
              };
            }
          });
          
          const batchResults = await Promise.all(batchPromises);
          results.push(...batchResults);
          
          await this.delay(100);
        }
        
        return results;
      } catch (error) {
        console.error('æ‰¹é‡æŸ¥è¯¢ä½™é¢å¤±è´¥:', error);
        return [];
      }
    }
    
    // æ‰¹é‡æŸ¥è¯¢äº¤æ˜“å†å²
    async batchQueryTransactionHistory(addresses, fromBlock = 0) {
      try {
        const results = new Map();
        
        // ä½¿ç”¨å¹¶å‘é™åˆ¶
        const semaphore = new Semaphore(this.concurrentLimit);
        
        const promises = addresses.map(async (address) => {
          await semaphore.acquire();
          
          try {
            const [deposits, withdrawals] = await Promise.all([
              this.getDepositHistory(address, fromBlock),
              this.getWithdrawHistory(address, fromBlock)
            ]);
            
            const allTransactions = [
              ...deposits.map(tx => ({ ...tx, type: 'deposit' })),
              ...withdrawals.map(tx => ({ ...tx, type: 'withdraw' }))
            ].sort((a, b) => b.timestamp - a.timestamp);
            
            results.set(address, allTransactions);
            
          } catch (error) {
            console.error(`æŸ¥è¯¢ ${address} äº¤æ˜“å†å²å¤±è´¥:`, error);
            results.set(address, []);
          } finally {
            semaphore.release();
          }
        });
        
        await Promise.all(promises);
        return results;
        
      } catch (error) {
        console.error('æ‰¹é‡æŸ¥è¯¢äº¤æ˜“å†å²å¤±è´¥:', error);
        return new Map();
      }
    }
    
    // åˆ›å»ºæ‰¹æ¬¡
    createBatches(array, batchSize) {
      const batches = [];
      for (let i = 0; i < array.length; i += batchSize) {
        batches.push(array.slice(i, i + batchSize));
      }
      return batches;
    }
    
    // å»¶è¿Ÿå‡½æ•°
    delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // è·å–å­˜æ¬¾å†å²ï¼ˆå•ä¸ªåœ°å€ï¼‰
    async getDepositHistory(address, fromBlock) {
      const filter = this.contract.filters.Deposit(address);
      const events = await this.contract.queryFilter(filter, fromBlock);
      
      return events.map(event => ({
        user: event.args.user,
        amount: ethers.utils.formatEther(event.args.amount),
        timestamp: new Date(event.args.timestamp * 1000),
        txHash: event.transactionHash,
        blockNumber: event.blockNumber
      }));
    }
    
    // è·å–ææ¬¾å†å²ï¼ˆå•ä¸ªåœ°å€ï¼‰
    async getWithdrawHistory(address, fromBlock) {
      const filter = this.contract.filters.Withdraw(address);
      const events = await this.contract.queryFilter(filter, fromBlock);
      
      return events.map(event => ({
        admin: event.args.admin,
        amount: ethers.utils.formatEther(event.args.amount),
        timestamp: new Date(event.args.timestamp * 1000),
        txHash: event.transactionHash,
        blockNumber: event.blockNumber
      }));
    }
  }
  
  // ä¿¡å·é‡ç±»ï¼Œç”¨äºæ§åˆ¶å¹¶å‘
  class Semaphore {
    constructor(maxConcurrency) {
      this.maxConcurrency = maxConcurrency;
      this.currentConcurrency = 0;
      this.queue = [];
    }
    
    async acquire() {
      return new Promise((resolve) => {
        if (this.currentConcurrency < this.maxConcurrency) {
          this.currentConcurrency++;
          resolve();
        } else {
          this.queue.push(resolve);
        }
      });
    }
    
    release() {
      this.currentConcurrency--;
      if (this.queue.length > 0) {
        const resolve = this.queue.shift();
        this.currentConcurrency++;
        resolve();
      }
    }
  }
  ```

#### ç¬¬2å¤©ï¼šGas ä¼˜åŒ–å’Œè´¹ç”¨ä¼°ç®—
- [ ] **å®ç° Gas ç®¡ç†ç³»ç»Ÿ**
  ```javascript
  // js/gas-manager.js
  class GasManager {
    constructor(web3Connection) {
      this.web3 = web3Connection;
      this.provider = new ethers.providers.Web3Provider(window.ethereum);
      this.gasCache = new Map();
      this.gasPriceHistory = [];
    }
    
    // è·å–å½“å‰ Gas ä»·æ ¼
    async getCurrentGasPrice() {
      try {
        const gasPrice = await this.provider.getGasPrice();
        const gasPriceGwei = ethers.utils.formatUnits(gasPrice, 'gwei');
        
        // ç¼“å­˜ Gas ä»·æ ¼å†å²
        this.gasPriceHistory.push({
          price: parseFloat(gasPriceGwei),
          timestamp: Date.now()
        });
        
        // åªä¿ç•™æœ€è¿‘1å°æ—¶çš„æ•°æ®
        const oneHourAgo = Date.now() - 60 * 60 * 1000;
        this.gasPriceHistory = this.gasPriceHistory.filter(
          item => item.timestamp > oneHourAgo
        );
        
        return {
          wei: gasPrice,
          gwei: gasPriceGwei,
          formatted: `${parseFloat(gasPriceGwei).toFixed(2)} Gwei`
        };
        
      } catch (error) {
        console.error('è·å– Gas ä»·æ ¼å¤±è´¥:', error);
        return null;
      }
    }
    
    // ä¼°ç®—äº¤æ˜“ Gas è´¹ç”¨
    async estimateTransactionCost(contract, method, params = [], value = '0') {
      try {
        const cacheKey = `${method}-${JSON.stringify(params)}-${value}`;
        
        // æ£€æŸ¥ç¼“å­˜
        if (this.gasCache.has(cacheKey)) {
          const cached = this.gasCache.get(cacheKey);
          if (Date.now() - cached.timestamp < 5 * 60 * 1000) { // 5åˆ†é’Ÿç¼“å­˜
            return cached.data;
          }
        }
        
        // ä¼°ç®— Gas é™åˆ¶
        const gasLimit = await contract.estimateGas[method](...params, {
          value: ethers.utils.parseEther(value)
        });
        
        // è·å–å½“å‰ Gas ä»·æ ¼
        const gasPriceInfo = await this.getCurrentGasPrice();
        if (!gasPriceInfo) throw new Error('æ— æ³•è·å– Gas ä»·æ ¼');
        
        // è®¡ç®—è´¹ç”¨
        const gasCost = gasLimit.mul(gasPriceInfo.wei);
        const gasCostEth = ethers.utils.formatEther(gasCost);
        
        // æ·»åŠ å®‰å…¨è¾¹è·ï¼ˆ20%ï¼‰
        const safeGasLimit = gasLimit.mul(120).div(100);
        const safeCost = safeGasLimit.mul(gasPriceInfo.wei);
        const safeCostEth = ethers.utils.formatEther(safeCost);
        
        const result = {
          gasLimit: gasLimit.toString(),
          safeGasLimit: safeGasLimit.toString(),
          gasPrice: gasPriceInfo,
          estimatedCost: {
            wei: gasCost.toString(),
            eth: gasCostEth,
            formatted: `${parseFloat(gasCostEth).toFixed(6)} ETH`
          },
          safeCost: {
            wei: safeCost.toString(),
            eth: safeCostEth,
            formatted: `${parseFloat(safeCostEth).toFixed(6)} ETH`
          }
        };
        
        // ç¼“å­˜ç»“æœ
        this.gasCache.set(cacheKey, {
          data: result,
          timestamp: Date.now()
        });
        
        return result;
        
      } catch (error) {
        console.error('ä¼°ç®— Gas è´¹ç”¨å¤±è´¥:', error);
        
        // è¿”å›é»˜è®¤ä¼°ç®—
        return {
          gasLimit: '100000',
          safeGasLimit: '120000',
          gasPrice: { gwei: '20', formatted: '20 Gwei' },
          estimatedCost: { formatted: '~0.002 ETH' },
          safeCost: { formatted: '~0.0024 ETH' },
          error: error.message
        };
      }
    }
    
    // è·å– Gas ä»·æ ¼å»ºè®®
    getGasPriceSuggestions() {
      if (this.gasPriceHistory.length === 0) {
        return {
          slow: '10',
          standard: '20',
          fast: '30'
        };
      }
      
      const prices = this.gasPriceHistory.map(item => item.price);
      const avgPrice = prices.reduce((sum, price) => sum + price, 0) / prices.length;
      
      return {
        slow: (avgPrice * 0.8).toFixed(1),
        standard: avgPrice.toFixed(1),
        fast: (avgPrice * 1.2).toFixed(1)
      };
    }
    
    // ä¼˜åŒ–äº¤æ˜“å‚æ•°
    async optimizeTransactionParams(contract, method, params, userPreference = 'standard') {
      try {
        const costEstimate = await this.estimateTransactionCost(contract, method, params);
        const suggestions = this.getGasPriceSuggestions();
        
        let selectedGasPrice;
        switch (userPreference) {
          case 'slow':
            selectedGasPrice = ethers.utils.parseUnits(suggestions.slow, 'gwei');
            break;
          case 'fast':
            selectedGasPrice = ethers.utils.parseUnits(suggestions.fast, 'gwei');
            break;
          default:
            selectedGasPrice = ethers.utils.parseUnits(suggestions.standard, 'gwei');
        }
        
        return {
          gasLimit: costEstimate.safeGasLimit,
          gasPrice: selectedGasPrice,
          maxFeePerGas: selectedGasPrice.mul(110).div(100), // EIP-1559
          maxPriorityFeePerGas: ethers.utils.parseUnits('2', 'gwei'),
          estimatedCost: costEstimate.safeCost
        };
        
      } catch (error) {
        console.error('ä¼˜åŒ–äº¤æ˜“å‚æ•°å¤±è´¥:', error);
        return null;
      }
    }
    
    // ç›‘æ§ Gas ä»·æ ¼å˜åŒ–
    startGasPriceMonitoring(callback, interval = 30000) {
      const monitor = setInterval(async () => {
        const gasPrice = await this.getCurrentGasPrice();
        if (gasPrice && callback) {
          callback(gasPrice);
        }
      }, interval);
      
      return () => clearInterval(monitor);
    }
    
    // æ¸…ç†ç¼“å­˜
    clearCache() {
      this.gasCache.clear();
      this.gasPriceHistory = [];
    }
  }
  ```

#### ç¬¬3å¤©ï¼šæ™ºèƒ½é‡è¯•æœºåˆ¶å’Œé”™è¯¯å¤„ç†
- [ ] **å®ç°é‡è¯•ç®¡ç†ç³»ç»Ÿ**
  ```javascript
  // js/retry-manager.js
  class RetryManager {
    constructor() {
      this.retryConfig = {
        maxRetries: 3,
        baseDelay: 1000,
        maxDelay: 10000,
        backoffFactor: 2,
        retryableErrors: [
          'NETWORK_ERROR',
          'TIMEOUT',
          'INSUFFICIENT_FUNDS',
          'REPLACEMENT_UNDERPRICED',
          'NONCE_EXPIRED'
        ]
      };
      
      this.activeRetries = new Map();
    }
    
    // æ‰§è¡Œå¸¦é‡è¯•çš„æ“ä½œ
    async executeWithRetry(operation, operationId, customConfig = {}) {
      const config = { ...this.retryConfig, ...customConfig };
      let lastError;
      
      for (let attempt = 0; attempt <= config.maxRetries; attempt++) {
        try {
          // æ›´æ–°é‡è¯•çŠ¶æ€
          this.updateRetryStatus(operationId, {
            attempt: attempt + 1,
            maxAttempts: config.maxRetries + 1,
            status: 'attempting'
          });
          
          const result = await operation();
          
          // æˆåŠŸï¼Œæ¸…ç†é‡è¯•çŠ¶æ€
          this.activeRetries.delete(operationId);
          return result;
          
        } catch (error) {
          lastError = error;
          console.warn(`æ“ä½œå¤±è´¥ (å°è¯• ${attempt + 1}/${config.maxRetries + 1}):`, error.message);
          
          // æ£€æŸ¥æ˜¯å¦åº”è¯¥é‡è¯•
          if (attempt === config.maxRetries || !this.shouldRetry(error)) {
            this.activeRetries.delete(operationId);
            throw error;
          }
          
          // è®¡ç®—å»¶è¿Ÿæ—¶é—´
          const delay = Math.min(
            config.baseDelay * Math.pow(config.backoffFactor, attempt),
            config.maxDelay
          );
          
          // æ›´æ–°é‡è¯•çŠ¶æ€
          this.updateRetryStatus(operationId, {
            attempt: attempt + 1,
            maxAttempts: config.maxRetries + 1,
            status: 'waiting',
            nextRetryIn: delay,
            error: error.message
          });
          
          // ç­‰å¾…åé‡è¯•
          await this.delay(delay);
        }
      }
      
      throw lastError;
    }
    
    // åˆ¤æ–­æ˜¯å¦åº”è¯¥é‡è¯•
    shouldRetry(error) {
      // æ£€æŸ¥é”™è¯¯ç±»å‹
      if (error.code === 4001) { // ç”¨æˆ·æ‹’ç»
        return false;
      }
      
      if (error.code === -32603) { // å†…éƒ¨é”™è¯¯ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜
        return true;
      }
      
      // æ£€æŸ¥é”™è¯¯æ¶ˆæ¯
      const errorMessage = error.message.toLowerCase();
      
      const retryablePatterns = [
        'network error',
        'timeout',
        'connection',
        'replacement underpriced',
        'nonce too low',
        'already known',
        'gas price too low'
      ];
      
      return retryablePatterns.some(pattern => 
        errorMessage.includes(pattern)
      );
    }
    
    // æ™ºèƒ½å­˜æ¬¾é‡è¯•
    async retryableDeposit(bankContract, amount, userAddress) {
      const operationId = `deposit-${userAddress}-${Date.now()}`;
      
      return await this.executeWithRetry(async () => {
        // æ£€æŸ¥ä½™é¢
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const balance = await provider.getBalance(userAddress);
        const amountWei = ethers.utils.parseEther(amount);
        
        if (balance.lt(amountWei)) {
          throw new Error('ä½™é¢ä¸è¶³');
        }
        
        // è·å–ä¼˜åŒ–çš„äº¤æ˜“å‚æ•°
        const gasManager = new GasManager();
        const txParams = await gasManager.optimizeTransactionParams(
          bankContract.contract,
          'deposit',
          [],
          'standard'
        );
        
        // æ‰§è¡Œå­˜æ¬¾
        const tx = await bankContract.contract.deposit({
          value: amountWei,
          gasLimit: txParams.gasLimit,
          gasPrice: txParams.gasPrice
        });
        
        return tx;
        
      }, operationId, {
        maxRetries: 5,
        baseDelay: 2000
      });
    }
    
    // æ™ºèƒ½ææ¬¾é‡è¯•
    async retryableWithdraw(bankContract, amount) {
      const operationId = `withdraw-${Date.now()}`;
      
      return await this.executeWithRetry(async () => {
        const amountWei = ethers.utils.parseEther(amount);
        
        // æ£€æŸ¥åˆçº¦ä½™é¢
        const contractBalance = await bankContract.contract.getBalance();
        if (contractBalance.lt(amountWei)) {
          throw new Error('åˆçº¦ä½™é¢ä¸è¶³');
        }
        
        // è·å–ä¼˜åŒ–çš„äº¤æ˜“å‚æ•°
        const gasManager = new GasManager();
        const txParams = await gasManager.optimizeTransactionParams(
          bankContract.contract,
          'withdraw',
          [amountWei],
          'standard'
        );
        
        // æ‰§è¡Œææ¬¾
        const tx = await bankContract.contract.withdraw(amountWei, {
          gasLimit: txParams.gasLimit,
          gasPrice: txParams.gasPrice
        });
        
        return tx;
        
      }, operationId, {
        maxRetries: 3,
        baseDelay: 3000
      });
    }
    
    // æ›´æ–°é‡è¯•çŠ¶æ€
    updateRetryStatus(operationId, status) {
      this.activeRetries.set(operationId, {
        ...status,
        timestamp: Date.now()
      });
      
      // é€šçŸ¥UIæ›´æ–°
      this.notifyRetryStatus(operationId, status);
    }
    
    // é€šçŸ¥é‡è¯•çŠ¶æ€
    notifyRetryStatus(operationId, status) {
      const event = new CustomEvent('retryStatusUpdate', {
        detail: { operationId, status }
      });
      document.dispatchEvent(event);
    }
    
    // è·å–æ´»è·ƒé‡è¯•çŠ¶æ€
    getActiveRetries() {
      return Array.from(this.activeRetries.entries()).map(([id, status]) => ({
        id,
        ...status
      }));
    }
    
    // å–æ¶ˆé‡è¯•
    cancelRetry(operationId) {
      this.activeRetries.delete(operationId);
    }
    
    // å»¶è¿Ÿå‡½æ•°
    delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
  }
  ```

#### ç¬¬4å¤©ï¼šæ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–
- [ ] **å®ç°æ€§èƒ½ç›‘æ§ç³»ç»Ÿ**
  ```javascript
  // js/performance-monitor.js
  class PerformanceMonitor {
    constructor() {
      this.metrics = {
        transactions: [],
        apiCalls: [],
        renderTimes: [],
        errors: []
      };
      
      this.thresholds = {
        transactionTime: 30000, // 30ç§’
        apiCallTime: 5000,      // 5ç§’
        renderTime: 100,        // 100ms
        errorRate: 0.05         // 5%
      };
      
      this.isMonitoring = false;
    }
    
    // å¼€å§‹ç›‘æ§
    startMonitoring() {
      if (this.isMonitoring) return;
      
      this.isMonitoring = true;
      
      // ç›‘æ§é¡µé¢æ€§èƒ½
      this.monitorPagePerformance();
      
      // ç›‘æ§ç½‘ç»œè¯·æ±‚
      this.monitorNetworkRequests();
      
      // ç›‘æ§é”™è¯¯
      this.monitorErrors();
      
      console.log('æ€§èƒ½ç›‘æ§å·²å¯åŠ¨');
    }
    
    // è®°å½•äº¤æ˜“æ€§èƒ½
    recordTransaction(txHash, type, startTime) {
      const endTime = Date.now();
      const duration = endTime - startTime;
      
      const record = {
        txHash,
        type,
        startTime,
        endTime,
        duration,
        timestamp: Date.now()
      };
      
      this.metrics.transactions.push(record);
      
      // æ£€æŸ¥æ€§èƒ½é˜ˆå€¼
      if (duration > this.thresholds.transactionTime) {
        console.warn(`äº¤æ˜“ ${txHash} è€—æ—¶è¿‡é•¿: ${duration}ms`);
        this.recordPerformanceIssue('slow_transaction', record);
      }
      
      // æ¸…ç†æ—§æ•°æ®
      this.cleanOldMetrics('transactions');
      
      return record;
    }
    
    // è®°å½• API è°ƒç”¨æ€§èƒ½
    recordApiCall(method, params, startTime, success = true, error = null) {
      const endTime = Date.now();
      const duration = endTime - startTime;
      
      const record = {
        method,
        params: JSON.stringify(params),
        startTime,
        endTime,
        duration,
        success,
        error: error?.message,
        timestamp: Date.now()
      };
      
      this.metrics.apiCalls.push(record);
      
      // æ£€æŸ¥æ€§èƒ½é˜ˆå€¼
      if (duration > this.thresholds.apiCallTime) {
        console.warn(`API è°ƒç”¨ ${method} è€—æ—¶è¿‡é•¿: ${duration}ms`);
        this.recordPerformanceIssue('slow_api_call', record);
      }
      
      if (!success) {
        this.metrics.errors.push({
          type: 'api_error',
          method,
          error: error?.message,
          timestamp: Date.now()
        });
      }
      
      this.cleanOldMetrics('apiCalls');
      
      return record;
    }
    
    // è®°å½•æ¸²æŸ“æ€§èƒ½
    recordRenderTime(component, startTime) {
      const endTime = Date.now();
      const duration = endTime - startTime;
      
      const record = {
        component,
        startTime,
        endTime,
        duration,
        timestamp: Date.now()
      };
      
      this.metrics.renderTimes.push(record);
      
      if (duration > this.thresholds.renderTime) {
        console.warn(`ç»„ä»¶ ${component} æ¸²æŸ“è€—æ—¶è¿‡é•¿: ${duration}ms`);
        this.recordPerformanceIssue('slow_render', record);
      }
      
      this.cleanOldMetrics('renderTimes');
      
      return record;
    }
    
    // ç›‘æ§é¡µé¢æ€§èƒ½
    monitorPagePerformance() {
      // ç›‘æ§é¡µé¢åŠ è½½æ—¶é—´
      window.addEventListener('load', () => {
        const navigation = performance.getEntriesByType('navigation')[0];
        if (navigation) {
          console.log('é¡µé¢åŠ è½½æ€§èƒ½:', {
            domContentLoaded: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
            loadComplete: navigation.loadEventEnd - navigation.loadEventStart,
            totalTime: navigation.loadEventEnd - navigation.fetchStart
          });
        }
      });
      
      // ç›‘æ§èµ„æºåŠ è½½
      const observer = new PerformanceObserver((list) => {
        list.getEntries().forEach((entry) => {
          if (entry.duration > 1000) { // è¶…è¿‡1ç§’çš„èµ„æº
            console.warn('æ…¢èµ„æºåŠ è½½:', entry.name, entry.duration + 'ms');
          }
        });
      });
      
      observer.observe({ entryTypes: ['resource'] });
    }
    
    // ç›‘æ§ç½‘ç»œè¯·æ±‚
    monitorNetworkRequests() {
      // æ‹¦æˆª fetch è¯·æ±‚
      const originalFetch = window.fetch;
      window.fetch = async (...args) => {
        const startTime = Date.now();
        try {
          const response = await originalFetch(...args);
          const duration = Date.now() - startTime;
          
          this.recordApiCall(
            'fetch',
            { url: args[0] },
            startTime,
            response.ok,
            response.ok ? null : new Error(`HTTP ${response.status}`)
          );
          
          return response;
        } catch (error) {
          this.recordApiCall('fetch', { url: args[0] }, startTime, false, error);
          throw error;
        }
      };
    }
    
    // ç›‘æ§é”™è¯¯
    monitorErrors() {
      window.addEventListener('error', (event) => {
        this.metrics.errors.push({
          type: 'javascript_error',
          message: event.message,
          filename: event.filename,
          lineno: event.lineno,
          colno: event.colno,
          timestamp: Date.now()
        });
      });
      
      window.addEventListener('unhandledrejection', (event) => {
        this.metrics.errors.push({
          type: 'promise_rejection',
          message: event.reason?.message || 'Unhandled promise rejection',
          timestamp: Date.now()
        });
      });
    }
    
    // è·å–æ€§èƒ½æŠ¥å‘Š
    getPerformanceReport() {
      const now = Date.now();
      const oneHour = 60 * 60 * 1000;
      
      // è¿‡æ»¤æœ€è¿‘ä¸€å°æ—¶çš„æ•°æ®
      const recentTransactions = this.metrics.transactions.filter(
        t => now - t.timestamp < oneHour
      );
      const recentApiCalls = this.metrics.apiCalls.filter(
        a => now - a.timestamp < oneHour
      );
      const recentErrors = this.metrics.errors.filter(
        e => now - e.timestamp < oneHour
      );
      
      // è®¡ç®—ç»Ÿè®¡æ•°æ®
      const avgTransactionTime = recentTransactions.length > 0 
        ? recentTransactions.reduce((sum, t) => sum + t.duration, 0) / recentTransactions.length
        : 0;
      
      const avgApiCallTime = recentApiCalls.length > 0
        ? recentApiCalls.reduce((sum, a) => sum + a.duration, 0) / recentApiCalls.length
        : 0;
      
      const errorRate = recentApiCalls.length > 0
        ? recentErrors.length / recentApiCalls.length
        : 0;
      
      return {
        summary: {
          totalTransactions: recentTransactions.length,
          totalApiCalls: recentApiCalls.length,
          totalErrors: recentErrors.length,
          avgTransactionTime: Math.round(avgTransactionTime),
          avgApiCallTime: Math.round(avgApiCallTime),
          errorRate: (errorRate * 100).toFixed(2) + '%'
        },
        transactions: recentTransactions.slice(-10), // æœ€è¿‘10ç¬”äº¤æ˜“
        slowOperations: this.getSlowOperations(),
        errors: recentErrors.slice(-5), // æœ€è¿‘5ä¸ªé”™è¯¯
        recommendations: this.getOptimizationRecommendations()
      };
    }
    
    // è·å–æ…¢æ“ä½œ
    getSlowOperations() {
      const slowTransactions = this.metrics.transactions.filter(
        t => t.duration > this.thresholds.transactionTime
      );
      
      const slowApiCalls = this.metrics.apiCalls.filter(
        a => a.duration > this.thresholds.apiCallTime
      );
      
      return {
        transactions: slowTransactions.slice(-5),
        apiCalls: slowApiCalls.slice(-5)
      };
    }
    
    // è·å–ä¼˜åŒ–å»ºè®®
    getOptimizationRecommendations() {
      const recommendations = [];
      const report = this.getPerformanceReport();
      
      if (report.summary.avgTransactionTime > this.thresholds.transactionTime) {
        recommendations.push({
          type: 'transaction_optimization',
          message: 'äº¤æ˜“ç¡®è®¤æ—¶é—´è¾ƒé•¿ï¼Œå»ºè®®ä¼˜åŒ– Gas ä»·æ ¼è®¾ç½®',
          priority: 'high'
        });
      }
      
      if (report.summary.avgApiCallTime > this.thresholds.apiCallTime) {
        recommendations.push({
          type: 'api_optimization',
          message: 'API è°ƒç”¨å“åº”è¾ƒæ…¢ï¼Œå»ºè®®å®ç°ç¼“å­˜æœºåˆ¶',
          priority: 'medium'
        });
      }
      
      if (parseFloat(report.summary.errorRate) > this.thresholds.errorRate * 100) {
        recommendations.push({
          type: 'error_handling',
          message: 'é”™è¯¯ç‡è¾ƒé«˜ï¼Œå»ºè®®åŠ å¼ºé”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶',
          priority: 'high'
        });
      }
      
      return recommendations;
    }
    
    // è®°å½•æ€§èƒ½é—®é¢˜
    recordPerformanceIssue(type, details) {
      console.warn('æ€§èƒ½é—®é¢˜:', type, details);
      
      // å¯ä»¥å‘é€åˆ°ç›‘æ§æœåŠ¡
      // this.sendToMonitoringService(type, details);
    }
    
    // æ¸…ç†æ—§æ•°æ®
    cleanOldMetrics(type) {
      const maxAge = 24 * 60 * 60 * 1000; // 24å°æ—¶
      const now = Date.now();
      
      this.metrics[type] = this.metrics[type].filter(
        item => now - item.timestamp < maxAge
      );
    }
    
    // åœæ­¢ç›‘æ§
    stopMonitoring() {
      this.isMonitoring = false;
      console.log('æ€§èƒ½ç›‘æ§å·²åœæ­¢');
    }
  }
  ```

#### ç¬¬5å¤©ï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] **å®ç° UX å¢å¼ºç»„ä»¶**
  ```javascript
  // js/ux-enhancements.js
  class UXEnhancements {
    constructor(stateManager, performanceMonitor) {
      this.stateManager = stateManager;
      this.performanceMonitor = performanceMonitor;
      this.loadingStates = new Map();
      this.notifications = [];
      
      this.init();
    }
    
    init() {
      this.createLoadingOverlay();
      this.createNotificationContainer();
      this.setupProgressIndicators();
      this.setupTooltips();
    }
    
    // åˆ›å»ºåŠ è½½é®ç½©
    createLoadingOverlay() {
      const overlay = document.createElement('div');
      overlay.id = 'loadingOverlay';
      overlay.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden';
      overlay.innerHTML = `
        <div class="bg-white rounded-lg p-8 max-w-sm mx-4">
          <div class="flex items-center space-x-4">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <div>
              <p class="font-medium text-gray-900" id="loadingTitle">å¤„ç†ä¸­...</p>
              <p class="text-sm text-gray-600" id="loadingMessage">è¯·ç¨å€™</p>
            </div>
          </div>
          <div class="mt-4">
            <div class="bg-gray-200 rounded-full h-2">
              <div id="loadingProgress" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(overlay);
    }
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    showLoading(title = 'å¤„ç†ä¸­...', message = 'è¯·ç¨å€™', showProgress = false) {
      const overlay = document.getElementById('loadingOverlay');
      const titleEl = document.getElementById('loadingTitle');
      const messageEl = document.getElementById('loadingMessage');
      const progressEl = document.getElementById('loadingProgress');
      
      titleEl.textContent = title;
      messageEl.textContent = message;
      
      if (showProgress) {
        progressEl.style.width = '0%';
        progressEl.parentElement.style.display = 'block';
      } else {
        progressEl.parentElement.style.display = 'none';
      }
      
      overlay.classList.remove('hidden');
    }
    
    // æ›´æ–°åŠ è½½è¿›åº¦
    updateLoadingProgress(progress, message = null) {
      const progressEl = document.getElementById('loadingProgress');
      const messageEl = document.getElementById('loadingMessage');
      
      if (progressEl) {
        progressEl.style.width = `${Math.min(100, Math.max(0, progress))}%`;
      }
      
      if (message && messageEl) {
        messageEl.textContent = message;
      }
    }
    
    // éšè—åŠ è½½çŠ¶æ€
    hideLoading() {
      const overlay = document.getElementById('loadingOverlay');
      overlay.classList.add('hidden');
    }
    
    // æ™ºèƒ½åŠ è½½ç®¡ç†
    async withLoading(operation, config = {}) {
      const {
        title = 'å¤„ç†ä¸­...',
        initialMessage = 'è¯·ç¨å€™',
        showProgress = false,
        estimatedTime = null
      } = config;
      
      try {
        this.showLoading(title, initialMessage, showProgress);
        
        let progressInterval;
        if (showProgress && estimatedTime) {
          let progress = 0;
          progressInterval = setInterval(() => {
            progress += (100 / (estimatedTime / 1000)) * 0.5; // æ¯500msæ›´æ–°
            if (progress < 90) { // ä¸è¦åˆ°100%ï¼Œç­‰å®é™…å®Œæˆ
              this.updateLoadingProgress(progress);
            }
          }, 500);
        }
        
        const result = await operation();
        
        if (progressInterval) {
          clearInterval(progressInterval);
          this.updateLoadingProgress(100, 'å®Œæˆ');
          await new Promise(resolve => setTimeout(resolve, 500));
        }
        
        return result;
        
      } finally {
        this.hideLoading();
      }
    }
    
    // åˆ›å»ºé€šçŸ¥å®¹å™¨
    createNotificationContainer() {
      const container = document.createElement('div');
      container.id = 'notificationContainer';
      container.className = 'fixed top-4 right-4 z-50 space-y-2';
      document.body.appendChild(container);
    }
    
    // æ˜¾ç¤ºæ™ºèƒ½é€šçŸ¥
    showSmartNotification(message, type = 'info', options = {}) {
      const {
        duration = 5000,
        actions = [],
        persistent = false,
        icon = null
      } = options;
      
      const notification = {
        id: Date.now().toString(),
        message,
        type,
        timestamp: Date.now(),
        actions,
        persistent
      };
      
      this.notifications.push(notification);
      this.renderNotification(notification, duration);
      
      return notification.id;
    }
    
    // æ¸²æŸ“é€šçŸ¥
    renderNotification(notification, duration) {
      const container = document.getElementById('notificationContainer');
      
      const typeStyles = {
        success: 'bg-green-50 border-green-200 text-green-800',
        error: 'bg-red-50 border-red-200 text-red-800',
        warning: 'bg-yellow-50 border-yellow-200 text-yellow-800',
        info: 'bg-blue-50 border-blue-200 text-blue-800'
      };
      
      const typeIcons = {
        success: 'âœ“',
        error: 'âœ•',
        warning: 'âš ',
        info: 'â„¹'
      };
      
      const notificationEl = document.createElement('div');
      notificationEl.id = `notification-${notification.id}`;
      notificationEl.className = `${typeStyles[notification.type]} border rounded-lg p-4 shadow-lg max-w-sm transform transition-all duration-300 translate-x-full`;
      
      notificationEl.innerHTML = `
        <div class="flex items-start">
          <div class="flex-shrink-0">
            <span class="text-lg">${typeIcons[notification.type]}</span>
          </div>
          <div class="ml-3 flex-1">
            <p class="text-sm font-medium">${notification.message}</p>
            ${notification.actions.length > 0 ? `
              <div class="mt-2 space-x-2">
                ${notification.actions.map(action => `
                  <button class="text-xs px-2 py-1 rounded border hover:bg-opacity-20 transition-colors"
                          onclick="window.uxEnhancements.handleNotificationAction('${notification.id}', '${action.id}')">
                    ${action.label}
                  </button>
                `).join('')}
              </div>
            ` : ''}
          </div>
          ${!notification.persistent ? `
            <button class="flex-shrink-0 ml-2 text-gray-400 hover:text-gray-600"
                    onclick="window.uxEnhancements.dismissNotification('${notification.id}')">
              <span class="sr-only">å…³é—­</span>
              <span class="text-lg">Ã—</span>
            </button>
          ` : ''}
        </div>
      `;
      
      container.appendChild(notificationEl);
      
      // åŠ¨ç”»æ˜¾ç¤º
      setTimeout(() => {
        notificationEl.classList.remove('translate-x-full');
      }, 100);
      
      // è‡ªåŠ¨æ¶ˆå¤±
      if (!notification.persistent && duration > 0) {
        setTimeout(() => {
          this.dismissNotification(notification.id);
        }, duration);
      }
    }
    
    // å¤„ç†é€šçŸ¥æ“ä½œ
    handleNotificationAction(notificationId, actionId) {
      const notification = this.notifications.find(n => n.id === notificationId);
      if (!notification) return;
      
      const action = notification.actions.find(a => a.id === actionId);
      if (action && action.handler) {
        action.handler();
      }
      
      this.dismissNotification(notificationId);
    }
    
    // å…³é—­é€šçŸ¥
    dismissNotification(notificationId) {
      const notificationEl = document.getElementById(`notification-${notificationId}`);
      if (notificationEl) {
        notificationEl.classList.add('translate-x-full');
        setTimeout(() => {
          notificationEl.remove();
        }, 300);
      }
      
      this.notifications = this.notifications.filter(n => n.id !== notificationId);
    }
    
    // è®¾ç½®è¿›åº¦æŒ‡ç¤ºå™¨
    setupProgressIndicators() {
      // ä¸ºæ‰€æœ‰æŒ‰é’®æ·»åŠ åŠ è½½çŠ¶æ€
      document.addEventListener('click', (event) => {
        const button = event.target.closest('button[data-loading]');
        if (button && !button.disabled) {
          this.setButtonLoading(button, true);
        }
      });
    }
    
    // è®¾ç½®æŒ‰é’®åŠ è½½çŠ¶æ€
    setButtonLoading(button, loading) {
      if (typeof button === 'string') {
        button = document.getElementById(button);
      }
      
      if (!button) return;
      
      if (loading) {
        button.disabled = true;
        button.dataset.originalText = button.textContent;
        button.innerHTML = `
          <div class="flex items-center justify-center">
            <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
            å¤„ç†ä¸­...
          </div>
        `;
      } else {
        button.disabled = false;
        button.textContent = button.dataset.originalText || button.textContent;
      }
    }
    
    // è®¾ç½®å·¥å…·æç¤º
    setupTooltips() {
      // ç®€å•çš„å·¥å…·æç¤ºå®ç°
      document.addEventListener('mouseenter', (event) => {
        const element = event.target.closest('[data-tooltip]');
        if (element) {
          this.showTooltip(element, element.dataset.tooltip);
        }
      });
      
      document.addEventListener('mouseleave', (event) => {
        const element = event.target.closest('[data-tooltip]');
        if (element) {
          this.hideTooltip();
        }
      });
    }
    
    // æ˜¾ç¤ºå·¥å…·æç¤º
    showTooltip(element, text) {
      const tooltip = document.createElement('div');
      tooltip.id = 'tooltip';
      tooltip.className = 'absolute bg-gray-900 text-white text-xs rounded py-1 px-2 z-50';
      tooltip.textContent = text;
      
      document.body.appendChild(tooltip);
      
      const rect = element.getBoundingClientRect();
      tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
      tooltip.style.top = rect.top - tooltip.offsetHeight - 5 + 'px';
    }
    
    // éšè—å·¥å…·æç¤º
    hideTooltip() {
      const tooltip = document.getElementById('tooltip');
      if (tooltip) {
        tooltip.remove();
      }
    }
  }
  
  // å…¨å±€å®ä¾‹
  window.uxEnhancements = null;
  ```

#### ç¬¬6-7å¤©ï¼šé›†æˆæµ‹è¯•å’Œæ€§èƒ½è°ƒä¼˜
- [ ] **å®Œæ•´çš„æ€§èƒ½ä¼˜åŒ–é›†æˆ**
  ```javascript
  // js/optimized-bank-app.js
  class OptimizedBankDApp {
    constructor() {
      this.web3 = web3Connection;
      this.bankContract = null;
      this.eventListener = null;
      this.transactionTracker = new TransactionTracker();
      this.stateManager = new StateManager();
      this.gasManager = new GasManager(this.web3);
      this.retryManager = new RetryManager();
      this.performanceMonitor = new PerformanceMonitor();
      this.batchOperations = null;
      this.uxEnhancements = null;
      
      this.init();
    }
    
    async init() {
      // å¯åŠ¨æ€§èƒ½ç›‘æ§
      this.performanceMonitor.startMonitoring();
      
      // åˆå§‹åŒ– UX å¢å¼º
      this.uxEnhancements = new UXEnhancements(this.stateManager, this.performanceMonitor);
      window.uxEnhancements = this.uxEnhancements;
      
      // ç»‘å®šäº‹ä»¶
      this.bindEvents();
      
      // æ£€æŸ¥è¿æ¥çŠ¶æ€
      await this.checkConnection();
      
      // å¯åŠ¨ Gas ä»·æ ¼ç›‘æ§
      this.gasManager.startGasPriceMonitoring((gasPrice) => {
        this.stateManager.setState('network.gasPrice', gasPrice);
      });
    }
    
    // ä¼˜åŒ–çš„è¿æ¥é’±åŒ…
    async connectWallet() {
      const startTime = Date.now();
      
      try {
        const result = await this.uxEnhancements.withLoading(async () => {
          const connected = await this.web3.connectWallet();
          if (!connected) throw new Error('è¿æ¥å¤±è´¥');
          
          const userAddress = this.web3.userAddress;
          this.stateManager.setState('user.address', userAddress);
          
          // å¹¶è¡Œåˆå§‹åŒ–
          await Promise.all([
            this.initializeContract(),
            this.stateManager.loadFromCache(userAddress)
          ]);
          
          // åˆå§‹åŒ–æ‰¹é‡æ“ä½œ
          this.batchOperations = new BatchOperations(this.bankContract, this.web3);
          
          // å¯åŠ¨äº‹ä»¶ç›‘å¬
          this.eventListener = new EventListener(this.bankContract, this.web3);
          await this.eventListener.startListening();
          
          // æ‰¹é‡åŠ è½½åˆå§‹æ•°æ®
          await this.loadInitialData();
          
          this.stateManager.setState('ui.isConnected', true);
          
          return true;
        }, {
          title: 'è¿æ¥é’±åŒ…',
          initialMessage: 'æ­£åœ¨è¿æ¥...',
          showProgress: true,
          estimatedTime: 5000
        });
        
        this.uxEnhancements.showSmartNotification('é’±åŒ…è¿æ¥æˆåŠŸ', 'success');
        
        // è®°å½•æ€§èƒ½
        this.performanceMonitor.recordApiCall('connectWallet', {}, startTime, true);
        
      } catch (error) {
        console.error('è¿æ¥å¤±è´¥:', error);
        this.uxEnhancements.showSmartNotification('é’±åŒ…è¿æ¥å¤±è´¥: ' + error.message, 'error');
        this.performanceMonitor.recordApiCall('connectWallet', {}, startTime, false, error);
      }
    }
    
    // ä¼˜åŒ–çš„å­˜æ¬¾æ“ä½œ
    async handleDeposit() {
      const amount = document.getElementById('depositAmount').value;
      if (!amount || parseFloat(amount) <= 0) {
        this.uxEnhancements.showSmartNotification('è¯·è¾“å…¥æœ‰æ•ˆçš„å­˜æ¬¾é‡‘é¢', 'error');
        return;
      }
      
      const startTime = Date.now();
      
      try {
        // é¢„æ£€æŸ¥
        const userBalance = this.stateManager.getState('user.balance');
        if (parseFloat(amount) > parseFloat(userBalance)) {
          this.uxEnhancements.showSmartNotification('ä½™é¢ä¸è¶³', 'error');
          return;
        }
        
        // ä¼°ç®— Gas è´¹ç”¨
        const gasEstimate = await this.gasManager.estimateTransactionCost(
          this.bankContract.contract,
          'deposit',
          [],
          amount
        );
        
        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        const confirmed = await this.showTransactionConfirmation({
          type: 'å­˜æ¬¾',
          amount: `${amount} ETH`,
          gasEstimate: gasEstimate.safeCost.formatted,
          total: `${(parseFloat(amount) + parseFloat(gasEstimate.safeCost.eth)).toFixed(6)} ETH`
        });
        
        if (!confirmed) return;
        
        // æ‰§è¡Œå¸¦é‡è¯•çš„å­˜æ¬¾
        const tx = await this.retryManager.retryableDeposit(
          this.bankContract,
          amount,
          this.stateManager.getState('user.address')
        );
        
        // æ·»åŠ åˆ°äº¤æ˜“è·Ÿè¸ª
        this.transactionTracker.addPendingTransaction(tx.hash, 'deposit', {
          amount,
          userAddress: this.stateManager.getState('user.address')
        });
        
        // ä¹è§‚æ›´æ–°
        const currentDeposit = parseFloat(this.stateManager.getState('user.deposit'));
        this.stateManager.setState('user.deposit', (currentDeposit + parseFloat(amount)).toString());
        
        // æ¸…ç©ºè¡¨å•
        document.getElementById('depositAmount').value = '';
        
        this.uxEnhancements.showSmartNotification(
          `å­˜æ¬¾äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œ: ${tx.hash.slice(0, 10)}...`,
          'info',
          {
            actions: [{
              id: 'view_tx',
              label: 'æŸ¥çœ‹äº¤æ˜“',
              handler: () => window.open(`https://etherscan.io/tx/${tx.hash}`, '_blank')
            }]
          }
        );
        
        // è®°å½•æ€§èƒ½
        this.performanceMonitor.recordTransaction(tx.hash, 'deposit', startTime);
        
      } catch (error) {
        console.error('å­˜æ¬¾å¤±è´¥:', error);
        
        let errorMessage = 'å­˜æ¬¾å¤±è´¥';
        if (error.code === 4001) {
          errorMessage = 'ç”¨æˆ·å–æ¶ˆäº†äº¤æ˜“';
        } else if (error.message.includes('insufficient funds')) {
          errorMessage = 'ä½™é¢ä¸è¶³';
        }
        
        this.uxEnhancements.showSmartNotification(errorMessage, 'error', {
          actions: [{
            id: 'retry',
            label: 'é‡è¯•',
            handler: () => this.handleDeposit()
          }]
        });
        
        this.performanceMonitor.recordTransaction('failed', 'deposit', startTime);
      }
    }
    
    // æ˜¾ç¤ºäº¤æ˜“ç¡®è®¤å¯¹è¯æ¡†
    async showTransactionConfirmation(details) {
      return new Promise((resolve) => {
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        modal.innerHTML = `
          <div class="bg-white rounded-lg p-6 max-w-md mx-4">
            <h3 class="text-lg font-medium text-gray-900 mb-4">ç¡®è®¤${details.type}</h3>
            <div class="space-y-3 mb-6">
              <div class="flex justify-between">
                <span class="text-gray-600">é‡‘é¢:</span>
                <span class="font-medium">${details.amount}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">é¢„ä¼° Gas è´¹:</span>
                <span class="font-medium">${details.gasEstimate}</span>
              </div>
              <div class="flex justify-between border-t pt-3">
                <span class="text-gray-900 font-medium">æ€»è®¡:</span>
                <span class="font-bold">${details.total}</span>
              </div>
            </div>
            <div class="flex space-x-3">
              <button id="confirmBtn" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                ç¡®è®¤
              </button>
              <button id="cancelBtn" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                å–æ¶ˆ
              </button>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        modal.querySelector('#confirmBtn').onclick = () => {
          modal.remove();
          resolve(true);
        };
        
        modal.querySelector('#cancelBtn').onclick = () => {
          modal.remove();
          resolve(false);
        };
        
        modal.onclick = (e) => {
          if (e.target === modal) {
            modal.remove();
            resolve(false);
          }
        };
      });
    }
    
    // æ‰¹é‡åŠ è½½åˆå§‹æ•°æ®
    async loadInitialData() {
      const userAddress = this.stateManager.getState('user.address');
      
      try {
        // å¹¶è¡ŒåŠ è½½æ•°æ®
        const [userBalance, userDeposit, contractBalance, topDepositors] = await Promise.all([
          this.web3.provider.getBalance(userAddress),
          this.bankContract.contract.deposits(userAddress),
          this.bankContract.contract.getBalance(),
          this.bankContract.contract.getTopDepositors()
        ]);
        
        // æ‰¹é‡æ›´æ–°çŠ¶æ€
        this.stateManager.batchUpdate({
          'user.balance': ethers.utils.formatEther(userBalance),
          'user.deposit': ethers.utils.formatEther(userDeposit),
          'contract.balance': ethers.utils.formatEther(contractBalance),
          'contract.topDepositors': topDepositors
        });
        
        // æ£€æŸ¥ç”¨æˆ·æ’å
        const userRank = topDepositors.findIndex(addr => 
          addr.toLowerCase() === userAddress.toLowerCase()
        );
        
        if (userRank !== -1) {
          this.stateManager.setState('user.rank', userRank + 1);
        }
        
      } catch (error) {
        console.error('åŠ è½½åˆå§‹æ•°æ®å¤±è´¥:', error);
        this.uxEnhancements.showSmartNotification('åŠ è½½æ•°æ®å¤±è´¥', 'error');
      }
    }
    
    // è·å–æ€§èƒ½æŠ¥å‘Š
    getPerformanceReport() {
      return this.performanceMonitor.getPerformanceReport();
    }
    
    // æ˜¾ç¤ºæ€§èƒ½æŠ¥å‘Š
    showPerformanceReport() {
      const report = this.getPerformanceReport();
      console.log('æ€§èƒ½æŠ¥å‘Š:', report);
      
      // å¯ä»¥åˆ›å»ºä¸€ä¸ªæ€§èƒ½æŠ¥å‘Šçš„ UI ç•Œé¢
      this.uxEnhancements.showSmartNotification(
        `å¹³å‡äº¤æ˜“æ—¶é—´: ${report.summary.avgTransactionTime}ms, é”™è¯¯ç‡: ${report.summary.errorRate}`,
        'info',
        { duration: 10000 }
      );
    }
  }
  
  // åˆå§‹åŒ–ä¼˜åŒ–ç‰ˆåº”ç”¨
  document.addEventListener('DOMContentLoaded', () => {
    new OptimizedBankDApp();
  });
  ```

### ğŸ› ï¸ æ¯æ—¥æ£€æŸ¥æ¸…å•
- [ ] **ç¬¬1å¤©**: å®ç°æ‰¹é‡æ“ä½œå’Œå¹¶å‘å¤„ç†ç³»ç»Ÿ
- [ ] **ç¬¬2å¤©**: å¼€å‘ Gas ä¼˜åŒ–å’Œè´¹ç”¨ä¼°ç®—åŠŸèƒ½
- [ ] **ç¬¬3å¤©**: å®ç°æ™ºèƒ½é‡è¯•æœºåˆ¶å’Œé”™è¯¯å¤„ç†
- [ ] **ç¬¬4å¤©**: å»ºç«‹æ€§èƒ½ç›‘æ§å’Œåˆ†æç³»ç»Ÿ
- [ ] **ç¬¬5å¤©**: ä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’Œäº¤äº’è®¾è®¡
- [ ] **ç¬¬6-7å¤©**: é›†æˆæµ‹è¯•å’Œæ€§èƒ½è°ƒä¼˜

### ğŸ“– å­¦ä¹ èµ„æº
- [ä»¥å¤ªåŠ Gas ä¼˜åŒ–æŒ‡å—](https://ethereum.org/en/developers/docs/gas/)
- [Web æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ](https://web.dev/performance/)
- [JavaScript å¹¶å‘ç¼–ç¨‹](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)

---

## ğŸ“… ç¬¬6å‘¨ï¼šæ–°é¡¹ç›®å®æˆ˜

### ğŸ¯ æœ¬å‘¨ç›®æ ‡
ç»¼åˆè¿ç”¨æ‰€å­¦æŠ€èƒ½ï¼Œå¼€å‘ä¸€ä¸ªæ–°çš„ DApp é¡¹ç›®

### ğŸ“‹ é¡¹ç›®é€‰æ‹©ï¼ˆäºŒé€‰ä¸€ï¼‰
**é€‰é¡¹Aï¼šä»£å¸äº¤æ¢ DApp**
- åˆ›å»º ERC20 ä»£å¸åˆçº¦
- å®ç°ä»£å¸äº¤æ¢åŠŸèƒ½
- æ·»åŠ æµåŠ¨æ€§æ± æ¦‚å¿µ

**é€‰é¡¹Bï¼šæŠ•ç¥¨æ²»ç† DApp**
- åˆ›å»ºæŠ•ç¥¨åˆçº¦
- å®ç°ææ¡ˆåˆ›å»ºå’ŒæŠ•ç¥¨
- æ·»åŠ æ²»ç†ä»£å¸æœºåˆ¶

### ğŸ“‹ å­¦ä¹ ä»»åŠ¡
- [ ] **åˆçº¦è®¾è®¡å’Œå¼€å‘**
  - è®¾è®¡åˆçº¦æ¶æ„
  - å®ç°æ ¸å¿ƒåŠŸèƒ½
  - ç¼–å†™æµ‹è¯•ç”¨ä¾‹

- [ ] **å‰ç«¯å®Œæ•´å¼€å‘**
  - è®¾è®¡ç”¨æˆ·ç•Œé¢
  - å®ç°æ‰€æœ‰äº¤äº’åŠŸèƒ½
  - æ·»åŠ æ•°æ®å¯è§†åŒ–

- [ ] **é¡¹ç›®éƒ¨ç½²**
  - éƒ¨ç½²åˆ°æµ‹è¯•ç½‘
  - éªŒè¯åˆçº¦ä»£ç 
  - å‘å¸ƒå‰ç«¯åº”ç”¨

### ğŸ› ï¸ æŠ€æœ¯æ ˆ
- **æ™ºèƒ½åˆçº¦å¼€å‘**: Solidity + Hardhat/Foundry
- **å‰ç«¯æ¡†æ¶**: React/Vue + ethers.js/web3.js
- **æ ·å¼æ¡†æ¶**: ç°ä»£ CSS æ¡†æ¶ (Tailwind CSS)
- **æµ‹è¯•å·¥å…·**: Foundry (æ¨¡ç³Šæµ‹è¯•) + Hardhat (é›†æˆæµ‹è¯•)
- **éƒ¨ç½²å·¥å…·**: Foundry (é«˜æ€§èƒ½) + Hardhat (ç”Ÿæ€ä¸°å¯Œ)

---

## ğŸ“… ç¬¬7å‘¨ï¼šå®‰å…¨å’Œæœ€ä½³å®è·µ

### ğŸ¯ æœ¬å‘¨ç›®æ ‡
å­¦ä¹ æ™ºèƒ½åˆçº¦å’Œ DApp å®‰å…¨æœ€ä½³å®è·µ

### ğŸ“‹ å­¦ä¹ ä»»åŠ¡
- [ ] **å¸¸è§å®‰å…¨é—®é¢˜**
  - é‡å…¥æ”»å‡»é˜²æŠ¤
  - æ•´æ•°æº¢å‡ºå¤„ç†
  - æƒé™æ§åˆ¶æ£€æŸ¥
  - å‰ç«¯å®‰å…¨è€ƒè™‘

- [ ] **ä»£ç å®¡è®¡å’Œå®‰å…¨æµ‹è¯•**
  - å­¦ä¹ ä»£ç å®¡è®¡æ–¹æ³•
  - ä½¿ç”¨ Foundry è¿›è¡Œæ¨¡ç³Šæµ‹è¯•
  - ä½¿ç”¨ Slither/Mythril é™æ€åˆ†æ
  - ç¼–å†™ä¸å˜é‡æµ‹è¯•
  
  ```solidity
  // ä½¿ç”¨ Foundry è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ç¤ºä¾‹
  function testFuzzDeposit(uint256 amount) public {
      vm.assume(amount > 0 && amount <= 100 ether);
      vm.deal(user1, amount);
      
      vm.prank(user1);
      bank.deposit{value: amount}();
      
      assertEq(bank.deposits(user1), amount);
  }
  
  // ä¸å˜é‡æµ‹è¯•
  function invariant_contractBalanceEqualsDeposits() public {
      uint256 totalDeposits = 0;
      for (uint i = 0; i < depositors.length; i++) {
          totalDeposits += bank.deposits(depositors[i]);
      }
      assertEq(address(bank).balance, totalDeposits);
  }
  ```

- [ ] **å®‰å…¨åˆ†æå·¥å…·ä½¿ç”¨**
  ```bash
  # ä½¿ç”¨ Slither è¿›è¡Œé™æ€åˆ†æ
  pip install slither-analyzer
  slither src/Bank.sol
  
  # ä½¿ç”¨ Foundry çš„å†…ç½®å®‰å…¨æ£€æŸ¥
  forge test --gas-report
  forge coverage
  
  # ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
  forge coverage --report lcov
  ```

- [ ] **éƒ¨ç½²ä¼˜åŒ–**
  - åˆçº¦å‡çº§ç­–ç•¥
  - å¤šç­¾é’±åŒ…ä½¿ç”¨
  - ç›‘æ§å’Œå‘Šè­¦

### ğŸ› ï¸ å®è·µé¡¹ç›®
- å®¡è®¡ä¹‹å‰å¼€å‘çš„åˆçº¦
- ä¿®å¤å‘ç°çš„å®‰å…¨é—®é¢˜
- æ·»åŠ å®‰å…¨é˜²æŠ¤æªæ–½
- ç¼–å†™å®‰å…¨æ–‡æ¡£

---

## ğŸ“… ç¬¬8å‘¨ï¼šè¿›é˜¶ä¸»é¢˜

### ğŸ¯ æœ¬å‘¨ç›®æ ‡
æ¢ç´¢åŒºå—é“¾ç”Ÿæ€çš„å‰æ²¿æŠ€æœ¯

### ğŸ“‹ å­¦ä¹ ä»»åŠ¡
- [ ] **Layer2 é›†æˆ**
  - äº†è§£ Layer2 è§£å†³æ–¹æ¡ˆ
  - é›†æˆ Polygon/Arbitrum
  - è·¨é“¾æ¡¥æ¥æŠ€æœ¯

- [ ] **DeFi åè®®é›†æˆ**
  - é›†æˆ Uniswap/Aave
  - ç†è§£ DeFi ç»„åˆæ€§
  - å®ç°æ”¶ç›Šå†œåœº

- [ ] **é«˜çº§å·¥å…·ä½¿ç”¨**
  - The Graph æ•°æ®ç´¢å¼•
  - IPFS å»ä¸­å¿ƒåŒ–å­˜å‚¨
  - ENS åŸŸåæœåŠ¡

### ğŸ› ï¸ å®è·µé¡¹ç›®
é€‰æ‹©ä¸€ä¸ªæ„Ÿå…´è¶£çš„æ–¹å‘æ·±å…¥å®è·µï¼š
- å¤šé“¾ DApp å¼€å‘
- DeFi åè®®é›†æˆ
- NFT å¸‚åœºå¼€å‘

---

## ğŸ“Š å­¦ä¹ è¿›åº¦è·Ÿè¸ª

### æ¯å‘¨æ£€æŸ¥æ¸…å•
- [ ] å®Œæˆç†è®ºå­¦ä¹ 
- [ ] å®Œæˆå®è·µé¡¹ç›®
- [ ] ä»£ç æäº¤åˆ° GitHub
- [ ] å†™å­¦ä¹ æ€»ç»“

### æŠ€èƒ½è¯„ä¼°æ ‡å‡†
- **åˆçº§**ï¼šèƒ½å¤Ÿè¿æ¥é’±åŒ…ï¼Œè¯»å–åˆçº¦æ•°æ®
- **ä¸­çº§**ï¼šèƒ½å¤Ÿå‘é€äº¤æ˜“ï¼Œå¤„ç†äº‹ä»¶ï¼Œç®¡ç†çŠ¶æ€
- **é«˜çº§**ï¼šèƒ½å¤Ÿç‹¬ç«‹å¼€å‘å®Œæ•´ DAppï¼Œè€ƒè™‘å®‰å…¨å’Œæ€§èƒ½

## ğŸ”— æ¨èèµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Ethers.js æ–‡æ¡£](https://docs.ethers.io/)
- [Web3.js æ–‡æ¡£](https://web3js.readthedocs.io/)
- [Solidity æ–‡æ¡£](https://docs.soliditylang.org/)

### å­¦ä¹ å¹³å°
- [Ethereum.org å¼€å‘è€…èµ„æº](https://ethereum.org/developers/)
- [OpenZeppelin å­¦ä¹ ä¸­å¿ƒ](https://docs.openzeppelin.com/learn/)
- [Consensys Academy](https://consensys.net/academy/)

### å®ç”¨å·¥å…·
- [Remix IDE](https://remix.ethereum.org/)
- [Hardhat](https://hardhat.org/)
- [MetaMask](https://metamask.io/)

---

## ğŸ’¡ å­¦ä¹ å»ºè®®

1. **å¾ªåºæ¸è¿›**ï¼šæŒ‰å‘¨è®¡åˆ’æ‰§è¡Œï¼Œä¸è¦è·³è·ƒå¼å­¦ä¹ 
2. **å®è·µä¸ºä¸»**ï¼šæ¯ä¸ªæ¦‚å¿µéƒ½è¦é€šè¿‡ä»£ç å®è·µ
3. **è®°å½•æ€»ç»“**ï¼šæ¯å‘¨å†™å­¦ä¹ ç¬”è®°å’Œé¡¹ç›®æ€»ç»“
4. **ç¤¾åŒºå‚ä¸**ï¼šåŠ å…¥å¼€å‘è€…ç¤¾åŒºï¼Œå‚ä¸è®¨è®º
5. **æŒç»­æ›´æ–°**ï¼šåŒºå—é“¾æŠ€æœ¯å‘å±•å¿«ï¼Œä¿æŒå­¦ä¹ 

å¼€å§‹æ‚¨çš„ Web3 å¼€å‘ä¹‹æ—…å§ï¼ğŸš€