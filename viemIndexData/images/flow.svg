<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="800" viewBox="0 0 1000 800">
  <defs>
    <style>
      .box{fill:#fff;stroke:#1f2937;stroke-width:2;rx:8;ry:8}
      .title{font-family:system-ui,Segoe UI,Arial,sans-serif;font-size:16px;font-weight:700;fill:#111827}
      .text{font-family:system-ui,Segoe UI,Arial,sans-serif;font-size:14px;fill:#374151}
      .arrow{stroke:#2563eb;stroke-width:2;marker-end:url(#arrowHead)}
      .caption{font-family:system-ui,Segoe UI,Arial,sans-serif;font-size:12px;fill:#2563eb}
    </style>
    <marker id="arrowHead" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#2563eb" />
    </marker>
  </defs>

  <rect x="20" y="20" width="960" height="700" fill="#f9fafb" stroke="#e5e7eb" />

  <text class="title" x="60" y="60">用户前端流程</text>
  <rect class="box" x="60" y="80" width="280" height="60" />
  <text class="text" x="80" y="115">打开前端页面 (index.html)</text>
  <line class="arrow" x1="200" y1="140" x2="200" y2="170" />

  <rect class="box" x="60" y="170" width="280" height="60" />
  <text class="text" x="80" y="205">连接钱包 (eth_requestAccounts)</text>
  <line class="arrow" x1="200" y1="230" x2="200" y2="260" />

  <rect class="box" x="60" y="260" width="280" height="70" />
  <text class="text" x="80" y="295">获取地址 → 调用后端</text>
  <text class="caption" x="80" y="315">GET /api/transfers/:address</text>
  <line class="arrow" x1="200" y1="330" x2="200" y2="360" />

  <rect class="box" x="60" y="360" width="280" height="60" />
  <text class="text" x="80" y="395">收到 JSON → 渲染表格</text>
  <line class="arrow" x1="200" y1="420" x2="200" y2="450" />

  <rect class="box" x="60" y="450" width="280" height="60" />
  <text class="text" x="80" y="485">展示转账记录</text>

  <text class="title" x="420" y="60">后端索引流程</text>
  <rect class="box" x="420" y="80" width="300" height="60" />
  <text class="text" x="440" y="115">服务启动 → init MySQL</text>
  <line class="arrow" x1="570" y1="140" x2="570" y2="170" />

  <rect class="box" x="420" y="170" width="300" height="60" />
  <text class="text" x="440" y="205">读取 last_block</text>
  <line class="arrow" x1="570" y1="230" x2="570" y2="260" />

  <rect class="box" x="420" y="260" width="300" height="60" />
  <text class="text" x="440" y="295">获取当前区块 (getBlockNumber)</text>
  <line class="arrow" x1="570" y1="320" x2="570" y2="350" />

  <rect class="box" x="420" y="350" width="300" height="80" />
  <text class="text" x="440" y="385">计算分片 [from..to]</text>
  <text class="caption" x="440" y="405">CHUNK_SIZE 控制范围</text>
  <line class="arrow" x1="570" y1="430" x2="570" y2="460" />

  <rect class="box" x="420" y="460" width="300" height="90" />
  <text class="text" x="440" y="495">getLogs(Transfer, strict)</text>
  <text class="caption" x="440" y="515">address + event + fromBlock/toBlock</text>
  <line class="arrow" x1="570" y1="550" x2="570" y2="580" />

  <rect class="box" x="420" y="580" width="300" height="90" />
  <text class="text" x="440" y="615">获取 timestamp → 写入 DB</text>
  <text class="caption" x="440" y="635">INSERT IGNORE transfers</text>

  <line class="arrow" x1="740" y1="615" x2="900" y2="615" />
  <text class="caption" x="750" y="605">更新 last_block</text>
  <rect class="box" x="900" y="580" width="60" height="70" />
  <text class="text" x="905" y="610">DB</text>

  <text class="text" x="60" y="700">说明：前端按需查询；后端后台轮询增量索引；一次性补录通过 npm run index 执行。</text>
</svg>