# ğŸ¦ ChainLink è‡ªåŠ¨åŒ–é“¶è¡Œåˆçº¦

åŸºäº Solidity 0.8.25 å’Œ ChainLink Automation çš„æ™ºèƒ½åˆçº¦è‡ªåŠ¨åŒ–æ¼”ç¤ºé¡¹ç›®ã€‚å½“é“¶è¡Œåˆçº¦çš„å­˜æ¬¾è¶…è¿‡è®¾å®šé˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨è½¬ç§»ä¸€åŠå­˜æ¬¾åˆ°åˆçº¦æ‰€æœ‰è€…åœ°å€ã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªæ”¯æŒ ChainLink Automation çš„é“¶è¡Œåˆçº¦ï¼Œå…·æœ‰ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- âœ… ç”¨æˆ·å­˜æ¬¾å’Œæå–åŠŸèƒ½
- âœ… åŸºäºé˜ˆå€¼çš„è‡ªåŠ¨åŒ–è§¦å‘æœºåˆ¶
- âœ… ChainLink Automation é›†æˆ
- âœ… å®‰å…¨çš„èµ„é‡‘ç®¡ç†
- âœ… ç°ä»£åŒ–çš„ Web å‰ç«¯ç•Œé¢

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
chainLink/
â”œâ”€â”€ Bank.sol              # ä¸»åˆçº¦æ–‡ä»¶
â”œâ”€â”€ deploy.js             # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ package.json          # é¡¹ç›®ä¾èµ–
â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ index.html            # å‰ç«¯ç•Œé¢
â”œâ”€â”€ app.js               # å‰ç«¯é€»è¾‘
â””â”€â”€ README.md            # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### æ™ºèƒ½åˆçº¦åŠŸèƒ½

1. **å­˜æ¬¾åŠŸèƒ½** (`deposit()`)
   - ç”¨æˆ·å¯ä»¥å‘åˆçº¦å­˜å…¥ ETH
   - è®°å½•æ¯ä¸ªç”¨æˆ·çš„å­˜æ¬¾ä½™é¢
   - è§¦å‘å­˜æ¬¾äº‹ä»¶

2. **æå–åŠŸèƒ½** (`withdraw()`)
   - ç”¨æˆ·å¯ä»¥æå–è‡ªå·±çš„å­˜æ¬¾
   - å®‰å…¨æ£€æŸ¥ç¡®ä¿ä½™é¢å……è¶³

3. **è‡ªåŠ¨åŒ–æ£€æŸ¥** (`checkUpkeep()`)
   - æ£€æŸ¥æ€»å­˜æ¬¾æ˜¯å¦è¶…è¿‡é˜ˆå€¼
   - éªŒè¯æ—¶é—´é—´éš”æ˜¯å¦æ»¡è¶³ï¼ˆæœ€å°1å°æ—¶ï¼‰
   - ç¡®è®¤åˆçº¦ä½™é¢å……è¶³

4. **è‡ªåŠ¨åŒ–æ‰§è¡Œ** (`performUpkeep()`)
   - å½“æ¡ä»¶æ»¡è¶³æ—¶è‡ªåŠ¨æ‰§è¡Œ
   - è½¬ç§»ä¸€åŠå­˜æ¬¾åˆ°åˆçº¦æ‰€æœ‰è€…
   - æ›´æ–°ç›¸å…³çŠ¶æ€å˜é‡

5. **ç®¡ç†åŠŸèƒ½**
   - æ›´æ–°è§¦å‘é˜ˆå€¼ï¼ˆä»…æ‰€æœ‰è€…ï¼‰
   - ç´§æ€¥æå–åŠŸèƒ½ï¼ˆä»…æ‰€æœ‰è€…ï¼‰
   - çŠ¶æ€æŸ¥è¯¢åŠŸèƒ½

### ChainLink Automation é›†æˆ

æœ¬åˆçº¦å®Œå…¨å…¼å®¹ ChainLink Automation æ ‡å‡†ï¼š

- å®ç°äº† `checkUpkeep()` æ¥å£ç”¨äºæ¡ä»¶æ£€æŸ¥
- å®ç°äº† `performUpkeep()` æ¥å£ç”¨äºè‡ªåŠ¨æ‰§è¡Œ
- æ”¯æŒé“¾ä¸‹è®¡ç®—å’Œé“¾ä¸Šæ‰§è¡Œçš„åˆ†ç¦»

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 16.0.0
- MetaMask é’±åŒ…
- Sepolia æµ‹è¯•ç½‘ ETH
- åˆçº¦åœ°å€ ï¼š 0xcE3BE1592Ec695FF5c311839f3b1399158f6AbaB

### æŠ€æœ¯æ ˆæ›´æ–°

- **å‰ç«¯æ¡†æ¶**: åŸç”Ÿ HTML/CSS/JavaScript
- **Web3 åº“**: Ethers.js v6.x
- **æ™ºèƒ½åˆçº¦**: Solidity 0.8.25
- **è‡ªåŠ¨åŒ–æœåŠ¡**: ChainLink Automation
- **æµ‹è¯•ç½‘ç»œ**: Sepolia

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶å¡«å…¥é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
RPC_URL=https://sepolia.infura.io/v3/YOUR_INFURA_KEY
PRIVATE_KEY=your_private_key_here
DEFAULT_THRESHOLD=1000000000000000000  # 1 ETH
```

### 3. ç¼–è¯‘å’Œéƒ¨ç½²åˆçº¦

#### ä½¿ç”¨ Remix IDEï¼ˆæ¨èï¼‰

1. æ‰“å¼€ [Remix IDE](https://remix.ethereum.org/)
2. åˆ›å»ºæ–°æ–‡ä»¶å¹¶å¤åˆ¶ `Bank.sol` å†…å®¹
3. ç¼–è¯‘åˆçº¦ï¼ˆSolidity 0.8.25ï¼‰
4. è¿æ¥ MetaMask åˆ° Sepolia æµ‹è¯•ç½‘
5. éƒ¨ç½²åˆçº¦ï¼Œè®¾ç½®åˆå§‹é˜ˆå€¼ï¼ˆå¦‚ 1 ETH = 1000000000000000000 weiï¼‰


```

### 4. å¯åŠ¨å‰ç«¯ç•Œé¢

ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `index.html` æ–‡ä»¶ï¼Œæˆ–ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨ï¼š

```bash
# ä½¿ç”¨ Python å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨
python -m http.server 8000

# æˆ–ä½¿ç”¨ Node.js
npx http-server
```

**æ³¨æ„**: å‰ç«¯å·²å‡çº§åˆ° Ethers.js v6ï¼Œå…·æœ‰ä»¥ä¸‹æ”¹è¿›ï¼š
- æ›´ç°ä»£çš„ API è®¾è®¡
- æ›´å¥½çš„ç±»å‹å®‰å…¨æ€§
- ä¼˜åŒ–çš„æ€§èƒ½è¡¨ç°
- ä½¿ç”¨ CDN åŠ è½½ï¼Œæ— éœ€æœ¬åœ°å®‰è£…

## ğŸ“– ä½¿ç”¨æŒ‡å—

### å‰ç«¯æ“ä½œæ­¥éª¤

1. **è¿æ¥é’±åŒ…**
   - ç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®
   - ç¡®ä¿è¿æ¥åˆ° Sepolia æµ‹è¯•ç½‘

2. **è®¾ç½®åˆçº¦åœ°å€**
   - åœ¨"åˆçº¦åœ°å€"è¾“å…¥æ¡†ä¸­è¾“å…¥å·²éƒ¨ç½²çš„åˆçº¦åœ°å€
   - ç³»ç»Ÿä¼šè‡ªåŠ¨éªŒè¯åœ°å€æœ‰æ•ˆæ€§

3. **å­˜æ¬¾æ“ä½œ**
   - è¾“å…¥å­˜æ¬¾é‡‘é¢ï¼ˆETHï¼‰
   - ç‚¹å‡»"å­˜æ¬¾"æŒ‰é’®
   - ç¡®è®¤ MetaMask äº¤æ˜“

4. **ç›‘æ§è‡ªåŠ¨åŒ–çŠ¶æ€**
   - æŸ¥çœ‹"ChainLink Automation çŠ¶æ€"é¢æ¿
   - ç‚¹å‡»"æ£€æŸ¥ Upkeep çŠ¶æ€"æ›´æ–°çŠ¶æ€
   - å½“æ‰€æœ‰æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå¯æ‰‹åŠ¨æ‰§è¡Œæˆ–ç­‰å¾…è‡ªåŠ¨æ‰§è¡Œ

### å‘½ä»¤è¡Œæ“ä½œ

```bash
# éªŒè¯åˆçº¦çŠ¶æ€
npm run verify <åˆçº¦åœ°å€>

# æµ‹è¯•å­˜æ¬¾
npm run test-deposit <åˆçº¦åœ°å€> <é‡‘é¢>

# æ£€æŸ¥ Upkeep çŠ¶æ€
npm run check-upkeep <åˆçº¦åœ°å€>
```

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **é‡å…¥æ”»å‡»é˜²æŠ¤**
   - ä½¿ç”¨ checks-effects-interactions æ¨¡å¼
   - çŠ¶æ€æ›´æ–°åœ¨å¤–éƒ¨è°ƒç”¨ä¹‹å‰

2. **æƒé™æ§åˆ¶**
   - åªæœ‰åˆçº¦æ‰€æœ‰è€…å¯ä»¥æ›´æ–°é˜ˆå€¼
   - åªæœ‰åˆçº¦æ‰€æœ‰è€…å¯ä»¥ç´§æ€¥æå–

3. **æ¡ä»¶éªŒè¯**
   - `performUpkeep()` ä¸­é‡æ–°éªŒè¯æ‰€æœ‰æ¡ä»¶
   - é˜²æ­¢æ¶æ„è°ƒç”¨

4. **æ—¶é—´é”å®š**
   - æœ€å°1å°æ—¶çš„è½¬è´¦é—´éš”
   - é˜²æ­¢é¢‘ç¹è‡ªåŠ¨è½¬è´¦

## ğŸ“Š ChainLink Automation è®¾ç½®

### åœ¨ ChainLink Automation å¹³å°æ³¨å†Œ

1. è®¿é—® [ChainLink Automation](https://automation.chain.link/)
2. è¿æ¥é’±åŒ…å¹¶é€‰æ‹© Sepolia ç½‘ç»œ
3. ç‚¹å‡»"Register New Upkeep"
4. å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Target contract address**: æ‚¨çš„åˆçº¦åœ°å€
   - **Admin address**: ç®¡ç†å‘˜åœ°å€
   - **Gas limit**: 500,000
   - **Starting balance**: 5 LINKï¼ˆç”¨äºæ”¯ä»˜ gas è´¹ç”¨ï¼‰
   - **Check data**: 0xï¼ˆç©ºå­—èŠ‚ï¼‰

### è·å– LINK ä»£å¸

åœ¨ Sepolia æµ‹è¯•ç½‘ä¸Šï¼Œæ‚¨å¯ä»¥ä»ä»¥ä¸‹æ°´é¾™å¤´è·å– LINK ä»£å¸ï¼š
- [ChainLink Faucet](https://faucets.chain.link/)

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šæ­£å¸¸è‡ªåŠ¨åŒ–æµç¨‹

1. éƒ¨ç½²åˆçº¦ï¼Œè®¾ç½®é˜ˆå€¼ä¸º 1 ETH
2. å¤šä¸ªç”¨æˆ·å­˜æ¬¾ï¼Œæ€»é¢è¶…è¿‡ 1 ETH
3. ç­‰å¾…1å°æ—¶åï¼ŒChainLink Automation è‡ªåŠ¨æ‰§è¡Œè½¬è´¦
4. éªŒè¯ä¸€åŠå­˜æ¬¾å·²è½¬ç§»åˆ°æ‰€æœ‰è€…åœ°å€

### åœºæ™¯2ï¼šæ‰‹åŠ¨è§¦å‘

1. å­˜æ¬¾è¶…è¿‡é˜ˆå€¼ä¸”æ—¶é—´é—´éš”æ»¡è¶³
2. åœ¨å‰ç«¯ç‚¹å‡»"æ‰‹åŠ¨æ‰§è¡Œ Upkeep"
3. éªŒè¯è½¬è´¦æ‰§è¡ŒæˆåŠŸ

### åœºæ™¯3ï¼šæ¡ä»¶ä¸æ»¡è¶³

1. å­˜æ¬¾æœªè¾¾åˆ°é˜ˆå€¼
2. éªŒè¯ `checkUpkeep()` è¿”å› false
3. ç¡®è®¤ä¸ä¼šæ‰§è¡Œè‡ªåŠ¨è½¬è´¦

## ğŸ” äº‹ä»¶ç›‘å¬

åˆçº¦å‘å‡ºä»¥ä¸‹äº‹ä»¶ï¼Œå¯ç”¨äºç›‘æ§å’Œåˆ†æï¼š

```solidity
event Deposit(address indexed user, uint256 amount, uint256 newTotal);
event AutoTransfer(uint256 amount, uint256 remainingBalance, uint256 timestamp);
event ThresholdUpdated(uint256 oldThreshold, uint256 newThreshold);
event Withdrawal(address indexed user, uint256 amount);
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **äº¤æ˜“å¤±è´¥**
   - æ£€æŸ¥ gas è´¹ç”¨æ˜¯å¦å……è¶³
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
   - éªŒè¯åˆçº¦åœ°å€æ­£ç¡®

2. **Upkeep ä¸æ‰§è¡Œ**
   - ç¡®è®¤æ¡ä»¶æ˜¯å¦å…¨éƒ¨æ»¡è¶³
   - æ£€æŸ¥ LINK ä½™é¢æ˜¯å¦å……è¶³
   - éªŒè¯æ—¶é—´é—´éš”æ˜¯å¦è¾¾åˆ°

3. **å‰ç«¯è¿æ¥é—®é¢˜**
   - ç¡®è®¤ MetaMask å·²å®‰è£…å¹¶è§£é”
   - æ£€æŸ¥ç½‘ç»œæ˜¯å¦ä¸º Sepolia
   - åˆ·æ–°é¡µé¢é‡æ–°è¿æ¥

### è°ƒè¯•å·¥å…·

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ£€æŸ¥åˆçº¦çŠ¶æ€ï¼ˆEthers.js v6 è¯­æ³•ï¼‰
const provider = new ethers.BrowserProvider(window.ethereum);
const contract = new ethers.Contract(address, abi, provider);
await contract.getUpkeepStatus();

// æ£€æŸ¥é’±åŒ…è¿æ¥çŠ¶æ€
const signer = await provider.getSigner();
console.log('å½“å‰è´¦æˆ·:', await signer.getAddress());

// æ ¼å¼åŒ–é‡‘é¢æ˜¾ç¤º
const balance = await contract.balances(userAddress);
console.log('ç”¨æˆ·ä½™é¢:', ethers.formatEther(balance), 'ETH');
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å‘èµ· Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ LICENSE æ–‡ä»¶

## ğŸ”— ç›¸å…³é“¾æ¥

- [ChainLink Automation æ–‡æ¡£](https://docs.chain.link/chainlink-automation/introduction)
- [Solidity å®˜æ–¹æ–‡æ¡£](https://docs.soliditylang.org/)
- [Ethers.js v6 æ–‡æ¡£](https://docs.ethers.org/v6/)


## âš ï¸ å…è´£å£°æ˜

æœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œæ¼”ç¤ºç›®çš„ã€‚è¯·å‹¿åœ¨ä¸»ç½‘ä½¿ç”¨çœŸå®èµ„é‡‘è¿›è¡Œæµ‹è¯•ã€‚ä½¿ç”¨å‰è¯·å……åˆ†äº†è§£æ™ºèƒ½åˆçº¦çš„é£é™©ã€‚

---